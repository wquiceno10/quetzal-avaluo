{
  "version": 3,
  "sources": ["../../../src/index.js"],
  "sourceRoot": "D:\\Desktop\\Dise\u00F1o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\cloudflare\\avaluos-api-email\\.wrangler\\tmp\\deploy-3TONDh",
  "sourcesContent": ["/**\r\n * avaluos-api-email\r\n * Cloudflare Worker para env\u00EDo de emails con Resend\r\n */\r\nconsole.log(\"Deploy test - \" + new Date().toISOString());\r\n\r\nexport default {\r\n    async fetch(request, env) {\r\n        // CORS headers\r\n        const corsHeaders = {\r\n            'Access-Control-Allow-Origin': '*',\r\n            'Access-Control-Allow-Methods': 'POST, OPTIONS',\r\n            'Access-Control-Allow-Headers': 'Content-Type',\r\n        };\r\n\r\n        // Handle OPTIONS preflight\r\n        if (request.method === 'OPTIONS') {\r\n            return new Response(null, { headers: corsHeaders });\r\n        }\r\n\r\n        if (request.method !== 'POST') {\r\n            return new Response(\r\n                JSON.stringify({ error: 'Method not allowed' }),\r\n                { status: 405, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        let body;\r\n        try {\r\n            body = await request.json();\r\n        } catch (e) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'JSON inv\u00E1lido', details: e.message }),\r\n                { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        const { to, subject, htmlBody } = body;\r\n\r\n        if (!to || !subject || !htmlBody) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'Faltan campos requeridos: to, subject, htmlBody' }),\r\n                { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // Validar formato de email\r\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n        if (!emailRegex.test(to)) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'Formato de correo electr\u00F3nico inv\u00E1lido' }),\r\n                { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        try {\r\n            const response = await fetch('https://api.resend.com/emails', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${env.RESEND_API_KEY}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    from: 'Quetzal H\u00E1bitats <contacto@quetzalhabitats.com>',\r\n                    to: [to],\r\n                    subject: subject,\r\n                    html: htmlBody\r\n                })\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const error = await response.text();\r\n                console.error('Resend error:', error);\r\n                return new Response(\r\n                    JSON.stringify({ error: 'Error al enviar el correo', details: error }),\r\n                    { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n                );\r\n            }\r\n\r\n            const data = await response.json();\r\n            return new Response(\r\n                JSON.stringify({ success: true, message: 'Correo enviado exitosamente', id: data.id }),\r\n                { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        } catch (error) {\r\n            console.error('Error enviando email:', error);\r\n            return new Response(\r\n                JSON.stringify({ error: 'Error al enviar el correo', details: error.message }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n    }\r\n};\r\n"],
  "mappings": ";AAIA,QAAQ,IAAI,oBAAmB,oBAAI,KAAK,GAAE,YAAY,CAAC;AAEvD,IAAO,gBAAQ;AAAA,EACX,MAAM,MAAM,SAAS,KAAK;AAEtB,UAAM,cAAc;AAAA,MAChB,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,IACpC;AAGA,QAAI,QAAQ,WAAW,WAAW;AAC9B,aAAO,IAAI,SAAS,MAAM,EAAE,SAAS,YAAY,CAAC;AAAA,IACtD;AAEA,QAAI,QAAQ,WAAW,QAAQ;AAC3B,aAAO,IAAI;AAAA,QACP,KAAK,UAAU,EAAE,OAAO,qBAAqB,CAAC;AAAA,QAC9C,EAAE,QAAQ,KAAK,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB,EAAE;AAAA,MACnF;AAAA,IACJ;AAEA,QAAI;AACJ,QAAI;AACA,aAAO,MAAM,QAAQ,KAAK;AAAA,IAC9B,SAAS,GAAG;AACR,aAAO,IAAI;AAAA,QACP,KAAK,UAAU,EAAE,OAAO,oBAAiB,SAAS,EAAE,QAAQ,CAAC;AAAA,QAC7D,EAAE,QAAQ,KAAK,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB,EAAE;AAAA,MACnF;AAAA,IACJ;AAEA,UAAM,EAAE,IAAI,SAAS,SAAS,IAAI;AAElC,QAAI,CAAC,MAAM,CAAC,WAAW,CAAC,UAAU;AAC9B,aAAO,IAAI;AAAA,QACP,KAAK,UAAU,EAAE,OAAO,kDAAkD,CAAC;AAAA,QAC3E,EAAE,QAAQ,KAAK,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB,EAAE;AAAA,MACnF;AAAA,IACJ;AAGA,UAAM,aAAa;AACnB,QAAI,CAAC,WAAW,KAAK,EAAE,GAAG;AACtB,aAAO,IAAI;AAAA,QACP,KAAK,UAAU,EAAE,OAAO,+CAAyC,CAAC;AAAA,QAClE,EAAE,QAAQ,KAAK,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB,EAAE;AAAA,MACnF;AAAA,IACJ;AAEA,QAAI;AACA,YAAM,WAAW,MAAM,MAAM,iCAAiC;AAAA,QAC1D,QAAQ;AAAA,QACR,SAAS;AAAA,UACL,iBAAiB,UAAU,IAAI,cAAc;AAAA,UAC7C,gBAAgB;AAAA,QACpB;AAAA,QACA,MAAM,KAAK,UAAU;AAAA,UACjB,MAAM;AAAA,UACN,IAAI,CAAC,EAAE;AAAA,UACP;AAAA,UACA,MAAM;AAAA,QACV,CAAC;AAAA,MACL,CAAC;AAED,UAAI,CAAC,SAAS,IAAI;AACd,cAAM,QAAQ,MAAM,SAAS,KAAK;AAClC,gBAAQ,MAAM,iBAAiB,KAAK;AACpC,eAAO,IAAI;AAAA,UACP,KAAK,UAAU,EAAE,OAAO,6BAA6B,SAAS,MAAM,CAAC;AAAA,UACrE,EAAE,QAAQ,KAAK,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB,EAAE;AAAA,QACnF;AAAA,MACJ;AAEA,YAAM,OAAO,MAAM,SAAS,KAAK;AACjC,aAAO,IAAI;AAAA,QACP,KAAK,UAAU,EAAE,SAAS,MAAM,SAAS,+BAA+B,IAAI,KAAK,GAAG,CAAC;AAAA,QACrF,EAAE,QAAQ,KAAK,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB,EAAE;AAAA,MACnF;AAAA,IACJ,SAAS,OAAO;AACZ,cAAQ,MAAM,yBAAyB,KAAK;AAC5C,aAAO,IAAI;AAAA,QACP,KAAK,UAAU,EAAE,OAAO,6BAA6B,SAAS,MAAM,QAAQ,CAAC;AAAA,QAC7E,EAAE,QAAQ,KAAK,SAAS,EAAE,GAAG,aAAa,gBAAgB,mBAAmB,EAAE;AAAA,MACnF;AAAA,IACJ;AAAA,EACJ;AACJ;",
  "names": []
}
