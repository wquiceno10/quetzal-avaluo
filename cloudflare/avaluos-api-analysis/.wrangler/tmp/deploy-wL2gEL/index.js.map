{
  "version": 3,
  "sources": ["../../../src/index.js"],
  "sourceRoot": "D:\\Desktop\\Dise\u00F1o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\cloudflare\\avaluos-api-analysis\\.wrangler\\tmp\\deploy-wL2gEL",
  "sourcesContent": ["/**\r\n * avaluos-api-analysis\r\n * Cloudflare Worker para an\u00E1lisis de mercado con Perplexity + DeepSeek\r\n */\r\nconsole.log(\"Deploy test - \" + new Date().toISOString());\r\n\r\nexport default {\r\n    async fetch(request, env) {\r\n        // CORS headers\r\n        const corsHeaders = {\r\n            'Access-Control-Allow-Origin': '*',\r\n            'Access-Control-Allow-Methods': 'POST, OPTIONS',\r\n            'Access-Control-Allow-Headers': 'Content-Type',\r\n        };\r\n\r\n        // Handle OPTIONS preflight\r\n        if (request.method === 'OPTIONS') {\r\n            return new Response(null, { headers: corsHeaders });\r\n        }\r\n\r\n        if (request.method !== 'POST') {\r\n            return new Response(\r\n                JSON.stringify({ error: 'Method not allowed' }),\r\n                { status: 405, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // 1. Leer body\r\n        let body;\r\n        try {\r\n            body = await request.json();\r\n        } catch (e) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'JSON inv\u00E1lido', details: e.message }),\r\n                { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        const { formData } = body || {};\r\n        if (!formData) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'formData es requerido' }),\r\n                { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        const PERPLEXITY_API_KEY = env.PERPLEXITY_API_KEY;\r\n        const DEEPSEEK_API_KEY = env.DEEPSEEK_API_KEY;\r\n\r\n        if (!PERPLEXITY_API_KEY) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'PERPLEXITY_API_KEY no configurada' }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        if (!DEEPSEEK_API_KEY) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'DEEPSEEK_API_KEY no configurada' }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // -----------------------------\r\n        // 2. Contexto del inmueble\r\n        // -----------------------------\r\n\r\n        const tipoInmueble = formData.tipo_inmueble || 'inmueble';\r\n\r\n        const ubicacionPrincipal =\r\n            formData.nombre_conjunto && formData.contexto_zona === 'conjunto_cerrado'\r\n                ? `${formData.nombre_conjunto}, ${formData.barrio}, ${formData.municipio}`\r\n                : `${formData.barrio}, ${formData.municipio}`;\r\n\r\n        const ubicacionCiudad = `${formData.municipio}, ${formData.departamento}`;\r\n\r\n        const infoInmueble = `\r\n- Tipo: ${tipoInmueble}\r\n- Ubicaci\u00F3n principal: ${ubicacionPrincipal}\r\n- Ciudad: ${ubicacionCiudad}\r\n- \u00C1rea construida: ${formData.area_construida} m\u00B2\r\n- Habitaciones: ${formData.habitaciones || 'No especificado'}\r\n- Ba\u00F1os: ${formData.banos || 'No especificado'}\r\n- Parqueadero: ${formData.tipo_parqueadero || 'No especificado'}\r\n- Estado: ${formData.estado_inmueble || 'No especificado'}\r\n- Antig\u00FCedad: ${formData.antiguedad || 'No especificada'}\r\n${formData.tipo_remodelacion ? `- Tipo de remodelaci\u00F3n: ${formData.tipo_remodelacion}` : ''}\r\n${formData.informacion_complementaria ? `- Informaci\u00F3n adicional: ${formData.informacion_complementaria}` : ''}\r\n  `.trim();\r\n\r\n        // -----------------------------\r\n        // 3. PROMPT PARA PERPLEXITY\r\n        // -----------------------------\r\n\r\n        const areaConstruida = formData.area_construida ? parseInt(formData.area_construida) : null;\r\n        const margenArea = 0.30;\r\n        const minArea = areaConstruida ? Math.round(areaConstruida * (1 - margenArea)) : null;\r\n        const maxArea = areaConstruida ? Math.round(areaConstruida * (1 + margenArea)) : null;\r\n\r\n        const areaInstruction = areaConstruida\r\n            ? `\r\n\r\nCRITERIOS DE SELECCI\u00D3N PARA COMPARABLES DE VENTA:\r\n   - \u00C1rea construida del inmueble objetivo: ${areaConstruida} m\u00B2\r\n   - Rango de \u00E1reas aceptable para comparables de venta: ${minArea} a ${maxArea} m\u00B2 (\u00B130%)\r\n   - SOLO incluye comparables de venta cuyas \u00E1reas est\u00E9n dentro de este rango.\r\n   - Para arriendos, el \u00E1rea puede ser m\u00E1s flexible pero intenta mantenerla similar.`\r\n            : '';\r\n\r\n        const perplexityPrompt = `\r\nEres un analista inmobiliario especializado en aval\u00FAos comerciales t\u00E9cnicos y estimaci\u00F3n de valor apoyada en datos estad\u00EDsticos del mercado colombiano.\r\nTu tarea es elaborar un **an\u00E1lisis completo, claro y profesional**, incluso cuando la informaci\u00F3n disponible sea limitada.\r\n\r\nDATOS DEL INMUEBLE\r\n-------------------\r\nBasado en estos datos proporcionados por el usuario:\r\n\r\n${infoInmueble}\r\n\r\nINSTRUCCIONES GENERALES\r\n------------------------\r\n1. Si no encuentras suficientes datos reales en portales inmobiliarios, DEBES complementar con:\r\n   - Estad\u00EDsticas municipales y regionales (promedios por m\u00B2 seg\u00FAn ciudad y estrato).\r\n   - Barrios de caracter\u00EDsticas socioecon\u00F3micas similares (mismo estrato, antig\u00FCedad promedio, tipolog\u00EDa).\r\n   - Valores t\u00EDpicos de mercado seg\u00FAn tama\u00F1o del inmueble y ubicaci\u00F3n.\r\n2. NUNCA devuelvas valores \"0\", \"null\", \"N/A\" o similares.\r\n3. Si un dato no aparece directamente, GENERA una estimaci\u00F3n razonable basada en promedios municipales, del estrato o del tipo de inmueble.\r\n4. Siempre entrega comparables suficientes aunque no existan exactos en la zona:\r\n   - Entrega idealmente entre 15 y 25 comparables en total (si el mercado lo permite).\r\n   - Incluye propiedades en arriendo. Incluye al menos 3.\r\n   - Incluye propiedades de barrios similares (en barrios cercanos o condiciones socioecon\u00F3micas equivalentes, rangos de area y precios comparables). Incluye al menos 3.\r\n   ${areaInstruction}\r\n5. NO incluyas hiperv\u00EDnculos ni enlaces. Solo textos descriptivos.\r\n6. Incluye precios, \u00E1reas y valores de mercado siempre en pesos colombianos.\r\n7. Responde SIEMPRE en espa\u00F1ol.\r\n8. AL FINAL DEL AN\u00C1LISIS, agrega una secci\u00F3n expl\u00EDcita llamada \"FUENTES CONSULTADAS\" donde listes los dominios de los portales visitados (ej: fincaraiz.com.co, metrocuadrado.com, ciencuadras.com).\r\n\r\nTAREAS\r\n------\r\n\r\n## 1. B\u00DASQUEDA Y SELECCI\u00D3N DE COMPARABLES\r\n\r\nPrimero, comenta brevemente qu\u00E9 tan abundante o escasa es la informaci\u00F3n del mercado para este inmueble.\r\n\r\nLuego presenta un listado de **entre 15 a 25 comparables**. Para cada uno indica:\r\n\r\n- T\u00EDtulo o descripci\u00F3n del inmueble.\r\n- Barrio y municipio.\r\n- Tipo de operaci\u00F3n: Venta o Arriendo.\r\n- Si el barrio es:\r\n  - \"Mismo barrio/conjunto\"\r\n  - \"Barrio similar (mismo estrato y tipolog\u00EDa)\"\r\n  - \"Zona cercana de referencia regional\"\r\n- \u00C1rea aproximada en m\u00B2.\r\n- Precio total aproximado.\r\n- Precio por m\u00B2 aproximado.\r\n\r\nAunque la informaci\u00F3n de portales no sea perfecta, debes estimar valores razonables usando contexto de mercado (ciudad, estrato, tipo de inmueble).\r\n\r\n## 2. AN\u00C1LISIS DEL VALOR\r\n\r\n### 2.1. M\u00E9todo de Venta Directa (Precio por m\u00B2)\r\n\r\n- Explica c\u00F3mo calculas el valor promedio por m\u00B2 del mercado para este inmueble:\r\n  - Si usas promedio simple, recortado o ponderado.\r\n  - Si combina datos del barrio, barrios similares y promedios municipales.\r\n- Indica el valor por m\u00B2 FINAL que decides usar para el c\u00E1lculo del inmueble objetivo.\r\n- Calcula el valor estimado del inmueble objetivo por este m\u00E9todo (precio por m\u00B2 x \u00E1rea).\r\n\r\n### 2.2. M\u00E9todo de Rentabilidad (Yield mensual promedio del mercado)\r\n\r\n- Estima el canon de arrendamiento mensual promedio para este inmueble usando los comparables.\r\n- Estima el Yield (Rentabilidad) mensual promedio del sector (ej: 0.4%, 0.5%, 0.6%).\r\n- Apl\u00EDcalo a la f\u00F3rmula:\r\n\r\n  Valor estimado = Canon mensual estimado / Yield mensual estimado\r\n\r\n- Indica claramente el Canon mensual y el Yield mensual utilizados.\r\n- Calcula el valor estimado del inmueble objetivo por este m\u00E9todo.\r\n\r\n## 3. RESULTADOS FINALES\r\n\r\nEntrega de forma clara:\r\n\r\n- Valor comercial estimado (promedio ponderado entre ambos m\u00E9todos, explica cu\u00E1l pesa m\u00E1s y por qu\u00E9).\r\n- Rango sugerido de negociaci\u00F3n (m\u00EDnimo y m\u00E1ximo razonables).\r\n- Precio por m\u00B2 final usado para el c\u00E1lculo.\r\n- Comentario sobre si el resultado se ubica en la parte baja, media o alta del mercado del sector.\r\n\r\n## 4. AJUSTES APLICADOS\r\n\r\nExplica qu\u00E9 ajustes aplicas y por qu\u00E9:\r\n\r\n- Ajustes por antig\u00FCedad vs. comparables.\r\n- Ajustes por estado de conservaci\u00F3n (bueno, regular, excelente).\r\n- Ajustes por parqueadero (tener, no tener, tipo).\r\n- Ajustes por remodelaciones (mejoras significativas o necesidad de inversi\u00F3n).\r\n- Ajustes por entorno (plusval\u00EDa del sector, accesos, comercio, servicios).\r\n\r\n## 5. LIMITACIONES\r\n\r\nMenciona las principales limitaciones del an\u00E1lisis:\r\n\r\n- Escasez de datos reales en el barrio.\r\n- Dependencia de promedios municipales o regionales.\r\n- Diferencias de estrato o tipolog\u00EDa entre comparables.\r\n\r\n## 6. RESUMEN EJECUTIVO PARA EL PROPIETARIO\r\n\r\nCierra con 1 a 2 p\u00E1rrafos claros que expliquen:\r\n\r\n- El valor final recomendado.\r\n- El rango sugerido de publicaci\u00F3n.\r\n- El nivel de confianza del an\u00E1lisis.\r\n- Recomendaciones de estrategia (publicar un poco arriba del valor recomendado, m\u00E1rgenes de negociaci\u00F3n, etc.).\r\n\r\nFORMATO\r\n--------\r\n- No uses tablas Markdown.\r\n- Usa subt\u00EDtulos y listas claras.\r\n- NO devuelvas JSON.\r\n- NO incluyas enlaces.\r\n- Aseg\u00FArate de incluir la secci\u00F3n \"FUENTES CONSULTADAS\" al final con los dominios de los portales.\r\n`.trim();\r\n\r\n        // -----------------------------\r\n        // 4. Llamar a Perplexity\r\n        // -----------------------------\r\n\r\n        let perplexityContent = '';\r\n        try {\r\n            const response = await fetch('https://api.perplexity.ai/chat/completions', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    Authorization: `Bearer ${PERPLEXITY_API_KEY}`,\r\n                },\r\n                body: JSON.stringify({\r\n                    model: 'sonar-pro',\r\n                    messages: [\r\n                        {\r\n                            role: 'system',\r\n                            content:\r\n                                'Eres un valuador inmobiliario colombiano experto en an\u00E1lisis de mercado residencial y comercial.',\r\n                        },\r\n                        {\r\n                            role: 'user',\r\n                            content: perplexityPrompt,\r\n                        },\r\n                    ],\r\n                    temperature: 0.25,\r\n                    max_tokens: 8000,\r\n                }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorText = await response.text();\r\n                console.error('Perplexity API error:', response.status, errorText);\r\n                return new Response(\r\n                    JSON.stringify({\r\n                        error: `Error en Perplexity (${response.status})`,\r\n                        details: errorText,\r\n                    }),\r\n                    { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n                );\r\n            }\r\n\r\n            const perplexityResponse = await response.json();\r\n            perplexityContent =\r\n                (perplexityResponse.choices &&\r\n                    perplexityResponse.choices[0] &&\r\n                    perplexityResponse.choices[0].message &&\r\n                    perplexityResponse.choices[0].message.content) ||\r\n                '';\r\n\r\n            console.log(\r\n                'Perplexity Raw Content (first 2000 chars):',\r\n                perplexityContent.slice(0, 2000),\r\n            );\r\n        } catch (err) {\r\n            console.error('Perplexity request failed:', err);\r\n            return new Response(\r\n                JSON.stringify({ error: 'Error al llamar a Perplexity', details: err.message }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        if (!perplexityContent) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'Perplexity devolvi\u00F3 una respuesta vac\u00EDa' }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // -----------------------------\r\n        // 5. Esquema JSON para DeepSeek\r\n        // -----------------------------\r\n\r\n        const jsonSchema = {\r\n            type: 'object',\r\n            properties: {\r\n                resumen_busqueda: {\r\n                    type: 'string',\r\n                    description:\r\n                        'Resumen ejecutivo completo y rico en detalles, explicando las variables usadas, el valor m\u00B2 y las principales conclusiones. DEBE SER EXTENSO Y EXPLICATIVO.',\r\n                },\r\n                total_comparables: { type: 'number' },\r\n                total_comparables_venta: { type: 'number' },\r\n                total_comparables_arriendo: { type: 'number' },\r\n                portales_consultados: {\r\n                    type: 'array',\r\n                    items: { type: 'string' },\r\n                },\r\n\r\n                valor_final: {\r\n                    type: ['number', 'null'],\r\n                    description: 'Valor final recomendado expl\u00EDcitamente en el an\u00E1lisis (ej: \"Valor recomendado: $270.000.000\")'\r\n                },\r\n\r\n                valor_estimado_venta_directa: { type: ['number', 'null'] },\r\n                precio_m2_venta_directa: { type: ['number', 'null'] },\r\n                metodologia_venta_directa: { type: ['string', 'null'] },\r\n\r\n                valor_estimado_rentabilidad: { type: ['number', 'null'] },\r\n                canon_arriendo_promedio: { type: ['number', 'null'] },\r\n                metodologia_rentabilidad: { type: ['string', 'null'] },\r\n                yield_mensual_mercado: {\r\n                    type: ['number', 'null'],\r\n                    description: 'Yield mensual promedio del mercado seg\u00FAn el an\u00E1lisis (ej: 0.0055 para 0.55%)'\r\n                },\r\n\r\n                rango_valor_min: { type: ['number', 'null'] },\r\n                rango_valor_max: { type: ['number', 'null'] },\r\n\r\n                precio_m2_usado: { type: ['number', 'null'] },\r\n                metodo_calculo_m2: { type: ['string', 'null'] },\r\n                precio_m2_regional: { type: ['number', 'null'] },\r\n\r\n                ajustes_antiguedad: { type: ['string', 'null'] },\r\n                ajustes_parqueadero: { type: ['string', 'null'] },\r\n                limitaciones: { type: ['string', 'null'] },\r\n\r\n                comparables: {\r\n                    type: 'array',\r\n                    items: {\r\n                        type: 'object',\r\n                        properties: {\r\n                            titulo: { type: 'string' },\r\n                            tipo_origen: { type: 'string', enum: ['venta', 'arriendo'] },\r\n                            fuente_zona: {\r\n                                type: ['string', 'null'],\r\n                                description:\r\n                                    '\"Mismo barrio/conjunto\", \"Barrio similar\", \"Zona cercana de referencia regional\", etc.',\r\n                            },\r\n                            barrio: { type: ['string', 'null'] },\r\n                            municipio: { type: ['string', 'null'] },\r\n                            area_m2: { type: ['number', 'null'] },\r\n                            habitaciones: { type: ['number', 'null'] },\r\n                            banos: { type: ['number', 'null'] },\r\n                            precio_publicado: { type: ['number', 'null'] },\r\n                            precio_cop: { type: ['number', 'null'] },\r\n                            precio_m2: { type: ['number', 'null'] },\r\n                            yield_mensual: {\r\n                                type: ['number', 'null'],\r\n                                description: 'Yield mensual si es comparable de arriendo (ej: 0.0052 para 0.52%)'\r\n                            }\r\n                        },\r\n                    },\r\n                },\r\n            },\r\n            required: ['comparables'],\r\n        };\r\n\r\n        // -----------------------------\r\n        // 6. Prompt de extracci\u00F3n para DeepSeek\r\n        // -----------------------------\r\n\r\n        const extractionPrompt = `\r\nA partir del siguiente AN\u00C1LISIS COMERCIAL INMOBILIARIO, extrae la informaci\u00F3n en el esquema JSON especificado.\r\n\r\nINFORMACI\u00D3N DEL INMUEBLE:\r\n${infoInmueble}\r\n\r\nAN\u00C1LISIS DE MERCADO (texto generado por Perplexity):\r\n${perplexityContent}\r\n\r\nINSTRUCCIONES PARA LA EXTRACCI\u00D3N:\r\n\r\n1. EXTRACCI\u00D3N COMPLETA DE COMPARABLES\r\n   - Extrae TODOS los comparables que aparecen en el an\u00E1lisis.\r\n   - NO filtres, NO omitas, NO apliques criterios de \u00E1rea o precio.\r\n   - Incluye todos los comparables que encuentres, tanto de venta como de arriendo.\r\n   - Si el an\u00E1lisis menciona \"al menos 15-25 comparables\", espera extraer esa cantidad.\r\n\r\n2. VALOR FINAL RECOMENDADO\r\n   - Busca en el an\u00E1lisis frases como:\r\n     * \"Valor recomendado: $XXX.XXX.XXX\"\r\n     * \"Valor comercial estimado: $XXX.XXX.XXX\" \r\n     * \"Valor final recomendado: $XXX.XXX.XXX\"\r\n     * \"Valor sugerido: $XXX.XXX.XXX\"\r\n   - Extrae ese n\u00FAmero exacto como \"valor_final\".\r\n\r\n3. PARA CADA COMPARABLE\r\n   - Llena el arreglo \"comparables\" con TODOS los elementos que encuentres.\r\n   - Para cada comparable identifica:\r\n     * titulo: nombre o descripci\u00F3n breve.\r\n     * tipo_origen: \"venta\" o \"arriendo\".\r\n     * fuente_zona: \"Mismo barrio/conjunto\", \"Barrio similar\", etc.\r\n     * barrio y municipio.\r\n     * area_m2: \u00E1rea aproximada.\r\n     * habitaciones y banos: si est\u00E1n mencionados.\r\n     * precio_publicado: precio total aproximado.\r\n     * precio_cop: igual a precio_publicado (si es venta) o valor estimado de venta si es arriendo (canon / yield apropiado).\r\n     * precio_m2: precio_cop / area_m2 si el texto no lo da expl\u00EDcito.\r\n     * yield_mensual: si es comparable de arriendo y se menciona el rendimiento.\r\n\r\n4. TOTALES\r\n   - total_comparables: n\u00FAmero total de comparables listados (debe coincidir con el tama\u00F1o del arreglo).\r\n   - total_comparables_venta: cu\u00E1ntos comparables son de venta.\r\n   - total_comparables_arriendo: cu\u00E1ntos comparables son de arriendo.\r\n\r\n5. INDICADORES GLOBALES\r\n   - valor_estimado_venta_directa: valor de venta calculado por el m\u00E9todo de precio por m\u00B2.\r\n   - valor_estimado_rentabilidad: valor calculado como (canon_arriendo_promedio / yield_mensual_mercado).\r\n   - canon_arriendo_promedio: canon mensual estimado.\r\n   - yield_mensual_mercado: yield mensual estimado (ej: 0.005).\r\n   - rango_valor_min y rango_valor_max: rango de negociaci\u00F3n recomendado.\r\n   - precio_m2_usado: valor m\u00B2 final usado en el c\u00E1lculo.\r\n\r\n6. PORTALES CONOCIDOS\r\n   - portales_consultados: Extrae los dominios listados en la secci\u00F3n \"FUENTES CONSULTADAS\" del an\u00E1lisis. Si no existe esa secci\u00F3n, busca menciones de portales en el texto.\r\n\r\n7. AJUSTES Y LIMITACIONES\r\n   - ajustes_antiguedad, ajustes_parqueadero, limitaciones.\r\n\r\n8. RESUMEN\r\n   - resumen_busqueda: 1 - 2 p\u00E1rrafos orientados al propietario.\r\n\r\nREGLA IMPORTANTE:\r\n   - Extrae TODOS los comparables sin filtrar. El an\u00E1lisis ya aplic\u00F3 filtros de \u00E1rea y relevancia.\r\n   - Usa null para datos faltantes, nunca 0.\r\n`.trim();\r\n\r\n        // -----------------------------\r\n        // 7. Llamar a DeepSeek y procesar\r\n        // -----------------------------\r\n        try {\r\n            const deepseekResponse = await fetch('https://api.deepseek.com/v1/chat/completions', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${DEEPSEEK_API_KEY}`\r\n                },\r\n                body: JSON.stringify({\r\n                    model: 'deepseek-chat',\r\n                    messages: [\r\n                        {\r\n                            role: 'system',\r\n                            content: 'Eres un asistente experto en an\u00E1lisis y extracci\u00F3n de datos estructurados de textos de aval\u00FAos inmobiliarios. TU SALIDA DEBE SER \u00DANICAMENTE UN JSON V\u00C1LIDO QUE SIGA EL ESQUEMA SOLICITADO. NO incluyas bloques de c\u00F3digo markdown (```json), solo el JSON puro.'\r\n                        },\r\n                        {\r\n                            role: 'user',\r\n                            content: extractionPrompt\r\n                        }\r\n                    ],\r\n                    // response_format removed as it causes 400 error\r\n                    temperature: 0.1\r\n                })\r\n            });\r\n\r\n            if (!deepseekResponse.ok) {\r\n                const errorText = await deepseekResponse.text();\r\n                console.error('DeepSeek API error:', deepseekResponse.status, errorText);\r\n                return new Response(\r\n                    JSON.stringify({\r\n                        error: `Error en DeepSeek (${deepseekResponse.status})`,\r\n                        details: errorText,\r\n                        perplexity_full_text: perplexityContent\r\n                    }),\r\n                    { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n                );\r\n            }\r\n\r\n            const deepseekData = await deepseekResponse.json();\r\n            let content = deepseekData.choices[0].message.content;\r\n\r\n            // Limpiar bloques de c\u00F3digo si DeepSeek los incluye\r\n            content = content.replace(/```json\\n?|```/g, '').trim();\r\n\r\n            const extractedData = JSON.parse(content);\r\n\r\n            // --- REGEX FALLBACKS PARA VALORES CR\u00CDTICOS ---\r\n            // Si DeepSeek devuelve null en valores clave, intentamos extraerlos con Regex del texto de Perplexity\r\n\r\n            if (!extractedData.valor_final) {\r\n                const match = perplexityContent.match(/valor\\s+(?:comercial|recomendado|sugerido|final).*?\\$?\\s*([\\d.,]+)/i);\r\n                if (match) extractedData.valor_final = parseFloat(match[1].replace(/[.,](?=\\d{3})/g, '').replace(',', '.'));\r\n            }\r\n\r\n            if (!extractedData.valor_estimado_venta_directa) {\r\n                const match = perplexityContent.match(/venta\\s+directa.*?\\$?\\s*([\\d.,]+)/i);\r\n                if (match) extractedData.valor_estimado_venta_directa = parseFloat(match[1].replace(/[.,](?=\\d{3})/g, '').replace(',', '.'));\r\n            }\r\n\r\n            if (!extractedData.valor_estimado_rentabilidad) {\r\n                const match = perplexityContent.match(/rentabilidad.*?\\$?\\s*([\\d.,]+)/i);\r\n                if (match) extractedData.valor_estimado_rentabilidad = parseFloat(match[1].replace(/[.,](?=\\d{3})/g, '').replace(',', '.'));\r\n            }\r\n            // ---------------------------------------------\r\n\r\n            console.log(\r\n                'DeepSeek Extracted Data (first part):',\r\n                JSON.stringify(extractedData, null, 2).slice(0, 2000),\r\n            );\r\n\r\n            const comparablesRaw = Array.isArray(extractedData.comparables)\r\n                ? extractedData.comparables\r\n                : [];\r\n\r\n            // ==============================================\r\n            // FUNCIONES HELPER SIMPLIFICADAS\r\n            // ==============================================\r\n\r\n            // Normalizar n\u00FAmeros\r\n            const sanitizeNumber = (n) => {\r\n                if (typeof n !== 'number') return null;\r\n                if (!isFinite(n)) return null;\r\n                if (n === 0) return null;\r\n                return n;\r\n            };\r\n\r\n            const crearComparable = (c, yieldMercado) => {\r\n                // \u2705 AGREGAR VALIDACI\u00D3N INICIAL CR\u00CDTICA\r\n                if (!c || typeof c !== 'object') {\r\n                    console.warn('Comparable raw es null o no es objeto:', c);\r\n                    return null;\r\n                }\r\n\r\n                const area = sanitizeNumber(c.area_m2);\r\n                let precioPublicado = sanitizeNumber(c.precio_publicado);\r\n                let precioCop = sanitizeNumber(c.precio_cop);\r\n                let precioM2 = sanitizeNumber(c.precio_m2);\r\n                const yieldComparable = sanitizeNumber(c.yield_mensual);\r\n\r\n                // Normalizar tipo de operaci\u00F3n\r\n                const tipoRaw = (c.tipo_origen || '').toString().toLowerCase();\r\n                const esArriendo = tipoRaw.includes('arriendo');\r\n\r\n                // \u2705 CORRECCI\u00D3N CR\u00CDTICA: CONVERSI\u00D3N ARRIENDO \u2192 VENTA\r\n                if (esArriendo && precioPublicado && !precioCop) {\r\n                    // Si es arriendo y tenemos canon pero no precioCop, convertir\r\n                    const yieldToUse = yieldComparable || yieldMercado || 0.005; // Default 0.5%\r\n                    if (yieldToUse > 0) {\r\n                        precioCop = Math.round(precioPublicado / yieldToUse);\r\n                        console.log(`\uD83D\uDCB0 Conversi\u00F3n arriendo: ${precioPublicado} / ${yieldToUse} = ${precioCop}`);\r\n                    }\r\n                } else if (esArriendo && precioCop && precioPublicado && Math.abs(precioCop - precioPublicado) < 1000000) {\r\n                    // Si precioCop es muy cercano al canon (error de extracci\u00F3n), convertir\r\n                    const yieldToUse = yieldComparable || yieldMercado || 0.005;\r\n                    if (yieldToUse > 0) {\r\n                        precioCop = Math.round(precioPublicado / yieldToUse);\r\n                        console.log(`\uD83D\uDD04 Correcci\u00F3n: ${precioPublicado} \u2192 ${precioCop} (yield: ${yieldToUse})`);\r\n                    }\r\n                }\r\n\r\n                // Si no tenemos precioCop pero s\u00ED precioPublicado (para ventas)\r\n                if (!precioCop && precioPublicado && !esArriendo) {\r\n                    precioCop = precioPublicado;\r\n                }\r\n\r\n                // Calcular precio por m\u00B2 si falta\r\n                if (!precioM2 && precioCop && area) {\r\n                    precioM2 = Math.round(precioCop / area);\r\n                }\r\n\r\n                return {\r\n                    titulo: c.titulo || 'Propiedad comparable',\r\n                    tipo_origen: esArriendo ? 'arriendo' : 'venta',\r\n                    fuente_zona: c.fuente_zona || null,\r\n                    barrio: c.barrio || null,\r\n                    municipio: c.municipio || null,\r\n                    area_m2: area,\r\n                    habitaciones: sanitizeNumber(c.habitaciones),\r\n                    banos: sanitizeNumber(c.banos),\r\n                    precio_publicado: precioPublicado,\r\n                    precio_cop: precioCop,\r\n                    precio_m2: precioM2,\r\n                    yield_mensual: yieldComparable,\r\n                };\r\n            };\r\n\r\n            // Funci\u00F3n para calcular promedio de precio/m\u00B2 de ventas (solo para estad\u00EDsticas)\r\n            const calcularPromedioM2Ventas = (comps) => {\r\n                const ventas = comps.filter(c =>\r\n                    c.tipo_origen === 'venta' && c.precio_m2 && c.precio_m2 > 0\r\n                );\r\n\r\n                if (ventas.length === 0) return null;\r\n\r\n                const suma = ventas.reduce((total, c) => total + c.precio_m2, 0);\r\n                return Math.round(suma / ventas.length);\r\n            };\r\n\r\n            // Normalizar nombre de portal\r\n            const normalizarPortal = (p) => {\r\n                if (!p || typeof p !== 'string') return null;\r\n                const limpio = p.trim().toLowerCase();\r\n                if (!limpio) return null;\r\n\r\n                const dominio = limpio\r\n                    .replace(/^(https?:\\/\\/)?(www\\.)?/, '')\r\n                    .split('/')[0]\r\n                    .split('?')[0];\r\n\r\n                return dominio || null;\r\n            };\r\n\r\n            // ==============================================\r\n            // L\u00D3GICA PRINCIPAL - SIN FILTROS\r\n            // ==============================================\r\n\r\n            // 1. Determinar yield a usar\r\n            const yieldMercado = sanitizeNumber(extractedData.yield_mensual_mercado) || 0.005;\r\n\r\n            // 2. Crear TODOS los comparables que DeepSeek extrajo\r\n            const comparables = comparablesRaw\r\n                .map(c => crearComparable(c, yieldMercado))\r\n                .filter(c => c !== null); // Solo filtrar los nulos por error de creaci\u00F3n\r\n\r\n            console.log(`\u2705 Comparables extra\u00EDdos: ${comparables.length}`);\r\n            console.log(`\uD83D\uDCCA Distribuci\u00F3n: ${comparables.filter(c => c.tipo_origen === 'venta').length} venta, ${comparables.filter(c => c.tipo_origen === 'arriendo').length} arriendo`);\r\n\r\n            // 3. Calcular estad\u00EDsticas de los comparables (solo para informaci\u00F3n)\r\n            const promedioM2Ventas = calcularPromedioM2Ventas(comparables);\r\n            if (promedioM2Ventas) {\r\n                console.log(`\uD83D\uDCC8 Promedio precio/m\u00B2 ventas: ${promedioM2Ventas.toLocaleString()}`);\r\n\r\n                // Calcular rango de precios para referencia\r\n                const preciosM2Ventas = comparables\r\n                    .filter(c => c.tipo_origen === 'venta' && c.precio_m2)\r\n                    .map(c => c.precio_m2)\r\n                    .sort((a, b) => a - b);\r\n\r\n                if (preciosM2Ventas.length >= 2) {\r\n                    const minPrecioM2 = preciosM2Ventas[0];\r\n                    const maxPrecioM2 = preciosM2Ventas[preciosM2Ventas.length - 1];\r\n                    console.log(`\uD83C\uDFAF Rango precio/m\u00B2: ${minPrecioM2.toLocaleString()} - ${maxPrecioM2.toLocaleString()}`);\r\n                }\r\n            }\r\n\r\n            // 4. Calcular totales (coherentes con comparables mostrados)\r\n            const totalComparables = comparables.length;\r\n            const totalVenta = comparables.filter((c) => c.tipo_origen === 'venta').length;\r\n            const totalArriendo = comparables.filter((c) => c.tipo_origen === 'arriendo').length;\r\n\r\n            // 5. Procesar portales consultados\r\n            const portalesSet = new Set();\r\n            if (Array.isArray(extractedData.portales_consultados)) {\r\n                for (const p of extractedData.portales_consultados) {\r\n                    const dom = normalizarPortal(p);\r\n                    if (dom) portalesSet.add(dom);\r\n                }\r\n            }\r\n            const portales_consultados = Array.from(portalesSet);\r\n\r\n            // ==============================================\r\n            // RESULTADO FINAL - SIN FILTROS\r\n            // ==============================================\r\n\r\n            // Precio m\u00B2 usado: priorizar el que viene del an\u00E1lisis, luego el promedio calculado\r\n            const precioM2UsadoDirecto = sanitizeNumber(extractedData.precio_m2_usado);\r\n            const precioM2VentaDirecta = sanitizeNumber(extractedData.precio_m2_venta_directa);\r\n            const precioM2Final = precioM2UsadoDirecto || precioM2VentaDirecta || promedioM2Ventas;\r\n\r\n            // Yield del mercado\r\n            const yieldDelAnalisis = sanitizeNumber(extractedData.yield_mensual_mercado);\r\n            const yieldFinal = yieldDelAnalisis || yieldMercado;\r\n\r\n            // --- C\u00C1LCULOS DE RESPALDO (FALLBACKS) ---\r\n            // Si DeepSeek no devolvi\u00F3 los valores calculados, los calculamos aqu\u00ED.\r\n\r\n            // 1. Fallback Venta Directa\r\n            let valVentaDirecta = sanitizeNumber(extractedData.valor_estimado_venta_directa);\r\n            if (!valVentaDirecta && precioM2Final && areaConstruida) {\r\n                valVentaDirecta = Math.round(precioM2Final * areaConstruida);\r\n                console.log(`\uD83E\uDDEE Recalculando Valor Venta Directa: ${precioM2Final} * ${areaConstruida} = ${valVentaDirecta}`);\r\n            }\r\n\r\n            // 2. Fallback Rentabilidad\r\n            let valRentabilidad = sanitizeNumber(extractedData.valor_estimado_rentabilidad);\r\n            const canonPromedio = sanitizeNumber(extractedData.canon_arriendo_promedio);\r\n\r\n            if (!valRentabilidad && canonPromedio && yieldFinal) {\r\n                valRentabilidad = Math.round(canonPromedio / yieldFinal);\r\n                console.log(`\uD83E\uDDEE Recalculando Valor Rentabilidad: ${canonPromedio} / ${yieldFinal} = ${valRentabilidad}`);\r\n            }\r\n\r\n            // 3. Fallback Valor Final\r\n            let valFinal = sanitizeNumber(extractedData.valor_final);\r\n            if (!valFinal) {\r\n                if (valVentaDirecta && valRentabilidad) {\r\n                    valFinal = Math.round((valVentaDirecta + valRentabilidad) / 2);\r\n                } else {\r\n                    valFinal = valVentaDirecta || valRentabilidad;\r\n                }\r\n                console.log(`\uD83E\uDDEE Recalculando Valor Final: ${valFinal}`);\r\n            }\r\n\r\n            const resultado = {\r\n                resumen_busqueda:\r\n                    extractedData.resumen_busqueda ||\r\n                    'An\u00E1lisis completado a partir de comparables de venta y arriendo en el mercado local.',\r\n\r\n                valor_final: valFinal,\r\n\r\n                // TOTALES que reflejan TODOS los comparables\r\n                total_comparables: totalComparables,\r\n                total_comparables_venta: totalVenta,\r\n                total_comparables_arriendo: totalArriendo,\r\n                portales_consultados,\r\n\r\n                valor_estimado_venta_directa: valVentaDirecta,\r\n                precio_m2_venta_directa: precioM2VentaDirecta,\r\n                metodologia_venta_directa:\r\n                    extractedData.metodologia_venta_directa || null,\r\n\r\n                valor_estimado_rentabilidad: valRentabilidad,\r\n                canon_arriendo_promedio: canonPromedio,\r\n                metodologia_rentabilidad:\r\n                    extractedData.metodologia_rentabilidad || null,\r\n                yield_mensual_mercado: yieldFinal,\r\n\r\n                rango_valor_min: sanitizeNumber(extractedData.rango_valor_min),\r\n                rango_valor_max: sanitizeNumber(extractedData.rango_valor_max),\r\n\r\n                precio_m2_usado: precioM2Final,\r\n                metodo_calculo_m2: extractedData.metodo_calculo_m2 || null,\r\n                precio_m2_regional: sanitizeNumber(extractedData.precio_m2_regional),\r\n\r\n                ajustes_antiguedad: extractedData.ajustes_antiguedad || null,\r\n                ajustes_parqueadero: extractedData.ajustes_parqueadero || null,\r\n                limitaciones: extractedData.limitaciones || null,\r\n\r\n                comparables,\r\n                perplexity_full_text: perplexityContent,\r\n            };\r\n\r\n            console.log('\u2705 Resultado final generado:', {\r\n                comparables: resultado.comparables.length,\r\n                precio_m2_usado: resultado.precio_m2_usado,\r\n                totales_coherentes: resultado.total_comparables === resultado.comparables.length\r\n            });\r\n\r\n            return new Response(\r\n                JSON.stringify(resultado),\r\n                { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n\r\n        } catch (llmError) {\r\n            console.error('DeepSeek error:', llmError);\r\n            return new Response(\r\n                JSON.stringify({\r\n                    error: 'Error al extraer datos estructurados',\r\n                    details: llmError.message,\r\n                    perplexity_full_text: perplexityContent,\r\n                }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n    }\r\n};\r\n"],
  "mappings": "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",
  "names": ["yieldMercado"]
}
