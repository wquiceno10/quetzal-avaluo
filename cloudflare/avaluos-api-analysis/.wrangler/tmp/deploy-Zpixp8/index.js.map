{
  "version": 3,
  "sources": ["../../../src/index.js"],
  "sourceRoot": "D:\\Desktop\\Dise\u00F1o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\cloudflare\\avaluos-api-analysis\\.wrangler\\tmp\\deploy-Zpixp8",
  "sourcesContent": ["/**\r\n * avaluos-api-analysis V12 (Dynamic Prompt + Confidence V2)\r\n * - Prompts V12: Dynamic prompt loading (lotes OR propiedades), improved explanations\r\n * - Confidence V2: Weighted points system, CV dispersion, special cases\r\n * - Extracci\u00F3n estricta (V7 logic)\r\n * - Resumen conciso (V8 logic)\r\n * - Filtro IQR y Normalizaci\u00F3n (V10 logic)\r\n */\r\n\r\n\r\n// --- HELPER: Similitud de Texto (Levenshtein simplificado -> Ratio) ---\r\nfunction getSimilarity(s1, s2) {\r\n    if (!s1 || !s2) return 0;\r\n    const str1 = s1.toLowerCase().trim();\r\n    const str2 = s2.toLowerCase().trim();\r\n    if (str1 === str2) return 1;\r\n    if (str1.length === 0 || str2.length === 0) return 0;\r\n\r\n    const len1 = str1.length;\r\n    const len2 = str2.length;\r\n    const matrix = Array.from({ length: len1 + 1 }, () => Array(len2 + 1).fill(0));\r\n\r\n    for (let i = 0; i <= len1; i++) matrix[i][0] = i;\r\n    for (let j = 0; j <= len2; j++) matrix[0][j] = j;\r\n\r\n    for (let i = 1; i <= len1; i++) {\r\n        for (let j = 1; j <= len2; j++) {\r\n            const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;\r\n            matrix[i][j] = Math.min(\r\n                matrix[i - 1][j] + 1,\r\n                matrix[i][j - 1] + 1,\r\n                matrix[i - 1][j - 1] + cost\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\n// --- HELPER: Construcci\u00F3n Din\u00E1mica de Prompt Perplexity ---\r\n/**\r\n * Construye el prompt para Perplexity seg\u00FAn tipo de inmueble\r\n * Solo carga la secci\u00F3n relevante (lotes O propiedades) para ahorrar tokens\r\n * @param {Object} formData - Datos del formulario\r\n * @param {number} area - \u00C1rea del inmueble\r\n * @param {boolean} esLote - Si es lote o no\r\n * @param {string} usoLote - Uso del lote (comercial/residencial)\r\n * @param {string} ubicacion - Ubicaci\u00F3n completa (barrio, municipio)\r\n * @returns {string} Prompt completo optimizado\r\n */\r\nfunction construirPromptPerplexity(formData, area, esLote, usoLote, ubicacion) {\r\n    // --- SECCI\u00D3N BASE (COM\u00DAN PARA TODOS) ---\r\n    const infoInmueble = `\r\n- Tipo: ${formData.tipo_inmueble || 'inmueble'}\r\n${esLote ? `- Uso del Lote: ${usoLote}` : ''}\r\n- Ubicaci\u00F3n: ${ubicacion}\r\n${formData.nombre_conjunto ? `- Conjunto/Edificio: ${formData.nombre_conjunto}` : ''}\r\n${!esLote ? `- Habitaciones: ${formData.habitaciones || '?'}` : ''}\r\n${!esLote ? `- Ba\u00F1os: ${formData.banos || '?'}` : ''}\r\n${!esLote ? `- Parqueadero: ${formData.tipo_parqueadero || 'No indicado'}` : ''}\r\n${!esLote ? `- Antig\u00FCedad: ${formData.antiguedad || 'No indicada'}` : ''}\r\n${!esLote ? `- Estado: ${formData.estado_inmueble || 'No especificado'}` : ''}\r\n${!esLote && formData.tipo_remodelacion ? `- Remodelaci\u00F3n: ${formData.tipo_remodelacion} (${formData.valor_remodelacion || 'Valor no indicado'})` : ''}\r\n${!esLote && formData.descripcion_mejoras ? `- Mejoras: ${formData.descripcion_mejoras}` : ''}\r\n${formData.informacion_complementaria ? `- NOTAS ADICIONALES: ${formData.informacion_complementaria}` : ''}\r\n    `.trim();\r\n\r\n    const areaInstruction = area\r\n        ? `\r\n- \u00C1REA CONSTRUIDA: ${area} m\u00B2\r\n- Rango de \u00E1reas VENTA (Estricto): ${Math.round(area * 0.5)} a ${Math.round(area * 1.5)} m\u00B2 (\u00B150%)\r\n- SOLO incluye comparables de venta cuyas \u00E1reas est\u00E9n dentro de este rango. Para arriendos, intenta mantener el \u00E1rea similar, pero prioriza encontrar datos.`\r\n        : '';\r\n\r\n    const seccionBase = `\r\nEres un analista inmobiliario especializado en aval\u00FAos t\u00E9cnicos del mercado colombiano.\r\nTu objetivo es elaborar un **an\u00E1lisis completo, claro y profesional**, usando lenguaje \r\nsimple que un usuario sin conocimientos t\u00E9cnicos pueda entender.\r\n\r\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\nDATOS DEL INMUEBLE\r\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n${infoInmueble}\r\n${areaInstruction}\r\n\r\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\nINSTRUCCIONES GENERALES\r\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n\r\n**1. PRINCIPIO: NO INVENTES DATOS ESPEC\u00CDFICOS**\r\n   - Si encuentras listados reales en portales (Fincara\u00EDz, Metrocuadrado, Ciencuadras, etc.), \u00FAsalos.\r\n   - Si NO hay suficientes datos reales, PUEDES usar:\r\n     * Promedios estad\u00EDsticos del municipio/regi\u00F3n (d\u00E9jalo claro)\r\n     * Datos de zonas similares cercanas (especifica cu\u00E1l y por qu\u00E9)\r\n     * Valoraciones proporcionales (explica el m\u00E9todo en lenguaje simple)\r\n   - NUNCA inventes precios espec\u00EDficos de propiedades que no existan.\r\n\r\n**2. META DE COMPARABLES:**\r\n   - Ideal: 15-20 comparables totales\r\n   - M\u00EDnimo: 8-10 comparables\r\n\r\n**3. ETIQUETAS DE VALIDACI\u00D3N (OBLIGATORIAS):**\r\n   \r\n   Para cada comparable, asigna UNA de estas etiquetas:\r\n   \r\n   - **portal_verificado**: Listado real de portal inmobiliario.\r\n   \r\n   - **zona_similar**: Listado verificado de municipio/barrio cercano.\r\n     \u2192 OBLIGATORIO: Agrega NOTA explicando municipio, distancia aproximada, y raz\u00F3n de similitud.\r\n   \r\n   - **estimacion_zona**: Promedio estad\u00EDstico (solo si necesario para muestra m\u00EDnima).\r\n   \r\n   - **promedio_municipal**: Dato agregado municipal (\u00FAltimo recurso).\r\n\r\n**4. FORMATO DE LISTADO (ESTRICTO):**\r\n\r\n**[T\u00EDtulo descriptivo]**<br>\r\n[Tipo] | [Venta/Arriendo]<br>\r\n$[Precio con puntos] | [\u00C1rea] m\u00B2 | [Hab] hab | [Ba\u00F1os] ba\u00F1os<br>\r\n[Barrio] | [Ciudad]<br>\r\n**[Fuente: Nombre portal]**<br>\r\nfuente_validacion: [etiqueta]<br>\r\n[NOTA: Obligatoria si zona_similar - explicar contexto]\r\n\r\nEjemplo:\r\n\r\n**Lote urbano comercial en Circasia**<br>\r\nLote | Venta<br>\r\n$850.000.000 | 4200 m\u00B2 | - hab | - ba\u00F1os<br>\r\nCentro | Circasia<br>\r\n**Fincara\u00EDz**<br>\r\nfuente_validacion: zona_similar<br>\r\n**NOTA:** Circasia est\u00E1 a 8 km de ${formData.municipio || 'la zona objetivo'}. Se incluye por estar en el mismo corredor tur\u00EDstico, con caracter\u00EDsticas de uso comercial comparables.\r\n\r\n**5. CIFRAS:**\r\n   - SIEMPRE en pesos colombianos completos\r\n   - CON puntos para miles: $4.200.000 (NO 4.2M ni $4200000)\r\n\r\n**6. FORMATO FINAL:**\r\n   - Usa <br> para saltos de l\u00EDnea en listados\r\n   - NO incluyas URLs ni hiperv\u00EDnculos\r\n   - Responde en espa\u00F1ol\r\n   - NO devuelvas JSON\r\n    `.trim();\r\n\r\n    // --- SECCI\u00D3N ESPEC\u00CDFICA: LOTES ---\r\n    const seccionLotes = `\r\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\nINSTRUCCIONES ESPECIALES PARA LOTES\r\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n\r\n**1. B\u00DASQUEDA GEOGR\u00C1FICA AMPLIADA (OBLIGATORIO):**\r\n   \r\n   a) **ZONA PRIMARIA:** ${formData.municipio || 'el municipio objetivo'}\r\n      - Busca PRIMERO lotes en venta en este municipio.\r\n   \r\n   b) **ZONA SECUNDARIA** (si zona primaria tiene <5 lotes):\r\n      - Ampl\u00EDa a municipios del MISMO DEPARTAMENTO (${formData.departamento || 'departamento cercano'}).\r\n      - Prioriza municipios cercanos (radio ~30km).\r\n      - Ejemplos seg\u00FAn regi\u00F3n:\r\n        * Filandia \u2192 Circasia, Salento, Armenia, Calarc\u00E1, Quimbaya\r\n        * Pereira \u2192 Dosquebradas, La Virginia, Santa Rosa de Cabal, Marsella\r\n        * Armenia \u2192 Circasia, Calarc\u00E1, La Tebaida, Montenegro\r\n   \r\n   c) **ZONA TERCIARIA** (si a\u00FAn faltan datos):\r\n      - Lotes de la regi\u00F3n con caracter\u00EDsticas similares.\r\n      - Mismo uso (${usoLote}), estrato socioecon\u00F3mico similar.\r\n\r\n**2. VALORACI\u00D3N PROPORCIONAL - LENGUAJE SIMPLE (si aplica):**\r\n   \r\n   \u274C NUNCA digas solo: \"se aplic\u00F3 m\u00E9todo residual\"\r\n   \r\n   \u2705 SIEMPRE explica as\u00ED:\r\n   \r\n   \"Como los lotes en venta en ${formData.municipio || '[municipio]'} son escasos, complementamos \r\n   el an\u00E1lisis con propiedades construidas en la misma zona. Esto nos permite estimar \r\n   el valor del terreno, ya que t\u00EDpicamente un lote representa entre 25% y 40% del \r\n   valor total de una propiedad construida, dependiendo del uso y la ubicaci\u00F3n.\"\r\n   \r\n   Luego detalla:\r\n   - \u00BFQu\u00E9 propiedades construidas usaste como referencia?\r\n   - \u00BFQu\u00E9 porcentaje aplicaste y por qu\u00E9? (25%-40% seg\u00FAn caso)\r\n   - \u00BFC\u00F3mo ajustaste por caracter\u00EDsticas espec\u00EDficas?\r\n\r\n**3. OMITIR ARRIENDOS COMPLETAMENTE:**\r\n   - PROHIBIDO buscar o mencionar arriendos para lotes.\r\n   - PROHIBIDO calcular rentabilidad o yield.\r\n   - Solo an\u00E1lisis de VENTA directa.\r\n\r\n**4. FRASE FINAL OBLIGATORIA (en Resumen Ejecutivo):**\r\n   \r\n   \"Valor determinado mediante an\u00E1lisis comparativo del mercado regional de lotes, \r\n   complementado cuando fue necesario con valoraci\u00F3n proporcional de propiedades \r\n   construidas (m\u00E9todo que estima el valor del terreno como porcentaje del valor \r\n   total de construcciones similares en la zona).\"\r\n\r\n**5. TAREAS:**\r\n\r\n## 1. B\u00DASQUEDA Y SELECCI\u00D3N DE COMPARABLES\r\n\r\nPresenta un listado de **entre 15 a 20 comparables** SOLO en VENTA usando el formato especificado arriba.\r\n\r\n## 2. AN\u00C1LISIS DEL VALOR\r\n\r\n### 2.1. M\u00E9todo de Venta Directa (Precio por m\u00B2)\r\n- Calcula el valor promedio por m\u00B2 bas\u00E1ndote en los comparables de venta.\r\n- Indica el valor por m\u00B2 FINAL (ajustado por ubicaci\u00F3n, caracter\u00EDsticas, etc.).\r\n- Calcula: Precio por m\u00B2 final \u00D7 ${area || '\u00E1rea'} m\u00B2.\r\n\r\n## 3. RESULTADOS FINALES\r\n- **Valor Recomendado de Venta: $XXX.XXX.XXX**\r\n- **Rango sugerido: $XXX.XXX.XXX - $XXX.XXX.XXX**\r\n- Precio por m\u00B2 final usado\r\n- Posici\u00F3n en el mercado (liquidez)\r\n\r\n## 4. AJUSTES APLICADOS\r\nExplica ajustes por caracter\u00EDsticas espec\u00EDficas del lote.\r\n\r\n## 5. LIMITACIONES\r\nMenciona escasez de datos, dependencias de promedios o zonas similares.\r\n\r\n## 6. RESUMEN EJECUTIVO\r\n2-3 p\u00E1rrafos con valor recomendado, rango y estrategia de venta.\r\nINCLUYE la frase final obligatoria (ver punto 4 arriba).\r\n    `.trim();\r\n\r\n    // --- SECCI\u00D3N ESPEC\u00CDFICA: PROPIEDADES ---\r\n    const seccionPropiedades = `\r\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\nINSTRUCCIONES PARA PROPIEDADES (Apartamentos/Casas)\r\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n\r\n**1. B\u00DASQUEDA GEOGR\u00C1FICA ENFOCADA:**\r\n   \r\n   a) **ZONA PRIMARIA:** ${formData.barrio || ''}, ${formData.municipio || 'el municipio'}\r\n      - Prioriza comparables del MISMO BARRIO.\r\n      - Busca al menos 8-12 propiedades en venta.\r\n   \r\n   b) **ZONA SECUNDARIA** (complemento):\r\n      - Barrios adyacentes del mismo estrato socioecon\u00F3mico.\r\n   \r\n   c) **ARRIENDOS (OBLIGATORIO):**\r\n      - Busca AL MENOS 6 propiedades en arriendo en la misma zona.\r\n      - Necesitamos canon mensual para c\u00E1lculo de rentabilidad.\r\n\r\n**2. M\u00C9TODO DE RENTABILIDAD - C\u00C1LCULO CORRECTO:**\r\n   \r\n   **PASO 1: Canon Mensual Estimado**\r\n   - NO uses promedio simple de precios totales de arriendo.\r\n   - Calcula: Precio arriendo / \u00C1rea = Canon por m\u00B2\r\n   - Promedia los \"canon por m\u00B2\" de todos los arriendos.\r\n   - Multiplica: Canon promedio/m\u00B2 \u00D7 ${area || '\u00E1rea'} m\u00B2 = Canon Mensual Estimado\r\n   \r\n   **PASO 2: Yield del Mercado**\r\n   - Investiga el yield mensual REAL del mercado de ${formData.municipio || 'la zona'}.\r\n   - Busca datos de rentabilidad t\u00EDpica para ${formData.tipo_inmueble || 'apartamentos'}.\r\n   - Si encuentras datos espec\u00EDficos, \u00FAsalos.\r\n   - Si no, usa rangos conservadores (0.4% - 0.6% mensual).\r\n   \r\n   **IMPORTANTE:** Presenta el yield con formato EXACTO:\r\n   \"**Yield promedio mercado: 0.XX%**\" (ejemplo: 0.52%, 0.48%)\r\n   \r\n   **PASO 3: Valoraci\u00F3n**\r\n   - Valor estimado = Canon Mensual Estimado / Yield mensual promedio\r\n\r\n**3. TAREAS:**\r\n\r\n## 1. B\u00DASQUEDA Y SELECCI\u00D3N DE COMPARABLES\r\n\r\nPresenta **entre 15 a 20 comparables** (venta + arriendo) usando el formato especificado.\r\n- M\u00EDnimo 8-12 en VENTA\r\n- M\u00EDnimo 6 en ARRIENDO\r\n\r\n## 2. AN\u00C1LISIS DEL VALOR\r\n\r\n### 2.1. M\u00E9todo de Venta Directa (Precio por m\u00B2)\r\n- Calcula el valor promedio por m\u00B2 bas\u00E1ndote en comparables de venta.\r\n- Indica el valor por m\u00B2 FINAL (ajustado).\r\n- Calcula: Precio por m\u00B2 final \u00D7 ${area || '\u00E1rea'} m\u00B2.\r\n\r\n### 2.2. M\u00E9todo de Rentabilidad (Yield Mensual)\r\n- Sigue los 3 pasos descritos arriba.\r\n- Muestra el yield encontrado con formato exacto.\r\n\r\n## 3. RESULTADOS FINALES\r\n- **Valor Recomendado de Venta: $XXX.XXX.XXX**\r\n- **Rango sugerido: $XXX.XXX.XXX - $XXX.XXX.XXX**\r\n- Precio por m\u00B2 final\r\n- Posici\u00F3n en mercado\r\n\r\n## 4. AJUSTES APLICADOS\r\nExplica ajustes por antig\u00FCedad, estado, parqueadero, etc.\r\n\r\n## 5. LIMITACIONES\r\nMenciona escasez de datos o dependencias.\r\n\r\n## 6. RESUMEN EJECUTIVO\r\n2-3 p\u00E1rrafos con valor recomendado (ponderando venta + rentabilidad), rango y estrategia.\r\n    `.trim();\r\n\r\n    // --- ENSAMBLAR PROMPT FINAL ---\r\n    return `${seccionBase}\\n\\n${esLote ? seccionLotes : seccionPropiedades}`;\r\n}\r\n\r\nexport default {\r\n    async fetch(request, env) {\r\n        // --- CORS ---\r\n        const corsHeaders = {\r\n            'Access-Control-Allow-Origin': '*',\r\n            'Access-Control-Allow-Methods': 'POST, OPTIONS',\r\n            'Access-Control-Allow-Headers': 'Content-Type',\r\n        };\r\n\r\n        if (request.method === 'OPTIONS') {\r\n            return new Response(null, { headers: corsHeaders });\r\n        }\r\n\r\n        if (request.method !== 'POST') {\r\n            return new Response(\r\n                JSON.stringify({ error: 'Method not allowed' }),\r\n                { status: 405, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // --- BODY ---\r\n        let body;\r\n        try {\r\n            body = await request.json();\r\n        } catch (e) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'JSON inv\u00E1lido', details: e.message }),\r\n                { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        const { formData } = body || {};\r\n        if (!formData) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'formData es requerido' }),\r\n                { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        const PERPLEXITY_API_KEY = env.PERPLEXITY_API_KEY;\r\n        const DEEPSEEK_API_KEY = env.DEEPSEEK_API_KEY;\r\n\r\n        if (!PERPLEXITY_API_KEY || !DEEPSEEK_API_KEY) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'API keys no configuradas' }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // --- 1. PREPARACI\u00D3N DE DATOS (V9 LOGIC) ---\r\n        const tipoInmueble = (formData.tipo_inmueble || 'inmueble').toLowerCase();\r\n        const esLote = tipoInmueble === 'lote';\r\n        const usoLote = formData.uso_lote || 'residencial'; // Default a residencial si no viene\r\n        const ubicacion = `${formData.barrio || ''}, ${formData.municipio || ''}`.trim();\r\n\r\n        // Fallback de \u00E1rea\r\n        let areaBase = parseInt(formData.area_construida);\r\n        if (!Number.isFinite(areaBase) || areaBase <= 0) areaBase = 60;\r\n        const area = areaBase;\r\n\r\n        // --- CONSTRUCCI\u00D3N DEL PROMPT (V12 - DIN\u00C1MICO) ---\r\n        const perplexityPrompt = construirPromptPerplexity(\r\n            formData,\r\n            area,\r\n            esLote,\r\n            usoLote,\r\n            ubicacion\r\n        );\r\n\r\n\r\n        // --- 2. LLAMADA A PERPLEXITY (MODELO SONAR) ---\r\n        let perplexityContent = '';\r\n        let citations = [];\r\n\r\n        try {\r\n            const response = await fetch('https://api.perplexity.ai/chat/completions', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    Authorization: `Bearer ${PERPLEXITY_API_KEY}`,\r\n                },\r\n                body: JSON.stringify({\r\n                    model: 'sonar',\r\n                    messages: [\r\n                        { role: 'system', content: 'Eres un analista inmobiliario preciso y profesional.' },\r\n                        { role: 'user', content: perplexityPrompt },\r\n                    ],\r\n                    temperature: 0.1,\r\n                }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errText = await response.text();\r\n                return new Response(\r\n                    JSON.stringify({ error: `Error Perplexity (${response.status})`, details: errText }),\r\n                    { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n                );\r\n            }\r\n\r\n            const data = await response.json();\r\n            perplexityContent = data.choices?.[0]?.message?.content || '';\r\n            citations = data.citations || [];\r\n            console.log(`Perplexity completado. Fuentes: ${citations.length}`);\r\n\r\n        } catch (e) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'Error conexi\u00F3n Perplexity', details: e.message }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // --- 3. EXTRACCI\u00D3N ESTRUCTURADA CON DEEPSEEK ---\r\n        let extractedData = {};\r\n        let nivelConfianza = 'Medio'; // Default\r\n        let estadisticasComparables = {}; // Default\r\n\r\n        const extractionPrompt = `\r\nDel siguiente texto (que contiene listados y an\u00E1lisis), extrae un JSON estructurado.\r\n\r\nTEXTO:\r\n${perplexityContent}\r\n\r\nINSTRUCCIONES DE EXTRACCI\u00D3N:\r\n1. \"comparables\": Extrae CADA INMUEBLE del listado (formato multi-l\u00EDnea, NO tabla).\r\n   Cada comparable sigue este patr\u00F3n:\r\n   \r\n   **T\u00EDtulo**\r\n   Tipo | Venta/Arriendo\r\n   Precio | \u00C1rea | Habitaciones | Ba\u00F1os\r\n   Barrio | Ciudad\r\n   **Fuente**\r\n   \r\n   Extrae:\r\n   - \"titulo\": Texto entre ** ** de la primera l\u00EDnea (sin etiquetas HTML)\r\n   - \"tipo_inmueble\": Texto antes del | en la segunda l\u00EDnea (sin etiquetas HTML)\r\n   - \"tipo_operacion\": Texto despu\u00E9s del | en la segunda l\u00EDnea (\"Venta\" o \"Arriendo\")\r\n   - \"precio_lista\": N\u00FAmero ENTERO (sin puntos, sin comas, sin $) extra\u00EDdo de la tercera l\u00EDnea.\r\n   - \"area\": N\u00FAmero (puede tener decimales) antes de \"m\u00B2\" en la tercera l\u00EDnea.\r\n   - \"habitaciones\": N\u00FAmero antes de \"hab\" en la tercera l\u00EDnea\r\n   - \"banos\": N\u00FAmero antes de \"ba\u00F1os\" en la tercera l\u00EDnea\r\n   - \"barrio\": Texto antes del | en la cuarta l\u00EDnea (sin etiquetas HTML)\r\n   - \"ciudad\": Texto despu\u00E9s del | en la cuarta l\u00EDnea (sin etiquetas HTML)\r\n   - \"fuente\": Texto entre ** ** (usualmente antepen\u00FAltima l\u00EDnea)\r\n   - \"fuente_validacion\": Valor despu\u00E9s de \"fuente_validacion: \" (uno de: portal_verificado, estimacion_zona, zona_similar, promedio_municipal)\r\n   - \"nota_adicional\": Si existe una l\u00EDnea que empieza con \"NOTA:\", extrae el texto completo (opcional)\r\n\r\n   IMPORTANTE: \r\n   - Elimina cualquier etiqueta HTML (como <br>) de los valores extra\u00EDdos.\r\n   - Si NO encuentras el campo \"fuente_validacion\", asume \"portal_verificado\" por defecto.\r\n\r\n2. \"resumen_mercado\": Extrae un resumen conciso (m\u00E1ximo 2 p\u00E1rrafos) de la secci\u00F3n \"RESUMEN EJECUTIVO\". Prioriza la valoraci\u00F3n y la rentabilidad.\r\n\r\n3. \"nivel_confianza\": Busca en el texto la frase \"Nivel de confianza:\" y extrae el valor (Alto/Medio/Bajo). Si no existe, devuelve null.\r\n\r\n4. \"yield_zona\": ${esLote ? 'IGNORAR (Devolver null)' : 'Busca la frase exacta \"Yield promedio mercado: X.XX%\" en el texto. Extrae SOLO el n\u00FAmero como decimal (ej: si dice \"0.5%\", devuelve 0.005).'}\r\n\r\n5. \"valor_recomendado_venta\": Busca \"Valor Recomendado de Venta: $XXX.XXX.XXX\".\r\n   Extrae el n\u00FAmero ENTERO (elimina puntos y $).\r\n\r\n6. \"rango_sugerido_min\": Busca \"Rango sugerido: $XXX.XXX.XXX - $YYY.YYY.YYY\". Extrae el primer n\u00FAmero (ENTERO).\r\n\r\n7. \"rango_sugerido_max\": Extrae el segundo n\u00FAmero del rango sugerido (ENTERO).\r\n\r\n8. \"estadisticas_comparables\": Busca en secci\u00F3n 5 (LIMITACIONES) y extrae:\r\n   - \"porcentaje_datos_reales\": Si menciona \"X% de comparables son datos reales\", extrae el n\u00FAmero\r\n   - \"porcentaje_estimaciones\": Si menciona porcentaje de estimaciones, extrae el n\u00FAmero\r\n   - \"zonas_alternativas_usadas\": Array de strings con nombres de barrios/zonas alternativas mencionadas\r\n\r\nDevuelve SOLO JSON v\u00E1lido.\r\n        `.trim();\r\n\r\n\r\n        try {\r\n            const dsResponse = await fetch('https://api.deepseek.com/v1/chat/completions', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    Authorization: `Bearer ${DEEPSEEK_API_KEY}`,\r\n                },\r\n                body: JSON.stringify({\r\n                    model: 'deepseek-chat',\r\n                    messages: [\r\n                        { role: 'system', content: 'Eres un extractor JSON experto. Extrae numeros LIMPIOS (ej: 4200000, no 4.200.000).' },\r\n                        { role: 'user', content: extractionPrompt },\r\n                    ],\r\n                    temperature: 0.0,\r\n                }),\r\n            });\r\n\r\n            if (!dsResponse.ok) {\r\n                const errDs = await dsResponse.text();\r\n                return new Response(\r\n                    JSON.stringify({ error: `Error DeepSeek (${dsResponse.status})`, details: errDs }),\r\n                    { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n                );\r\n            }\r\n\r\n            const dsData = await dsResponse.json();\r\n            let content = dsData.choices?.[0]?.message?.content || '{}';\r\n\r\n            // Limpieza Markdown\r\n            content = content.trim();\r\n            if (content.startsWith('```')) {\r\n                const match = content.match(/```(?:json)?\\s*([\\s\\S]*?)```/i);\r\n                if (match && match[1]) content = match[1].trim();\r\n            }\r\n\r\n            extractedData = JSON.parse(content);\r\n            if (!extractedData || typeof extractedData !== 'object') extractedData = {};\r\n\r\n            // Procesar nivel_confianza y estad\u00EDsticas (ahora asignamos a variables ya declaradas)\r\n            nivelConfianza = extractedData.nivel_confianza || 'Medio';\r\n            estadisticasComparables = extractedData.estadisticas_comparables || {};\r\n\r\n            console.log(`Nivel de confianza: ${nivelConfianza}`);\r\n            if (estadisticasComparables.porcentaje_datos_reales) {\r\n                console.log(`Datos reales: ${estadisticasComparables.porcentaje_datos_reales}%`);\r\n            }\r\n\r\n        } catch (e) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'Error Parseo DeepSeek', details: e.message }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // --- 4. PROCESAMIENTO Y L\u00D3GICA DE NEGOCIO ---\r\n        // GLOBAL TRY-CATCH: Captura CUALQUIER error no manejado\r\n        try {\r\n            // Helpers robustos para parseo\r\n            const sanitizePrice = (n) => {\r\n                if (typeof n === 'number') return Number.isFinite(n) ? n : null;\r\n                if (typeof n === 'string') {\r\n                    const clean = n.replace(/\\D/g, '');\r\n                    const val = parseInt(clean, 10);\r\n                    return (Number.isFinite(val) && val > 0) ? val : null;\r\n                }\r\n                return null;\r\n            };\r\n\r\n            const sanitizeFloat = (n) => {\r\n                if (typeof n === 'number') return Number.isFinite(n) ? n : null;\r\n                if (typeof n === 'string') {\r\n                    const clean = n.replace(',', '.').replace(/[^\\d.]/g, '');\r\n                    const val = parseFloat(clean);\r\n                    return Number.isFinite(val) ? val : null;\r\n                }\r\n                return null;\r\n            };\r\n\r\n            const yieldDefault = 0.005;  // 0.5% mensual (6% anual) - solo fallback\r\n            const yieldExtracted = sanitizeFloat(extractedData.yield_zona);\r\n            const yieldFinal = yieldExtracted || yieldDefault;\r\n            console.log(`Yield usado: ${(yieldFinal * 100).toFixed(2)}% mensual (${yieldExtracted ? 'extra\u00EDdo de mercado' : 'fallback'})`);\r\n            const yieldFuente = yieldExtracted ? 'mercado' : 'fallback';\r\n\r\n            // Portales\r\n            const portalesUnicos = new Set(\r\n                citations.map((url) => {\r\n                    try {\r\n                        return new URL(url).hostname.replace('www.', '').replace('.com.co', '').replace('.com', '');\r\n                    } catch { return null; }\r\n                }).filter(Boolean)\r\n            );\r\n            const portalesList = Array.from(portalesUnicos);\r\n            if (portalesList.length === 0) portalesList.push('fincaraiz', 'metrocuadrado');\r\n\r\n            // Procesamiento de Comparables (SIN HEUR\u00CDSTICA)\r\n            const comparablesRaw = Array.isArray(extractedData.comparables) ? extractedData.comparables : [];\r\n            const comparables = comparablesRaw\r\n                .map((c) => {\r\n                    const areaComp = sanitizeFloat(c.area);\r\n                    const precioLista = sanitizePrice(c.precio_lista);\r\n\r\n                    const esArriendo = c.tipo_operacion && typeof c.tipo_operacion === 'string' && c.tipo_operacion.toLowerCase().includes('arriendo');\r\n\r\n                    // SI ES LOTE, IGNORAR ARRIENDOS\r\n                    if (esLote && esArriendo) return null;\r\n\r\n                    let precioVentaEstimado = 0;\r\n                    let precioM2 = 0;\r\n\r\n                    if (esArriendo) {\r\n                        // Arriendo -> Capitalizaci\u00F3n\r\n                        if (precioLista && yieldFinal > 0) {\r\n                            precioVentaEstimado = Math.round(precioLista / yieldFinal);\r\n                        }\r\n                        if (precioVentaEstimado && areaComp) {\r\n                            precioM2 = Math.round(precioVentaEstimado / areaComp);\r\n                        }\r\n                    } else {\r\n                        // Venta -> Directo\r\n                        precioVentaEstimado = precioLista || 0;\r\n                        if (precioVentaEstimado && areaComp) {\r\n                            precioM2 = Math.round(precioVentaEstimado / areaComp);\r\n                        }\r\n                    }\r\n\r\n\r\n                    const comparable = {\r\n                        titulo: c.titulo || 'Inmueble',\r\n                        tipo_origen: esArriendo ? 'arriendo' : 'venta',\r\n                        tipo_inmueble: c.tipo_inmueble || tipoInmueble,\r\n                        barrio: c.barrio || c.ubicacion || formData.barrio,\r\n                        municipio: c.ciudad || formData.municipio,\r\n                        area_m2: areaComp,\r\n                        habitaciones: sanitizeFloat(c.habitaciones),\r\n                        banos: sanitizeFloat(c.banos),\r\n\r\n                        precio_publicado: precioLista,\r\n                        precio_cop: precioVentaEstimado,\r\n                        precio_m2: precioM2,\r\n                        yield_mensual: esArriendo ? yieldFinal : null,\r\n\r\n                        fuente_validacion: c.fuente_validacion || 'portal_verificado',\r\n                        nota_adicional: c.nota_adicional || null\r\n                    };\r\n\r\n                    // Logging interno para verificaci\u00F3n (no se env\u00EDa al frontend)\r\n                    const notaSafe = comparable.nota_adicional ? String(comparable.nota_adicional) : '';\r\n                    console.log(`[${comparable.titulo}] Validaci\u00F3n: ${comparable.fuente_validacion}${notaSafe ? ' | Nota: ' + notaSafe.substring(0, 50) : ''}`);\r\n\r\n                    return comparable;\r\n                })\r\n                .filter((c) => c && c.precio_cop > 0 && c.area_m2 > 0);\r\n\r\n            // Validaci\u00F3n M\u00EDnima\r\n            if (comparables.length < 5) {\r\n                return new Response(\r\n                    JSON.stringify({\r\n                        error: 'Datos insuficientes',\r\n                        details: `Solo se encontraron ${comparables.length} comparables v\u00E1lidos.`,\r\n                        perplexity_full_text: perplexityContent,\r\n                    }),\r\n                    { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n                );\r\n            }\r\n\r\n            // C\u00E1lculos Finales\r\n            const compsVenta = comparables.filter((c) => c.tipo_origen === 'venta');\r\n            const compsArriendo = comparables.filter((c) => c.tipo_origen === 'arriendo');\r\n\r\n            // 1. Venta Directa (CON PODA DE OUTLIERS)\r\n            let valorVentaDirecta = null;\r\n            let precioM2Promedio = 0;\r\n\r\n            if (compsVenta.length > 0) {\r\n                const sortedByM2 = [...compsVenta].sort((a, b) => a.precio_m2 - b.precio_m2);\r\n                // Poda del 10%\r\n                let filteredComps = sortedByM2;\r\n                if (sortedByM2.length >= 5) {\r\n                    const cut = Math.floor(sortedByM2.length * 0.1);\r\n                    filteredComps = sortedByM2.slice(cut, sortedByM2.length - cut);\r\n                }\r\n\r\n                const sumM2 = filteredComps.reduce((acc, c) => acc + c.precio_m2, 0);\r\n                precioM2Promedio = Math.round(sumM2 / filteredComps.length);\r\n                valorVentaDirecta = Math.round(precioM2Promedio * area);\r\n            }\r\n\r\n            // 2. Rentabilidad\r\n            let valorRentabilidad = null;\r\n            let canonPromedio = 0;\r\n\r\n            if (!esLote) {\r\n                if (compsArriendo.length > 0) {\r\n                    const sumCanon = compsArriendo.reduce((acc, c) => acc + c.precio_publicado, 0);\r\n                    canonPromedio = Math.round(sumCanon / compsArriendo.length);\r\n                    valorRentabilidad = Math.round(canonPromedio / yieldFinal);\r\n                } else {\r\n                    if (valorVentaDirecta) {\r\n                        valorRentabilidad = valorVentaDirecta;\r\n                        canonPromedio = Math.round(valorVentaDirecta * yieldFinal);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // 3. Valor Recomendado Perplexity\r\n            const valorRecomendado = sanitizePrice(extractedData.valor_recomendado_venta);\r\n\r\n            let valorPonderado = null;\r\n            if (esLote) {\r\n                valorPonderado = valorVentaDirecta;\r\n            } else {\r\n                valorPonderado = (valorVentaDirecta && valorRentabilidad && compsArriendo.length > 0)\r\n                    ? Math.round(valorVentaDirecta * 0.6 + valorRentabilidad * 0.4)\r\n                    : null;\r\n            }\r\n\r\n            const valorFinal = valorRecomendado || valorVentaDirecta || valorRentabilidad || 0;\r\n            const valorFuente = valorRecomendado ? 'perplexity' : 'calculado';\r\n\r\n            // Correcci\u00F3n Lotes\r\n            if (esLote && valorRecomendado) {\r\n                valorVentaDirecta = valorRecomendado;\r\n                precioM2Promedio = Math.round(valorRecomendado / area);\r\n            }\r\n\r\n            console.log(`Valor final: $${valorFinal.toLocaleString()} (fuente: ${valorFuente})`);\r\n\r\n            const precioM2Usado = precioM2Promedio || (valorFinal > 0 ? Math.round(valorFinal / area) : 0);\r\n\r\n            // 4. Rangos\r\n            const rangoMin = sanitizePrice(extractedData.rango_sugerido_min) || Math.round(valorFinal * 1.00);\r\n            const rangoMax = sanitizePrice(extractedData.rango_sugerido_max) || Math.round(valorFinal * 1.04);\r\n            const rangoFuente = extractedData.rango_sugerido_min ? 'perplexity' : 'calculado';\r\n\r\n            // --- 5. DEDUPLICACI\u00D3N Y FILTRADO (V10) ---\r\n            const uniqueComparables = [];\r\n            for (const comp of comparables) {\r\n                const isDuplicate = uniqueComparables.some(existing => {\r\n                    const precioBaseExisting = existing.precio_cop || existing.precio_publicado || 0;\r\n                    const precioBaseComp = comp.precio_cop || comp.precio_publicado || 0;\r\n                    const areaBaseExisting = existing.area_m2 || 0;\r\n                    const areaBaseComp = comp.area_m2 || 0;\r\n\r\n                    const priceMatch = precioBaseExisting > 0\r\n                        ? Math.abs(precioBaseExisting - precioBaseComp) / precioBaseExisting < 0.01\r\n                        : false;\r\n                    const areaMatch = areaBaseExisting > 0\r\n                        ? Math.abs(areaBaseExisting - areaBaseComp) / areaBaseExisting < 0.01\r\n                        : false;\r\n                    const titleSim = getSimilarity(existing.titulo, comp.titulo);\r\n\r\n                    return priceMatch && areaMatch && titleSim >= 0.7;\r\n                });\r\n                if (!isDuplicate) uniqueComparables.push(comp);\r\n            }\r\n\r\n            // Filtro Area\r\n            let comparablesFiltradosPorArea = uniqueComparables;\r\n            if (!esLote || area <= 1000) {\r\n                comparablesFiltradosPorArea = uniqueComparables.filter(c => {\r\n                    const a = c.area_m2 || 0;\r\n                    return a >= area * 0.5 && a <= area * 1.5;\r\n                });\r\n            }\r\n\r\n            // Filtro Lote Grande (Estricto con Fallback)\r\n            let comparablesParaTabla = comparablesFiltradosPorArea;\r\n            if (esLote && area > 1000) {\r\n                // Filtro primario: \u00B150% (est\u00E1ndar de la industria para lotes)\r\n                const filtradosEstrictos = uniqueComparables.filter(c => {\r\n                    const a = c.area_m2 || 0;\r\n                    return a >= area * 0.5 && a <= area * 1.5;\r\n                });\r\n\r\n                // Si hay suficientes comparables (\u22655), usar filtro estricto\r\n                if (filtradosEstrictos.length >= 5) {\r\n                    comparablesParaTabla = filtradosEstrictos;\r\n                } else {\r\n                    // Fallback: \u00B170% para mercados con poca oferta\r\n                    const filtradosRelajados = uniqueComparables.filter(c => {\r\n                        const a = c.area_m2 || 0;\r\n                        return a >= area * 0.3 && a <= area * 1.7;\r\n                    });\r\n                    comparablesParaTabla = filtradosRelajados.length >= 3\r\n                        ? filtradosRelajados\r\n                        : uniqueComparables; // \u00DAltimo recurso: usar todos y dejar que IQR filtre\r\n                }\r\n            }\r\n\r\n            // D) FILTRO IQR (New V10 Logic)\r\n            if (comparablesParaTabla.length >= 5) {\r\n                const preciosM2 = comparablesParaTabla.map(c => c.precio_m2).filter(p => p > 0).sort((a, b) => a - b);\r\n                if (preciosM2.length >= 4) {\r\n                    const q1Index = Math.floor(preciosM2.length * 0.25);\r\n                    const q3Index = Math.floor(preciosM2.length * 0.75);\r\n                    const q1 = preciosM2[q1Index];\r\n                    const q3 = preciosM2[q3Index];\r\n                    const iqr = q3 - q1;\r\n                    const minThreshold = q1 - iqr * 1.5;\r\n                    const maxThreshold = q3 + iqr * 1.5;\r\n\r\n                    const filtradosIQR = comparablesParaTabla.filter(c =>\r\n                        c.precio_m2 >= minThreshold && c.precio_m2 <= maxThreshold\r\n                    );\r\n\r\n                    if (filtradosIQR.length >= 5) {\r\n                        console.log(`Filtro IQR aplicado.`);\r\n                        comparablesParaTabla = filtradosIQR;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Normalizaci\u00F3n Nombres\r\n            comparablesParaTabla = comparablesParaTabla.map(c => {\r\n                let fuente = c.fuente || 'Portal Inmobiliario';\r\n                if (typeof fuente === 'string') {\r\n                    fuente = fuente.replace(/Clencuadras/i, 'Ciencuadras')\r\n                        .replace(/Fincaraiz/i, 'FincaRa\u00EDz')\r\n                        .replace(/MetroCuadrado/i, 'Metrocuadrado')\r\n                        .replace(/Mercadolibre/i, 'MercadoLibre');\r\n                }\r\n                return { ...c, fuente };\r\n            });\r\n\r\n            // Sincronizaci\u00F3n de Conteos\r\n            const totalReal = comparablesParaTabla.length;\r\n            const totalVenta = comparablesParaTabla.filter(c => c.tipo_origen === 'venta').length;\r\n            const totalArriendo = comparablesParaTabla.filter(c => c.tipo_origen === 'arriendo').length;\r\n\r\n            let finalPerplexityText = perplexityContent || '';\r\n            // Reemplazar frases naturales\r\n            finalPerplexityText = finalPerplexityText.replace(/(presentan|listado de|encontraron|selecci\u00F3n de)\\s+(\\d+)\\s+(comparables|inmuebles|propiedades)/gi, `$1 ${totalReal} $3`);\r\n            // Eliminar literal \"total_comparables: X\" (no debe ser visible)\r\n            finalPerplexityText = finalPerplexityText.replace(/total_comparables:\\s*\\d+/gi, '');\r\n\r\n            let resumenFinal = extractedData.resumen_mercado || 'An\u00E1lisis de mercado realizado.';\r\n            resumenFinal = resumenFinal.replace(/(presentan|listado de|encontraron|selecci\u00F3n de)\\s+(\\d+)\\s+(comparables|inmuebles|propiedades)/gi, `$1 ${totalReal} $3`);\r\n\r\n            // --- C\u00C1LCULO AUTOM\u00C1TICO DEL NIVEL DE CONFIANZA ---\r\n            // Protecci\u00F3n: Si no hay comparables, nivel = Bajo\r\n            if (!comparablesParaTabla || comparablesParaTabla.length === 0) {\r\n                const nivelConfianzaDetalle = {\r\n                    fuente: 'calculado',\r\n                    nivel_llm: extractedData.nivel_confianza || null,\r\n                    total_comparables: 0,\r\n                    porcentaje_reales: 0,\r\n                    total_zonas_alternativas: 0,\r\n                    dispersion_alta: false\r\n                };\r\n\r\n                const resultado = {\r\n                    resumen_busqueda: resumenFinal,\r\n                    valor_final: valorFinal,\r\n                    valor_fuente: valorFuente,\r\n                    valor_ponderado_referencia: valorPonderado,\r\n                    rango_valor_min: rangoMin,\r\n                    rango_valor_max: rangoMax,\r\n                    rango_fuente: rangoFuente,\r\n                    valor_estimado_venta_directa: valorVentaDirecta,\r\n                    valor_estimado_rentabilidad: valorRentabilidad,\r\n                    precio_m2_final: precioM2Usado,\r\n                    metodo_mercado_label: 'Enfoque de Mercado (promedio real)',\r\n                    metodo_ajuste_label: valorRecomendado ? 'Ajuste de Perplexity (criterio t\u00E9cnico)' : 'Promedio de Mercado',\r\n                    comparables: [],\r\n                    total_comparables: 0,\r\n                    total_comparables_venta: 0,\r\n                    total_comparables_arriendo: 0,\r\n                    nivel_confianza: 'Bajo',\r\n                    nivel_confianza_detalle: nivelConfianzaDetalle,\r\n                    estadisticas_fuentes: {\r\n                        total_portal_verificado: 0,\r\n                        total_estimacion_zona: 0,\r\n                        total_zona_similar: 0,\r\n                        total_promedio_municipal: 0,\r\n                    },\r\n                    ficha_tecnica_defaults: {\r\n                        habitaciones: 'No especificado',\r\n                        banos: 'No especificado',\r\n                        garajes: 'No especificado',\r\n                        estrato: 'No especificado',\r\n                        antiguedad: 'No especificado'\r\n                    },\r\n                    yield_mensual_mercado: esLote ? null : yieldFinal,\r\n                    area_construida: area,\r\n                    perplexity_full_text: finalPerplexityText\r\n                };\r\n\r\n                return new Response(JSON.stringify(resultado), {\r\n                    headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n                });\r\n            }\r\n\r\n            // ========================================\r\n            // C\u00C1LCULO DE NIVEL DE CONFIANZA V2\r\n            // Sistema de puntos ponderados + casos especiales\r\n            // ========================================\r\n\r\n            // Verificar que esLote est\u00E1 definido\r\n            console.assert(typeof esLote === 'boolean', 'esLote debe estar definido');\r\n\r\n            const total = comparablesParaTabla.length;\r\n\r\n            // --- PASO 1: CLASIFICAR COMPARABLES POR CALIDAD ---\r\n            const totalVerificados = comparablesParaTabla.filter(\r\n                c => c.fuente_validacion === 'portal_verificado'\r\n            ).length;\r\n\r\n            const totalZonasSimilares = comparablesParaTabla.filter(\r\n                c => c.fuente_validacion === 'zona_similar'\r\n            ).length;\r\n\r\n            const totalEstimacionZona = comparablesParaTabla.filter(\r\n                c => c.fuente_validacion === 'estimacion_zona'\r\n            ).length;\r\n\r\n            const totalPromedioMunicipal = comparablesParaTabla.filter(\r\n                c => c.fuente_validacion === 'promedio_municipal'\r\n            ).length;\r\n\r\n            // Suma total de estimaciones (para l\u00F3gica de penalizaci\u00F3n)\r\n            const totalEstimaciones = totalEstimacionZona + totalPromedioMunicipal;\r\n\r\n            // Compatibilidad con frontend (alias)\r\n            const totalZonasAlternas = totalZonasSimilares + totalPromedioMunicipal;\r\n\r\n            console.log(`Clasificaci\u00F3n: ${totalVerificados} verificados, ${totalZonasSimilares} zonas similares, ${totalEstimaciones} estimaciones`);\r\n\r\n            // --- PASO 2: SISTEMA DE PUNTOS PONDERADOS ---\r\n            // Cada tipo de fuente tiene un \"peso\" de calidad\r\n            let puntosConfianza = 0;\r\n\r\n            puntosConfianza += totalVerificados * 3;      // Datos reales valen m\u00E1s\r\n            puntosConfianza += totalZonasSimilares * 2;   // Zonas similares son buenas (especialmente lotes)\r\n            puntosConfianza += totalEstimaciones * 1;     // Estimaciones cuentan menos\r\n\r\n            // Normalizar: promedio de calidad por comparable\r\n            const promedioCalidad = total > 0 ? puntosConfianza / total : 0;\r\n            console.log(`Promedio calidad: ${promedioCalidad.toFixed(2)} (max: 3.0)`);\r\n\r\n            // --- PASO 3: PENALIZACI\u00D3N POR DISPERSI\u00D3N (CV 80%) ---\r\n            let dispersionAlta = false;\r\n            let cvDispersion = 0;\r\n            const preciosM2Validos = comparablesParaTabla\r\n                .map(c => c.precio_m2)\r\n                .filter(v => typeof v === 'number' && v > 0);\r\n\r\n            if (preciosM2Validos.length >= 2) {\r\n                const max = Math.max(...preciosM2Validos);\r\n                const min = Math.min(...preciosM2Validos);\r\n                cvDispersion = (max - min) / ((max + min) / 2); // Coeficiente de variaci\u00F3n simplificado\r\n                dispersionAlta = cvDispersion > 0.8; // 80% de variaci\u00F3n\r\n                console.log(`Dispersi\u00F3n CV: ${(cvDispersion * 100).toFixed(1)}% ${dispersionAlta ? '(ALTA)' : '(normal)'}`);\r\n            }\r\n\r\n            const factorDispersion = dispersionAlta ? 0.7 : 1.0; // Penalizaci\u00F3n 30% si hay alta dispersi\u00F3n\r\n\r\n            // --- PASO 4: PUNTUACI\u00D3N FINAL ---\r\n            const puntuacionFinal = promedioCalidad * factorDispersion;\r\n            console.log(`Puntuaci\u00F3n final: ${puntuacionFinal.toFixed(2)}`);\r\n\r\n            // --- PASO 5: CRITERIOS DE NIVEL ---\r\n            let nivelConfianzaCalc = 'Bajo';\r\n\r\n            if (puntuacionFinal >= 2.2 && total >= 8 && !dispersionAlta) {\r\n                // Alto: Datos mayormente verificados, muestra suficiente, baja dispersi\u00F3n\r\n                nivelConfianzaCalc = 'Alto';\r\n            } else if (puntuacionFinal >= 1.8 && total >= 6) {\r\n                // Medio: Mix de verificados y zonas similares, muestra aceptable\r\n                nivelConfianzaCalc = 'Medio';\r\n            } else if (puntuacionFinal >= 1.3 && total >= 5) {\r\n                // Medio-Bajo: Pocas fuentes verificadas pero suficientes para referencia\r\n                nivelConfianzaCalc = 'Medio';\r\n            } else {\r\n                // Bajo: Muy pocos datos o demasiadas estimaciones\r\n                nivelConfianzaCalc = 'Bajo';\r\n            }\r\n\r\n            // --- PASO 6: CASOS ESPECIALES ---\r\n\r\n            // CASO A: Lotes con buena cobertura regional\r\n            if (esLote && totalZonasSimilares >= 4 && totalVerificados >= 2 && total >= 7) {\r\n                // Para lotes, las zonas similares son VALIOSAS (mercado m\u00E1s homog\u00E9neo regionalmente)\r\n                if (nivelConfianzaCalc === 'Bajo') {\r\n                    nivelConfianzaCalc = 'Medio';\r\n                    console.log('\u2191 Ajuste lotes: Bajo \u2192 Medio (buena cobertura regional)');\r\n                }\r\n            }\r\n\r\n            // CASO B: Propiedades con zona muy espec\u00EDfica (hiperlocales)\r\n            if (!esLote && totalVerificados >= 5 && totalZonasSimilares === 0 && total >= 6) {\r\n                // Apartamentos/casas con datos solo del barrio objetivo (muy confiable)\r\n                if (nivelConfianzaCalc === 'Medio' && !dispersionAlta) {\r\n                    nivelConfianzaCalc = 'Alto';\r\n                    console.log('\u2191 Ajuste propiedades: Medio \u2192 Alto (datos hiperlocales)');\r\n                }\r\n            }\r\n\r\n            // CASO C: Penalizaci\u00F3n por exceso de estimaciones\r\n            if (totalEstimaciones > total * 0.5) {\r\n                // M\u00E1s del 50% son estimaciones \u2192 Bajar nivel\r\n                if (nivelConfianzaCalc === 'Alto') {\r\n                    nivelConfianzaCalc = 'Medio';\r\n                    console.log('\u2193 Penalizaci\u00F3n: Alto \u2192 Medio (muchas estimaciones)');\r\n                } else if (nivelConfianzaCalc === 'Medio' && totalEstimaciones > total * 0.7) {\r\n                    nivelConfianzaCalc = 'Bajo';\r\n                    console.log('\u2193 Penalizaci\u00F3n: Medio \u2192 Bajo (mayor\u00EDa estimaciones)');\r\n                }\r\n            }\r\n\r\n            console.log(`\u2713 Nivel de confianza final: ${nivelConfianzaCalc}`);\r\n\r\n            // --- PASO 7: METADATA DETALLADA ---\r\n            const nivelConfianzaLLM = extractedData.nivel_confianza || null;\r\n            const ratioReal = total > 0 ? totalVerificados / total : 0;\r\n\r\n            const nivelConfianzaDetalle = {\r\n                fuente: 'calculado_v2', // Versi\u00F3n del algoritmo\r\n                nivel_llm: nivelConfianzaLLM, // Guardamos lo que dijo Perplexity (informativo)\r\n\r\n                // M\u00E9tricas principales\r\n                total_comparables: total,\r\n                porcentaje_reales: total > 0 ? Math.round((totalVerificados / total) * 100) : 0,\r\n\r\n                // Desglose de fuentes (separado para claridad)\r\n                total_portal_verificado: totalVerificados,\r\n                total_zona_similar: totalZonasSimilares,\r\n                total_estimacion_zona: totalEstimacionZona,\r\n                total_promedio_municipal: totalPromedioMunicipal,\r\n\r\n                // Compatibilidad con frontend actual\r\n                total_zonas_alternativas: totalZonasAlternas,\r\n\r\n                // Indicadores de calidad (NUEVOS)\r\n                puntuacion_calidad: parseFloat(promedioCalidad.toFixed(2)),\r\n                puntuacion_final: parseFloat(puntuacionFinal.toFixed(2)),\r\n                dispersion_alta: dispersionAlta,\r\n                cv_dispersion: parseFloat(cvDispersion.toFixed(3)),\r\n\r\n                // Contexto\r\n                es_lote: esLote,\r\n                zonas_alternativas_positivas: totalZonasSimilares > 0\r\n            };\r\n\r\n            const resultado = {\r\n                resumen_busqueda: resumenFinal,\r\n                valor_final: valorFinal,\r\n                valor_fuente: valorFuente,\r\n                valor_ponderado_referencia: valorPonderado,\r\n                rango_valor_min: rangoMin,\r\n                rango_valor_max: rangoMax,\r\n                rango_fuente: rangoFuente,\r\n\r\n                valor_estimado_venta_directa: valorVentaDirecta,\r\n                valor_estimado_rentabilidad: valorRentabilidad,\r\n\r\n                // ERROR 2\r\n                precio_m2_final: precioM2Usado,\r\n\r\n                // ERROR 3\r\n                metodo_mercado_label: 'Enfoque de Mercado (promedio real)',\r\n                metodo_ajuste_label: valorRecomendado ? 'Ajuste de Perplexity (criterio t\u00E9cnico)' : 'Promedio de Mercado',\r\n\r\n                comparables: comparablesParaTabla,\r\n                total_comparables: comparablesParaTabla.length,\r\n                total_comparables_venta: totalVenta,\r\n                total_comparables_arriendo: totalArriendo,\r\n\r\n                // Nivel de confianza y estad\u00EDsticas de fuentes (V11 - Calculado)\r\n                nivel_confianza: nivelConfianzaCalc,\r\n                nivel_confianza_detalle: nivelConfianzaDetalle,\r\n                estadisticas_fuentes: {\r\n                    total_portal_verificado: comparablesParaTabla.filter(c => c.fuente_validacion === 'portal_verificado').length,\r\n                    total_estimacion_zona: comparablesParaTabla.filter(c => c.fuente_validacion === 'estimacion_zona').length,\r\n                    total_zona_similar: comparablesParaTabla.filter(c => c.fuente_validacion === 'zona_similar').length,\r\n                    total_promedio_municipal: comparablesParaTabla.filter(c => c.fuente_validacion === 'promedio_municipal').length,\r\n                },\r\n\r\n                // ERROR 1: Defaults\r\n                ficha_tecnica_defaults: {\r\n                    habitaciones: 'No especificado',\r\n                    banos: 'No especificado',\r\n                    garajes: 'No especificado',\r\n                    estrato: 'No especificado',\r\n                    antiguedad: 'No especificado'\r\n                },\r\n\r\n                yield_mensual_mercado: esLote ? null : yieldFinal,\r\n                area_construida: area,\r\n                perplexity_full_text: finalPerplexityText\r\n            };\r\n\r\n            return new Response(JSON.stringify(resultado), {\r\n                headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n            });\r\n\r\n        } catch (processingError) {\r\n            // GLOBAL CATCH: Captura CUALQUIER error no manejado en el procesamiento\r\n            console.error('Error cr\u00EDtico en procesamiento:', processingError);\r\n            return new Response(\r\n                JSON.stringify({\r\n                    error: 'Error interno en procesamiento',\r\n                    details: processingError.message || 'Error desconocido',\r\n                    stack: processingError.stack || null\r\n                }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n    },\r\n};"],
  "mappings": "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",
  "names": ["nivelConfianzaDetalle", "resultado"]
}
