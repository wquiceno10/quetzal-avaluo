{
  "version": 3,
  "sources": ["../../../src/index.js"],
  "sourceRoot": "D:\\Desktop\\Dise\u00F1o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\cloudflare\\avaluos-api-analysis\\.wrangler\\tmp\\deploy-3z2PQu",
  "sourcesContent": ["/**\r\n * avaluos-api-analysis V5 (Hybrid & Robust + Optimizations)\r\n * Cloudflare Worker para an\u00E1lisis de mercado con Perplexity + DeepSeek\r\n */\r\nconsole.log(\"Deploy V5.1 (Optimized) - \" + new Date().toISOString());\r\n\r\nexport default {\r\n    async fetch(request, env) {\r\n        // --- CORS ---\r\n        const corsHeaders = {\r\n            'Access-Control-Allow-Origin': '*',\r\n            'Access-Control-Allow-Methods': 'POST, OPTIONS',\r\n            'Access-Control-Allow-Headers': 'Content-Type',\r\n        };\r\n\r\n        if (request.method === 'OPTIONS') {\r\n            return new Response(null, { headers: corsHeaders });\r\n        }\r\n\r\n        if (request.method !== 'POST') {\r\n            return new Response(\r\n                JSON.stringify({ error: 'Method not allowed' }),\r\n                { status: 405, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // --- BODY ---\r\n        let body;\r\n        try {\r\n            body = await request.json();\r\n        } catch (e) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'JSON inv\u00E1lido', details: e.message }),\r\n                { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        const { formData } = body || {};\r\n        if (!formData) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'formData es requerido' }),\r\n                { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        const PERPLEXITY_API_KEY = env.PERPLEXITY_API_KEY;\r\n        const DEEPSEEK_API_KEY = env.DEEPSEEK_API_KEY;\r\n\r\n        if (!PERPLEXITY_API_KEY || !DEEPSEEK_API_KEY) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'API keys no configuradas' }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // --- 1. CONSTRUCCI\u00D3N DEL PROMPT PARA PERPLEXITY ---\r\n        const tipoInmueble = formData.tipo_inmueble || 'inmueble';\r\n        const ubicacion = `${formData.barrio || ''}, ${formData.municipio || ''}`.trim();\r\n\r\n        // Fallback de \u00E1rea para evitar NaN\r\n        let areaBase = parseInt(formData.area_construida);\r\n        if (!Number.isFinite(areaBase) || areaBase <= 0) {\r\n            areaBase = 60; // Fallback sensato\r\n        }\r\n        const area = areaBase;\r\n\r\n        const minArea = Math.round(area * 0.7);\r\n        const maxArea = Math.round(area * 1.3);\r\n\r\n        const perplexityPrompt = `\r\nAct\u00FAa como tasador inmobiliario experto en Colombia.\r\nBusca inmuebles en VENTA y ARRIENDO en: ${ubicacion} (${tipoInmueble}).\r\nObjetivo: \u00C1rea ${area}m\u00B2, ${formData.habitaciones || '?'} habs.\r\n\r\nREQUISITOS DE B\u00DASQUEDA:\r\n1. Filtro de \u00C1rea: ${minArea}m\u00B2 a ${maxArea}m\u00B2.\r\n2. Cantidad: M\u00EDnimo 15 comparables. Intenta que el 20-30% sean ARRIENDOS.\r\n3. Fuentes: Portales reales (Fincaraiz, Metrocuadrado, Ciencuadras, etc.).\r\n4. Si escasean datos en el barrio exacto, busca en barrios vecinos del mismo estrato.\r\n\r\nFORMATO DE RESPUESTA:\r\nGenera una lista detallada. Para cada inmueble especifica:\r\n- T\u00EDtulo y Ubicaci\u00F3n.\r\n- Operaci\u00F3n: VENTA o ARRIENDO.\r\n- Precio de Lista (El valor total si es venta, o el canon mensual si es arriendo).\r\n- \u00C1rea, Habitaciones, Ba\u00F1os.\r\n\r\nAL FINAL, ESCRIBE UN \"RESUMEN EJECUTIVO\" DE 2-3 P\u00C1RRAFOS QUE INCLUYA:\r\n- Precio promedio por m\u00B2 encontrado en el mercado\r\n- Yield (rentabilidad) estimado del sector\r\n- Nivel de oferta disponible (abundante/escasa/moderada)\r\n- Recomendaci\u00F3n de precio de publicaci\u00F3n para el propietario\r\n- Principales factores que afectan el valor (ubicaci\u00F3n, estado, amenidades)\r\n        `.trim();\r\n\r\n        // --- 2. LLAMADA A PERPLEXITY (MODELO R\u00C1PIDO) ---\r\n        let perplexityContent = '';\r\n        let citations = [];\r\n\r\n        try {\r\n            const response = await fetch('https://api.perplexity.ai/chat/completions', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    Authorization: `Bearer ${PERPLEXITY_API_KEY}`,\r\n                },\r\n                body: JSON.stringify({\r\n                    model: 'sonar', // Modelo r\u00E1pido y efectivo\r\n                    messages: [\r\n                        { role: 'system', content: 'Eres un motor de b\u00FAsqueda inmobiliaria preciso.' },\r\n                        { role: 'user', content: perplexityPrompt },\r\n                    ],\r\n                    temperature: 0.1,\r\n                    max_tokens: 8000,\r\n                }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errText = await response.text();\r\n                console.error('Perplexity API error:', response.status, errText);\r\n                return new Response(\r\n                    JSON.stringify({ error: `Error Perplexity (${response.status})`, details: errText }),\r\n                    { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n                );\r\n            }\r\n\r\n            const data = await response.json();\r\n            perplexityContent = data.choices?.[0]?.message?.content || '';\r\n            citations = data.citations || [];\r\n            console.log(`Perplexity completado. Fuentes: ${citations.length}, Chars: ${perplexityContent.length}`);\r\n\r\n        } catch (e) {\r\n            console.error('Perplexity request failed:', e);\r\n            return new Response(\r\n                JSON.stringify({ error: 'Error conexi\u00F3n Perplexity', details: e.message }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        if (!perplexityContent) {\r\n            return new Response(\r\n                JSON.stringify({ error: 'Perplexity devolvi\u00F3 respuesta vac\u00EDa' }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // --- 3. EXTRACCI\u00D3N ESTRUCTURADA CON DEEPSEEK ---\r\n        const extractionPrompt = `\r\nDel siguiente texto (que puede contener tablas Markdown o listas), extrae un JSON con los comparables y el an\u00E1lisis.\r\n\r\nTEXTO:\r\n${perplexityContent}\r\n\r\nINSTRUCCIONES PARA TABLAS MARKDOWN:\r\nSi el texto contiene una tabla (ej: | T\u00EDtulo | Precio | ...), procesa cada fila como un comparable.\r\n- Columna \"Precio\" o \"Precio (COP)\" -> \"precio_lista\" (elimina signos $ y comas).\r\n- Columna \"Operaci\u00F3n\" -> \"tipo_operacion\" (\"venta\" o \"arriendo\").\r\n- Columna \"\u00C1rea\" -> \"area\".\r\n\r\nREGLAS DE EXTRACCI\u00D3N:\r\n1. \"precio_lista\": El n\u00FAmero EXACTO. \r\n   - Si es ARRIENDO (ej: \"$1,250,000 / mes\"), extrae solo el n\u00FAmero (1250000).\r\n   - Si es VENTA, el valor total.\r\n2. \"tipo_operacion\": \"venta\" o \"arriendo\".\r\n3. \"yield_zona\": Extrae el % de rentabilidad si se menciona.\r\n4. \"resumen_mercado\": Extrae el RESUMEN EJECUTIVO completo.\r\n\r\nIMPORTANTE: Extrae TODOS los comparables de la tabla/lista.\r\n\r\nDevuelve SOLO JSON v\u00E1lido.\r\n        `.trim();\r\n\r\n        let extractedData = {};\r\n        try {\r\n            const dsResponse = await fetch('https://api.deepseek.com/v1/chat/completions', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    Authorization: `Bearer ${DEEPSEEK_API_KEY}`,\r\n                },\r\n                body: JSON.stringify({\r\n                    model: 'deepseek-chat',\r\n                    messages: [\r\n                        {\r\n                            role: 'system',\r\n                            content: 'Eres un extractor JSON estricto. Responde SOLO con el objeto JSON, sin bloques de c\u00F3digo markdown.',\r\n                        },\r\n                        { role: 'user', content: extractionPrompt },\r\n                    ],\r\n                    temperature: 0.0,\r\n                }),\r\n            });\r\n\r\n            if (!dsResponse.ok) {\r\n                const errDs = await dsResponse.text();\r\n                console.error('DeepSeek API error:', dsResponse.status, errDs);\r\n                return new Response(\r\n                    JSON.stringify({ error: `Error DeepSeek (${dsResponse.status})`, details: errDs }),\r\n                    { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n                );\r\n            }\r\n\r\n            const dsData = await dsResponse.json();\r\n            let content = dsData.choices?.[0]?.message?.content || '{}';\r\n\r\n            // Limpieza defensiva de Markdown\r\n            content = content.trim();\r\n            if (content.startsWith('```')) {\r\n                const match = content.match(/```(?:json)?\\s*([\\s\\S]*?)```/i);\r\n                if (match && match[1]) {\r\n                    content = match[1].trim();\r\n                }\r\n            }\r\n\r\n            extractedData = JSON.parse(content);\r\n            console.log('DeepSeek extraction successful');\r\n\r\n        } catch (e) {\r\n            console.error('DeepSeek parsing error:', e);\r\n            return new Response(\r\n                JSON.stringify({ error: 'Error Parseo DeepSeek', details: e.message }),\r\n                { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        // --- 4. PROCESAMIENTO Y L\u00D3GICA DE AVAL\u00DAO (Metodolog\u00EDa Dual) ---\r\n        const sanitizeNumber = (n) => (typeof n === 'number' && Number.isFinite(n) ? n : null);\r\n\r\n        // a. Determinar Yield del Mercado\r\n        const yieldDefault = 0.0055; // 0.55%\r\n        const yieldExtracted = sanitizeNumber(extractedData.yield_zona);\r\n        const yieldFinal = yieldExtracted || yieldDefault;\r\n\r\n        // b. Procesar Portales (Limpiar URLs a Dominios)\r\n        const portalesUnicos = new Set(\r\n            citations\r\n                .map((url) => {\r\n                    try {\r\n                        return new URL(url).hostname.replace('www.', '').replace('.com.co', '').replace('.com', '');\r\n                    } catch {\r\n                        return null;\r\n                    }\r\n                })\r\n                .filter(Boolean)\r\n        );\r\n        const portalesList = Array.from(portalesUnicos);\r\n        if (portalesList.length === 0) {\r\n            portalesList.push('fincaraiz', 'metrocuadrado'); // Fallback\r\n        }\r\n\r\n        // c. Normalizar Comparables\r\n        const comparables = (extractedData.comparables || [])\r\n            .map((c) => {\r\n                const areaComp = sanitizeNumber(c.area);\r\n                const precioLista = sanitizeNumber(c.precio_lista);\r\n                const esArriendo = c.tipo_operacion?.toLowerCase().includes('arriendo');\r\n\r\n                let precioVentaEstimado = 0; // Capital\r\n                let precioM2 = 0; // Normalizado a Venta\r\n\r\n                if (esArriendo) {\r\n                    // METODOLOG\u00CDA RENTABILIDAD: Capital = Canon / Yield\r\n                    if (precioLista && yieldFinal > 0) {\r\n                        precioVentaEstimado = Math.round(precioLista / yieldFinal);\r\n                    }\r\n                    if (precioVentaEstimado && areaComp) {\r\n                        precioM2 = Math.round(precioVentaEstimado / areaComp);\r\n                    }\r\n                } else {\r\n                    // METODOLOG\u00CDA MERCADO: Capital = Precio Lista\r\n                    precioVentaEstimado = precioLista || 0;\r\n                    if (precioVentaEstimado && areaComp) {\r\n                        precioM2 = Math.round(precioVentaEstimado / areaComp);\r\n                    }\r\n                }\r\n\r\n                return {\r\n                    titulo: c.titulo || 'Inmueble',\r\n                    tipo_origen: esArriendo ? 'arriendo' : 'venta',\r\n                    barrio: c.ubicacion || formData.barrio,\r\n                    municipio: formData.municipio,\r\n                    area_m2: areaComp,\r\n                    habitaciones: sanitizeNumber(c.habitaciones),\r\n                    banos: sanitizeNumber(c.banos),\r\n\r\n                    // FRONTEND DATA\r\n                    precio_publicado: precioLista, // Lo que se ve (Canon o Venta)\r\n                    precio_cop: precioVentaEstimado, // Valor Capital (para c\u00E1lculos)\r\n                    precio_m2: precioM2, // $/m\u00B2 Homogeneizado\r\n                    yield_mensual: esArriendo ? yieldFinal : null,\r\n                };\r\n            })\r\n            .filter((c) => c.precio_cop > 0 && c.area_m2 > 0);\r\n\r\n        // Validaci\u00F3n de comparables m\u00EDnimos\r\n        if (comparables.length < 5) {\r\n            return new Response(\r\n                JSON.stringify({\r\n                    error: 'Datos insuficientes',\r\n                    details: `Se encontraron solo ${comparables.length} comparables v\u00E1lidos (m\u00EDnimo 5 requeridos)`,\r\n                    perplexity_full_text: perplexityContent,\r\n                }),\r\n                { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }\r\n            );\r\n        }\r\n\r\n        console.log(`Comparables procesados: ${comparables.length}`);\r\n\r\n        // d. C\u00E1lculos Estad\u00EDsticos Separados\r\n        const compsVenta = comparables.filter((c) => c.tipo_origen === 'venta');\r\n        const compsArriendo = comparables.filter((c) => c.tipo_origen === 'arriendo');\r\n\r\n        // 1. Enfoque Venta Directa ($/m\u00B2 promedio * \u00E1rea)\r\n        let valorVentaDirecta = null;\r\n        let precioM2Promedio = 0;\r\n        if (compsVenta.length > 0) {\r\n            const sumM2 = compsVenta.reduce((acc, c) => acc + c.precio_m2, 0);\r\n            precioM2Promedio = Math.round(sumM2 / compsVenta.length);\r\n            valorVentaDirecta = Math.round(precioM2Promedio * area);\r\n        }\r\n\r\n        // 2. Enfoque Rentabilidad (Canon promedio / yield)\r\n        let valorRentabilidad = null;\r\n        let canonPromedio = 0;\r\n        if (compsArriendo.length > 0) {\r\n            const sumCanon = compsArriendo.reduce((acc, c) => acc + c.precio_publicado, 0);\r\n            canonPromedio = Math.round(sumCanon / compsArriendo.length);\r\n            valorRentabilidad = Math.round(canonPromedio / yieldFinal);\r\n        } else {\r\n            // Fallback: Si no hay arriendos, estimamos canon con el yield inverso\r\n            if (valorVentaDirecta) {\r\n                valorRentabilidad = valorVentaDirecta;\r\n                canonPromedio = Math.round(valorVentaDirecta * yieldFinal);\r\n            }\r\n        }\r\n\r\n        // 3. Valor Final Ponderado\r\n        let valorFinal = 0;\r\n\r\n        if (valorVentaDirecta && valorRentabilidad && compsArriendo.length > 0) {\r\n            // 60% Venta (m\u00E1s directo), 40% Rentabilidad (inferido)\r\n            valorFinal = Math.round(valorVentaDirecta * 0.6 + valorRentabilidad * 0.4);\r\n        } else {\r\n            valorFinal = valorVentaDirecta || valorRentabilidad || 0;\r\n        }\r\n\r\n        // Fallback final de seguridad para precio m2 usado\r\n        const precioM2Usado = precioM2Promedio || (valorFinal > 0 ? Math.round(valorFinal / area) : 0);\r\n\r\n        console.log(`Valores calculados - Final: ${valorFinal}, Venta: ${valorVentaDirecta}, Rentabilidad: ${valorRentabilidad}`);\r\n\r\n        // --- 5. RESPUESTA FINAL ---\r\n        const resultado = {\r\n            resumen_busqueda: extractedData.resumen_mercado || 'An\u00E1lisis de mercado basado en oferta disponible.',\r\n\r\n            valor_final: valorFinal,\r\n            rango_valor_min: Math.round(valorFinal * 0.95),\r\n            rango_valor_max: Math.round(valorFinal * 1.05),\r\n\r\n            // Metodolog\u00EDa Venta\r\n            valor_estimado_venta_directa: valorVentaDirecta,\r\n            precio_m2_usado: precioM2Usado,\r\n\r\n            // Metodolog\u00EDa Rentabilidad\r\n            valor_estimado_rentabilidad: valorRentabilidad,\r\n            canon_arriendo_promedio: canonPromedio,\r\n            yield_mensual_mercado: yieldFinal,\r\n\r\n            // Estad\u00EDsticas\r\n            total_comparables: comparables.length,\r\n            total_comparables_venta: compsVenta.length,\r\n            total_comparables_arriendo: compsArriendo.length,\r\n            portales_consultados: portalesList,\r\n\r\n            comparables: comparables,\r\n            perplexity_full_text: perplexityContent,\r\n        };\r\n\r\n        return new Response(JSON.stringify(resultado), {\r\n            headers: { ...corsHeaders, 'Content-Type': 'application/json' },\r\n        });\r\n    },\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
