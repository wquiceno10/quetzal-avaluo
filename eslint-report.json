[{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\components\\avaluo\\BotonPDF.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react/prop-types","severity":2,"message":"'formData' is missing in props validation","line":6,"column":32,"nodeType":"Property","messageId":"missingPropType","endLine":6,"endColumn":40},{"ruleId":"react/prop-types","severity":2,"message":"'formData.tipo_inmueble' is missing in props validation","line":10,"column":32,"nodeType":"Identifier","messageId":"missingPropType","endLine":10,"endColumn":45},{"ruleId":"react/prop-types","severity":2,"message":"'formData.area_construida' is missing in props validation","line":26,"column":40,"nodeType":"Identifier","messageId":"missingPropType","endLine":26,"endColumn":55},{"ruleId":"no-unused-vars","severity":2,"message":"'fecha' is assigned a value but never used.","line":45,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"fecha"},"fix":{"range":[2025,2164],"text":""},"desc":"Remove unused variable 'fecha'."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":126,"column":90,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":126,"endColumn":91,"suggestions":[{"messageId":"removeEscape","fix":{"range":[5378,5379],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[5378,5378],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\,.","line":126,"column":92,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":126,"endColumn":93,"suggestions":[{"messageId":"removeEscape","fix":{"range":[5380,5381],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[5380,5380],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":131,"column":44,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":131,"endColumn":45,"suggestions":[{"messageId":"removeEscape","fix":{"range":[5565,5566],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[5565,5565],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"react/prop-types","severity":2,"message":"'formData.tipo_inmueble' is missing in props validation","line":630,"column":33,"nodeType":"Identifier","messageId":"missingPropType","endLine":630,"endColumn":46},{"ruleId":"react/prop-types","severity":2,"message":"'formData.habitaciones' is missing in props validation","line":636,"column":34,"nodeType":"Identifier","messageId":"missingPropType","endLine":636,"endColumn":46},{"ruleId":"react/prop-types","severity":2,"message":"'formData.banos' is missing in props validation","line":639,"column":33,"nodeType":"Identifier","messageId":"missingPropType","endLine":639,"endColumn":38},{"ruleId":"react/prop-types","severity":2,"message":"'formData.tipo_inmueble' is missing in props validation","line":645,"column":33,"nodeType":"Identifier","messageId":"missingPropType","endLine":645,"endColumn":46},{"ruleId":"react/prop-types","severity":2,"message":"'formData.uso_lote' is missing in props validation","line":651,"column":33,"nodeType":"Identifier","messageId":"missingPropType","endLine":651,"endColumn":41},{"ruleId":"react/prop-types","severity":2,"message":"'formData.tipo_inmueble' is missing in props validation","line":740,"column":55,"nodeType":"Identifier","messageId":"missingPropType","endLine":740,"endColumn":68},{"ruleId":"react/prop-types","severity":2,"message":"'formData.barrio' is missing in props validation","line":744,"column":55,"nodeType":"Identifier","messageId":"missingPropType","endLine":744,"endColumn":61},{"ruleId":"react/prop-types","severity":2,"message":"'formData.municipio' is missing in props validation","line":744,"column":82,"nodeType":"Identifier","messageId":"missingPropType","endLine":744,"endColumn":91},{"ruleId":"react/prop-types","severity":2,"message":"'formData.ciudad' is missing in props validation","line":744,"column":104,"nodeType":"Identifier","messageId":"missingPropType","endLine":744,"endColumn":110},{"ruleId":"react/prop-types","severity":2,"message":"'formData.habitaciones' is missing in props validation","line":757,"column":55,"nodeType":"Identifier","messageId":"missingPropType","endLine":757,"endColumn":67},{"ruleId":"react/prop-types","severity":2,"message":"'formData.banos' is missing in props validation","line":761,"column":55,"nodeType":"Identifier","messageId":"missingPropType","endLine":761,"endColumn":60},{"ruleId":"react/prop-types","severity":2,"message":"'formData.estrato' is missing in props validation","line":765,"column":55,"nodeType":"Identifier","messageId":"missingPropType","endLine":765,"endColumn":62},{"ruleId":"react/prop-types","severity":2,"message":"'formData.estado_inmueble' is missing in props validation","line":771,"column":37,"nodeType":"Identifier","messageId":"missingPropType","endLine":771,"endColumn":52},{"ruleId":"react/prop-types","severity":2,"message":"'formData.estado' is missing in props validation","line":771,"column":65,"nodeType":"Identifier","messageId":"missingPropType","endLine":771,"endColumn":71},{"ruleId":"react/prop-types","severity":2,"message":"'formData.uso_lote' is missing in props validation","line":781,"column":55,"nodeType":"Identifier","messageId":"missingPropType","endLine":781,"endColumn":63}],"suppressedMessages":[],"errorCount":23,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { forwardRef } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Download, Loader2 } from 'lucide-react';\r\nimport { useMutation } from '@tanstack/react-query';\r\n\r\nconst BotonPDF = forwardRef(({ formData }, ref) => {\r\n  const generatePDFMutation = useMutation({\r\n    mutationFn: async (data) => {\r\n      const comparablesData = data.comparables_data || {};\r\n      const esLote = (formData.tipo_inmueble || '').toLowerCase().includes('lote');\r\n\r\n      // C√°lculos de valores (Prioridad a datos de backend V10)\r\n      const valorVentaDirecta = comparablesData.valor_estimado_venta_directa;\r\n      const valorRentabilidad = comparablesData.valor_estimado_rentabilidad;\r\n      const rangoMin = comparablesData.rango_valor_min;\r\n      const rangoMax = comparablesData.rango_valor_max;\r\n\r\n      let valorEstimadoFinal = comparablesData.valor_final;\r\n      if (!valorEstimadoFinal) {\r\n        if (rangoMin && rangoMax) valorEstimadoFinal = (rangoMin + rangoMax) / 2;\r\n        else if (valorVentaDirecta && valorRentabilidad) valorEstimadoFinal = (valorVentaDirecta * 0.8 + valorRentabilidad * 0.2);\r\n        else valorEstimadoFinal = valorVentaDirecta || valorRentabilidad;\r\n      }\r\n\r\n      // √Årea\r\n      const area = parseFloat(formData.area_construida || comparablesData.area_construida || 0);\r\n\r\n      const precioM2 =\r\n        comparablesData.precio_m2_final ||\r\n        comparablesData.precio_m2_usado ||\r\n        comparablesData.precio_m2_venta_directa ||\r\n        (valorEstimadoFinal && area ? valorEstimadoFinal / area : 0);\r\n\r\n      const defaults = comparablesData.ficha_tecnica_defaults || {};\r\n      const comparables = comparablesData.comparables || [];\r\n\r\n      const totalComparables =\r\n        comparablesData.comparables_usados_en_calculo ||\r\n        comparablesData.total_comparables ||\r\n        comparables.length;\r\n\r\n      const totalEncontrados = comparablesData.comparables_totales_encontrados;\r\n      const yieldMensual = comparablesData.yield_mensual_mercado;\r\n\r\n      const fecha = new Date().toLocaleDateString('es-CO', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric'\r\n      });\r\n\r\n      // Formateadores\r\n      const formatCurrency = (val) =>\r\n        val ? '$ ' + Math.round(val).toLocaleString('es-CO') : '‚Äî';\r\n\r\n      const formatNumber = (val) =>\r\n        val ? Math.round(val).toLocaleString('es-CO') : '‚Äî';\r\n\r\n      // Helpers para badges de fuente_validacion\r\n      const getBadgeClass = (validation) => {\r\n        switch (validation) {\r\n          case 'portal_verificado': return 'success';\r\n          case 'estimacion_zona': return 'info';\r\n          case 'zona_similar': return 'warning';\r\n          case 'promedio_municipal': return 'secondary';\r\n          default: return 'default';\r\n        }\r\n      };\r\n\r\n      const getFuenteLabel = (validation) => {\r\n        switch (validation) {\r\n          case 'portal_verificado': return '‚úì Verificado';\r\n          case 'estimacion_zona': return '~ Est. Zona';\r\n          case 'zona_similar': return '‚Üí Zona Similar';\r\n          case 'promedio_municipal': return '‚âà Prom. Mun.';\r\n          default: return 'Dato';\r\n        }\r\n      };\r\n\r\n      // Helper para generar tablas HTML con estilos\r\n      const generateTableHtml = (rows) => {\r\n        if (!rows.length) return '';\r\n        const htmlRows = rows.map((row, i) => {\r\n          const cells = row.split('|').filter(c => c.trim() !== '');\r\n          if (cells.length === 0) return '';\r\n          const tag = i === 0 ? 'th' : 'td';\r\n          const style = i === 0\r\n            ? 'style=\"background:#F0ECD9; font-weight:600; padding:8px; text-align:left; border-bottom:1px solid #ddd; color:#2C3D37;\"'\r\n            : 'style=\"padding:8px; border-bottom:1px solid #f0f0f0; text-align:center; color:#4F5B55;\"';\r\n          const inner = cells.map(c => `<${tag} ${style}>${c.trim()}</${tag}>`).join('');\r\n          return `<tr>${inner}</tr>`;\r\n        }).join('');\r\n        return `\r\n          <div style=\"overflow-x:auto; margin:15px 0; border:1px solid #E0E5E2; border-radius:8px; background:#fff;\">\r\n            <table style=\"width:100%; border-collapse:collapse; font-size:11px;\">\r\n              <tbody>${htmlRows}</tbody>\r\n            </table>\r\n          </div>\r\n        `;\r\n      };\r\n\r\n      const formatText = (text) => {\r\n        if (!text) return '';\r\n\r\n        // 1. Limpieza Inicial (Artefactos y LaTeX) - Sincronizado con Step3Results\r\n        let cleanText = text\r\n          // Eliminar l√≠neas horizontales MD (reforzado)\r\n          .replace(/^-{3,}\\s*$/gm, '')\r\n          .replace(/^[ \\t]*[-_]{2,}[ \\t]*$/gm, '')\r\n          // Eliminar saltos de l√≠nea excesivos\r\n          .replace(/\\n{3,}/g, '\\n\\n')\r\n          // Limpiar LaTeX b√°sico\r\n          .replace(/\\\\\\(/g, '')\r\n          .replace(/\\\\\\)/g, '')\r\n          .replace(/\\\\\\[/g, '')\r\n          .replace(/\\\\\\]/g, '')\r\n          .replace(/\\\\text\\{([^}]+)\\}/g, '$1')\r\n          // LaTeX \\frac con soporte de espacios\r\n          .replace(/\\\\frac\\s*\\{([^{}]+)\\}\\s*\\{([^{}]+)\\}/g, '$1 / $2')\r\n          .replace(/\\\\sum/g, '‚àë')\r\n          .replace(/\\\\approx/g, '‚âà')\r\n          // Limpiar unidades duplicadas\r\n          .replace(/\\s+COP\\/m¬≤/g, ' COP/m¬≤');\r\n\r\n        // Normalizar \"Promedio precio...\"\r\n        cleanText = cleanText.replace(\r\n          /Promedio precio por m¬≤\\s*=\\s*(?:\\\\frac\\{[^{}]+\\}\\{[^{}]+\\}|[^\\n‚âà]+)\\s*‚âà\\s*([\\d\\.\\,]+)\\s*COP\\/m¬≤/gi,\r\n          'Promedio precio por m¬≤ ‚âà $1 COP/m¬≤'\r\n        );\r\n\r\n        // Limpiar t√≠tulos numerados (1. T√≠tulo ‚Üí T√≠tulo)\r\n        cleanText = cleanText.replace(/^[\\d\\.]+\\s+(?=[A-Z])/gm, '');\r\n\r\n        // 2. Detectar y Formatear Tablas Markdown\r\n        const lines = cleanText.split('\\n');\r\n        let newLines = [];\r\n        let inTable = false;\r\n        let tableRows = [];\r\n\r\n        lines.forEach(line => {\r\n          const trimmed = line.trim();\r\n          if (trimmed.startsWith('|')) {\r\n            if (!inTable) inTable = true;\r\n            if (!trimmed.includes('---')) {\r\n              tableRows.push(trimmed);\r\n            }\r\n          } else {\r\n            if (inTable) {\r\n              newLines.push(generateTableHtml(tableRows));\r\n              tableRows = [];\r\n              inTable = false;\r\n            }\r\n            newLines.push(line);\r\n          }\r\n        });\r\n        if (inTable) {\r\n          newLines.push(generateTableHtml(tableRows));\r\n        }\r\n\r\n        cleanText = newLines.join('\\n');\r\n\r\n        // 3. Convertir markdown a HTML con estilos mejorados\r\n        return cleanText\r\n          // Negritas (asegurar que cierra)\r\n          .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\r\n          // Encabezados MD \"# T√≠tulo\" o \"#### T√≠tulo\"\r\n          .replace(\r\n            /^#+\\s*(.*?)$/gm,\r\n            '<h4 style=\"font-size:13px; margin:16px 0 8px 0; color:#2C3D37; font-weight:700; border-bottom:1px solid #C9C19D; padding-bottom:4px;\">$1</h4>'\r\n          )\r\n          // Listas\r\n          .replace(\r\n            /^\\s*[-*‚Ä¢]\\s+(.*?)$/gm,\r\n            '<li style=\"margin-left:18px; font-size:11px; margin-bottom:6px; color:#4F5B55; line-height:1.2;\">$1</li>'\r\n          )\r\n          // P√°rrafos (l√≠neas sueltas que no son tags HTML)\r\n          .replace(\r\n            /^(?!<(h4|li|table|div|strong))(.+)$/gm,\r\n            '<p style=\"font-size:11px; line-height:1.2; margin:8px 0; text-align:justify; color:#4F5B55;\">$2</p>'\r\n          );\r\n      };\r\n\r\n      // -----------------------------------------------------------------------------------\r\n      // HTML DEL REPORTE\r\n      // -----------------------------------------------------------------------------------\r\n\r\n      const htmlContent = `\r\n        <!DOCTYPE html>\r\n        <html lang=\"es\">\r\n        <head>\r\n          <meta charset=\"UTF-8\">\r\n          <title>Reporte de Aval√∫o - Quetzal H√°bitats</title>\r\n\r\n          <style>\r\n            @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Raleway:wght@300;400;500;600&display=swap');\r\n\r\n            /* CONFIGURACI√ìN DE P√ÅGINA: Sin headers/footers */\r\n            body {\r\n              font-family: 'Outfit', sans-serif;\r\n              font-size: 13px;\r\n              margin: 0;\r\n              padding: 0;\r\n              background: white;\r\n              color: #2C3D37;\r\n            }\r\n\r\n            .container {\r\n              max-width: 960px;\r\n              margin: 0 auto;\r\n              padding: 0;\r\n            }\r\n\r\n            @media print {\r\n              @page {\r\n                margin: 20mm 15mm 20mm 15mm;\r\n                size: letter;\r\n              }\r\n              body {\r\n                -webkit-print-color-adjust: exact !important;\r\n                print-color-adjust: exact !important;\r\n                color-adjust: exact !important;\r\n                margin: 0 !important;\r\n                padding: 0 !important;\r\n              }\r\n              .container {\r\n                max-width: 100%;\r\n                padding: 0 10mm;\r\n              }\r\n            }\r\n\r\n            /* --- ESTILOS ORIGINALES CONSERVADOS --- */\r\n            \r\n            .header-logo {\r\n              height: 50px;\r\n              margin-bottom: 15px;\r\n              filter: brightness(0) invert(1);\r\n            }\r\n            .header-title {\r\n              font-size: 28px;\r\n              font-weight: 700;\r\n              margin-bottom: 8px;\r\n            }\r\n            .header-subtitle {\r\n              font-size: 14px;\r\n              opacity: 0.9;\r\n            }\r\n            h1 { font-size: 26px; font-weight: 700; margin-bottom: 5px; }\r\n            h2 { font-size: 20px; font-weight: 600; margin: 12px 0 4px; }\r\n            h3 { font-size: 16px; font-weight: 600; margin: 10px 0 6px; }\r\n            .grid-2 {\r\n              display: grid;\r\n              grid-template-columns: 1fr 1fr;\r\n              gap: 20px;\r\n              margin-top: 20px;\r\n            }\r\n            .box {\r\n              background: #F8F6EF;\r\n              padding: 16px;\r\n              border-radius: 12px;\r\n              border: 1px solid #e6e0c7;\r\n              page-break-inside: avoid;\r\n              break-inside: avoid;\r\n            }\r\n            .info-section {\r\n              background: #F9FAF9;\r\n              border: 1px solid #E0E5E2;\r\n              border-radius: 12px;\r\n              padding: 20px;\r\n              margin: 25px 0;\r\n              page-break-inside: avoid;\r\n              break-inside: avoid;\r\n            }\r\n            .info-grid {\r\n              display: grid;\r\n              grid-template-columns: repeat(2, 1fr);\r\n              gap: 10px;\r\n            }\r\n            .info-item {\r\n              display: flex;\r\n              align-items: baseline;\r\n              gap: 8px;\r\n              padding: 2px 0;\r\n              border-bottom: 1px solid #eee;\r\n            }\r\n            .info-item:last-child {\r\n              border-bottom: none;\r\n            }\r\n            .info-label {\r\n              font-weight: 600;\r\n              color: #7A8C85;\r\n              font-size: 12px;\r\n              text-transform: uppercase;\r\n              min-width: 120px;\r\n              font-family: 'Outfit', sans-serif;\r\n            }\r\n            .info-value {\r\n              font-weight: 600;\r\n              color: #2C3D37;\r\n              border-bottom: 1px solid #ddd;\r\n              font-size: 11px;\r\n              line-height: 1.2;\r\n              white-space: normal;\r\n              word-wrap: break-word;\r\n              overflow: visible;\r\n              font-family: 'Outfit', sans-serif;\r\n              vertical-align: middle;\r\n              text-align: center;\r\n            }\r\n            td strong {\r\n              display: block;\r\n              margin-bottom: 2px;\r\n            }\r\n            th { background: #F0ECD9; font-weight: 600; text-align: left; }\r\n            td { vertical-align: top; }\r\n            td.text-center { text-align: center; }\r\n            td.text-right { text-align: right; }\r\n            .badge {\r\n              padding: 3px 7px;\r\n              border-radius: 6px;\r\n              font-size: 10px;\r\n              color: white;\r\n            }\r\n            .badge-venta { background: #4B7F52; }\r\n            .badge-arriendo { background: #2C3D37; }\r\n            .badge-success { background: #d1fae5; color: #065f46; border: 1px solid #6ee7b7; }\r\n            .badge-info { background: #dbeafe; color: #1e40af; border: 1px solid #93c5fd; }\r\n            .badge-warning { background: #fef3c7; color: #92400e; border: 1px solid #fcd34d; }\r\n            .badge-secondary { background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }\r\n            .note { font-size: 9px; color: #6b7280; font-style: italic; margin-top: 2px; display: block; }\r\n            .sub-text {\r\n              font-size: 9px;\r\n              color: #888;\r\n              font-family: 'Raleway', sans-serif;\r\n            }\r\n\r\n            /* Hero Header Styles */\r\n            .hero-header {\r\n              background: linear-gradient(135deg, #2C3D37 0%, #1a2620 100%);\r\n              color: white;\r\n              border-radius: 16px;\r\n              padding: 32px;\r\n              margin-bottom: 30px;\r\n              position: relative;\r\n              overflow: hidden;\r\n              box-shadow: 0 10px 30px rgba(0,0,0,0.15);\r\n              page-break-inside: avoid;\r\n              break-inside: avoid;\r\n            }\r\n            .hero-decoration {\r\n              position: absolute;\r\n              top: -20px;\r\n              right: -20px;\r\n              width: 120px;\r\n              height: 120px;\r\n              background: rgba(201, 193, 157, 0.1);\r\n              border-radius: 50%;\r\n              filter: blur(40px);\r\n            }\r\n            .hero-top {\r\n              display: flex;\r\n              justify-content: space-between;\r\n              align-items: flex-start;\r\n              margin-bottom: 20px;\r\n              position: relative;\r\n              z-index: 1;\r\n            }\r\n            .hero-title-section {\r\n              flex: 1;\r\n            }\r\n            .hero-icon-title {\r\n              display: flex;\r\n              align-items: center;\r\n              gap: 12px;\r\n              margin-bottom: 12px;\r\n            }\r\n            .hero-icon {\r\n              background: rgba(255, 255, 255, 0.1);\r\n              padding: 8px;\r\n              border-radius: 8px;\r\n              font-size: 24px;\r\n              line-height: 1;\r\n            }\r\n            .hero-title {\r\n              font-size: 24px;\r\n              font-weight: 600;\r\n              margin: 0;\r\n            }\r\n            .hero-description {\r\n              font-size: 13px;\r\n              line-height: 1.2;\r\n              opacity: 0.9;\r\n              margin-bottom: 12px;\r\n              margin-top: 2px;\r\n              max-width: 85%; \r\n              font-weight: 300;\r\n              font-family: 'Raleway', sans-serif;\r\n            }\r\n            .analysis-section {\r\n              background: #F9FAF9;\r\n              border: 1px solid #E0E5E2;\r\n              border-radius: 12px;\r\n              padding: 20px;\r\n              margin: 25px 0;\r\n            }\r\n            .analysis-content {\r\n              column-count: 2;\r\n              column-gap: 30px;\r\n              font-size: 13px;\r\n              line-height: 1.2;\r\n              text-align: justify;\r\n              color: #4F5B55;\r\n              font-family: 'Raleway', sans-serif;\r\n            }\r\n             .analysis-content h4 {\r\n              column-span: all;\r\n              margin: 16px 0 8px 0;\r\n              font-size: 15px;\r\n              color: #2C3D37;\r\n              font-weight: 700;\r\n              font-family: 'Outfit', sans-serif;\r\n            }\r\n             .analysis-content li {\r\n              margin-left: 18px;\r\n              margin-bottom: 6px;\r\n              color: #4F5B55;\r\n              font-family: 'Raleway', sans-serif;\r\n              font-size: 12px;\r\n            }\r\n            .analysis-content p {\r\n              margin-bottom: 12px;\r\n              color: #4F5B55;\r\n              font-family: 'Raleway', sans-serif;\r\n              font-size: 12px;\r\n            }\r\n            .hero-badge {\r\n              background: rgba(201, 193, 157, 0.9);\r\n              color: #1a2620;\r\n              padding: 6px 16px;\r\n              border-radius: 20px;\r\n              font-size: 13px;\r\n              font-weight: 600;\r\n              white-space: nowrap;\r\n              box-shadow: 0 2px 8px rgba(0,0,0,0.1);\r\n            }\r\n            .hero-value-section {\r\n              display: flex;\r\n              justify-content: space-between;\r\n              align-items: flex-end;\r\n              gap: 30px;\r\n              margin: 24px 0;\r\n              position: relative;\r\n              z-index: 1;\r\n            }\r\n            .hero-main-value {\r\n              flex: 1;\r\n            }\r\n            .hero-amount {\r\n              font-size: 28px;\r\n              font-weight: 700;\r\n              font-family: 'Outfit', sans-serif;\r\n              line-height: 1;\r\n              margin-bottom: 8px;\r\n            }\r\n            .hero-currency {\r\n              font-size: 12px;\r\n              color: #D3DDD6;\r\n              opacity: 0.8;\r\n            }\r\n            .hero-details-box {\r\n              background: rgba(255, 255, 255, 0.1);\r\n              border: 1px solid rgba(255, 255, 255, 0.1);\r\n              border-radius: 12px;\r\n              padding: 14px 18px;\r\n              min-width: 240px;\r\n            }\r\n            .hero-detail-row {\r\n              display: flex;\r\n              justify-content: space-between;\r\n              padding: 8px 0;\r\n              border-bottom: 1px solid rgba(255, 255, 255, 0.1);\r\n            }\r\n            .hero-detail-row:last-child {\r\n              border-bottom: none;\r\n            }\r\n            .hero-detail-label {\r\n              color: #D3DDD6;\r\n              font-size: 13px;\r\n            }\r\n            .hero-detail-value {\r\n              font-weight: 600;\r\n              text-align: right;\r\n              font-size: 13px;\r\n            }\r\n            .hero-detail-sub {\r\n              font-size: 10px;\r\n              color: #A3B2AA;\r\n              display: block;\r\n              margin-top: 2px;\r\n            }\r\n            .hero-footer {\r\n              font-size: 11px;\r\n              color: rgba(211, 221, 214, 0.8);\r\n              font-style: italic;\r\n              line-height: 1.2;\r\n              margin-top: 16px;\r\n              position: relative;\r\n              z-index: 1;\r\n            }\r\n\r\n            /* Print Styles */\r\n            @media print {\r\n              @page {\r\n                margin: 0;\r\n                size: letter;\r\n              }\r\n              body {\r\n                -webkit-print-color-adjust: exact !important;\r\n                print-color-adjust: exact !important;\r\n                color-adjust: exact !important;\r\n                margin: 0 !important;\r\n                padding: 60px 20mm 60px 20mm !important;\r\n              }\r\n\r\n              .analysis-content {\r\n                column-count: 2;\r\n                column-gap: 30px;\r\n              }\r\n              \r\n              .analysis-content p, \r\n              .analysis-content li {\r\n                break-inside: avoid;\r\n                page-break-inside: avoid;\r\n              }\r\n\r\n              .hero-header {\r\n                background: linear-gradient(135deg, #2C3D37 0%, #1a2620 100%) !important;\r\n                -webkit-print-color-adjust: exact !important;\r\n                print-color-adjust: exact !important;\r\n              }\r\n              .hero-details-box {\r\n                background: rgba(255, 255, 255, 0.1) !important;\r\n                -webkit-print-color-adjust: exact !important;\r\n              }\r\n              .hero-badge {\r\n                background: #C9C19D !important;\r\n                -webkit-print-color-adjust: exact !important;\r\n              }\r\n              .info-section {\r\n                page-break-inside: avoid;\r\n              }\r\n              table {\r\n                page-break-inside: auto;\r\n              }\r\n              tr {\r\n                page-break-inside: avoid;\r\n                page-break-after: auto;\r\n              }\r\n              thead {\r\n                display: table-header-group;\r\n              }\r\n            }\r\n            \r\n            /* Analysis Styles */\r\n            .analysis-section {\r\n              margin-top: 30px;\r\n              border-top: 2px solid #E0E5E2;\r\n              padding-top: 20px;\r\n              page-break-inside: avoid;\r\n              break-inside: avoid;\r\n            }\r\n            .analysis-content h4 {\r\n              color: #2C3D37;\r\n              font-size: 14px;\r\n              margin: 15px 0 8px 0;\r\n            }\r\n             .analysis-content li {\r\n              margin-bottom: 5px;\r\n              font-size: 12px;\r\n              color: #4F5B55;\r\n              font-family: 'Raleway', sans-serif;\r\n            }\r\n            .analysis-content p {\r\n              margin-bottom: 10px;\r\n              font-size: 12px;\r\n              text-align: justify;\r\n              color: #4F5B55;\r\n              font-family: 'Raleway', sans-serif;\r\n            }\r\n\r\n            /* Hero Layout Update */\r\n            .hero-content-row {\r\n              display: flex;\r\n              justify-content: space-between;\r\n              align-items: center;\r\n              gap: 30px;\r\n              margin: 20px 0;\r\n              position: relative;\r\n              z-index: 1;\r\n            }\r\n            .hero-left-col {\r\n              flex: 1;\r\n              display: flex;\r\n              flex-direction: column;\r\n              justify-content: space-between;\r\n            }\r\n            .hero-value-block {\r\n              margin-top: auto;\r\n            }\r\n          </style>\r\n        </head>\r\n\r\n        <body>\r\n\r\n\r\n          <div class=\"container\">\r\n            <div class=\"hero-header\">\r\n              <div class=\"hero-decoration\"></div>\r\n              \r\n              <div class=\"hero-top\" style=\"margin-bottom: 10px;\">\r\n                <div class=\"hero-icon-title\">\r\n                  <div class=\"hero-icon\">üè†</div>\r\n                  <h1 class=\"hero-title\">Valor Comercial Estimado</h1>\r\n                </div>\r\n                <div class=\"hero-badge\">‚ö° Estimaci√≥n IA</div>\r\n              </div>\r\n              \r\n              <!-- Property Summary Row -->\r\n              ${!esLote ? `\r\n              <div style=\"display: flex; gap: 20px; padding: 10px 0; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); position: relative; z-index: 1;\">\r\n                <span style=\"font-size: 14px; color: #D3DDD6;\">\r\n                  üè† ${formData.tipo_inmueble || 'Inmueble'}\r\n                </span>\r\n                <span style=\"font-size: 14px; color: #D3DDD6;\">\r\n                  üìê ${formatNumber(area)} m¬≤\r\n                </span>\r\n                <span style=\"font-size: 14px; color: #D3DDD6;\">\r\n                  üõèÔ∏è ${formData.habitaciones || comparablesData.habitaciones || defaults.habitaciones || '‚Äî'} hab\r\n                </span>\r\n                <span style=\"font-size: 14px; color: #D3DDD6;\">\r\n                  üöø ${formData.banos || comparablesData.banos || defaults.banos || '‚Äî'} ba√±os\r\n                </span>\r\n              </div>\r\n              ` : `\r\n              <div style=\"display: flex; gap: 20px; padding: 10px 0; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); position: relative; z-index: 1;\">\r\n                <span style=\"font-size: 14px; color: #D3DDD6;\">\r\n                  üè† ${formData.tipo_inmueble || 'Lote'}\r\n                </span>\r\n                <span style=\"font-size: 14px; color: #D3DDD6;\">\r\n                  üìê ${formatNumber(area)} m¬≤\r\n                </span>\r\n                <span style=\"font-size: 14px; color: #D3DDD6;\">\r\n                  üìç ${formData.uso_lote || 'Uso no especificado'}\r\n                </span>\r\n              </div>\r\n              `}\r\n\r\n              <div class=\"hero-content-row\">\r\n                <div class=\"hero-left-col\">\r\n                  <p class=\"hero-description\" style=\"max-width: 85%;\">\r\n                    ${esLote\r\n          ? 'Valor obtenido a partir del an√°lisis de mercado y m√©todo residual, sin aplicar enfoque de rentabilidad.'\r\n          : 'Determinaci√≥n del valor comercial basada en un an√°lisis t√©cnico ponderado que integra el comportamiento real del mercado local y la validaci√≥n experta de nuestra inteligencia artificial.'}\r\n                  </p>\r\n                  \r\n                  <div class=\"hero-value-block\">\r\n                    <div class=\"hero-amount\">${formatCurrency(valorEstimadoFinal)}</div>\r\n                    <div class=\"hero-currency\">COP (Pesos Colombianos)</div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"hero-details-box\">\r\n                  <div class=\"hero-detail-row\" style=\"align-items: flex-start;\">\r\n                    <span class=\"hero-detail-label\" style=\"align-self: center;\">Rango Sugerido</span>\r\n                    <div style=\"text-align: right; line-height: 1.4;\">\r\n                      <div class=\"hero-detail-value\">${formatCurrency(rangoMin)}</div>\r\n                      <div class=\"hero-detail-value\">${formatCurrency(rangoMax)}</div>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"hero-detail-row\">\r\n                    <span class=\"hero-detail-label\">Precio m¬≤ Ref.</span>\r\n                    <span class=\"hero-detail-value\">${formatCurrency(precioM2)}/m¬≤</span>\r\n                  </div>\r\n                  ${totalComparables ? `\r\n                  <div class=\"hero-detail-row\">\r\n                    <span class=\"hero-detail-label\">Muestra</span>\r\n                    <span class=\"hero-detail-value\">\r\n                      ${totalComparables} inmuebles\r\n                      ${totalEncontrados && totalEncontrados > totalComparables\r\n            ? `<span class=\"hero-detail-sub\">(de ${totalEncontrados} encontrados)</span>`\r\n            : `<span class=\"hero-detail-sub\">(${comparablesData.total_comparables_venta || 0} venta, ${comparablesData.total_comparables_arriendo || 0} arriendo)</span>`\r\n          }\r\n                    </span>\r\n                  </div>\r\n                  ` : ''}\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"hero-footer\">\r\n                El valor final es una recomendaci√≥n t√©cnica ponderada entre el enfoque de mercado\r\n                y el de rentabilidad, priorizando el m√©todo con datos m√°s consistentes seg√∫n la\r\n                cantidad, homogeneidad y dispersi√≥n de los comparables disponibles.\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"grid-2\">\r\n              <div class=\"box\">\r\n                <h3>${esLote ? 'Metodolog√≠a Ajustada (Lotes)' : 'Enfoque de Mercado'}</h3>\r\n                <p style=\"font-size: 22px; font-weight: 700;\">\r\n                  ${formatCurrency(valorVentaDirecta)}\r\n                </p>\r\n                <p style=\"font-size: 11px; margin-top: 8px;\">\r\n                  ${esLote\r\n          ? 'Calculado a partir del precio promedio por m¬≤ de lotes comparables y ajuste residual.'\r\n          : 'Basado en precio promedio por m¬≤ √ó √°rea construida.'}\r\n                </p>\r\n              </div>\r\n\r\n              ${valorRentabilidad ? `\r\n              <div class=\"box\">\r\n                <h3>Enfoque de Rentabilidad</h3>\r\n                <p style=\"font-size: 22px; font-weight: 700;\">\r\n                  ${formatCurrency(valorRentabilidad)}\r\n                </p>\r\n                <p style=\"font-size: 11px; margin-top: 8px;\">\r\n                  Canon mensual estimado √∑ yield mensual del sector.\r\n                </p>\r\n                ${yieldMensual ? `\r\n                <p style=\"font-size: 10px; color: #7A8C85; font-style: italic; margin-top: 8px;\">\r\n                  Yield utilizado: ${(yieldMensual * 100).toFixed(2)}% mensual\r\n                </p>\r\n                ` : ''}\r\n              </div>\r\n              ` : ''}\r\n            </div>\r\n\r\n            <div class=\"info-section\">\r\n              <h3 style=\"margin-top: 0; color: #2C3D37; border-bottom: 2px solid #C9C19D; padding-bottom: 8px;\">Informaci√≥n Detallada</h3>\r\n              <div class=\"info-grid\">\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">Tipo de Inmueble:</span>\r\n                  <span class=\"info-value\">${formData.tipo_inmueble || '‚Äî'}</span>\r\n                </div>\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">Ubicaci√≥n:</span>\r\n                  <span class=\"info-value\">${formData.barrio || '‚Äî'}, ${formData.municipio || formData.ciudad || '‚Äî'}</span>\r\n                </div>\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">√Årea Construida:</span>\r\n                  <span class=\"info-value\">${formatNumber(area)} m¬≤</span>\r\n                </div>\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">Precio por m¬≤:</span>\r\n                  <span class=\"info-value\">${formatCurrency(precioM2)}/m¬≤</span>\r\n                </div>\r\n                ${!esLote ? `\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">Habitaciones:</span>\r\n                  <span class=\"info-value\">${formData.habitaciones || comparablesData.habitaciones || defaults.habitaciones || '‚Äî'}</span>\r\n                </div>\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">Ba√±os:</span>\r\n                  <span class=\"info-value\">${formData.banos || comparablesData.banos || defaults.banos || '‚Äî'}</span>\r\n                </div>\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">Estrato:</span>\r\n                  <span class=\"info-value\">${formData.estrato || comparablesData.estrato || defaults.estrato || 'No especificado'}</span>\r\n                </div>\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">Estado:</span>\r\n                  <span class=\"info-value\" style=\"text-transform: capitalize;\">\r\n                    ${(() => {\r\n            const estado = formData.estado_inmueble || formData.estado ||\r\n              comparablesData.estado_inmueble || comparablesData.estado ||\r\n              defaults.estado_inmueble || defaults.estado;\r\n            return estado ? estado.replace(/_/g, ' ') : '‚Äî';\r\n          })()}\r\n                  </span>\r\n                </div>\r\n                ` : `\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">Uso del Lote:</span>\r\n                  <span class=\"info-value\">${formData.uso_lote || '‚Äî'}</span>\r\n                </div>\r\n                `}\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">Comparables:</span>\r\n                  <span class=\"info-value\">${totalComparables} inmuebles</span>\r\n                </div>\r\n                ${!esLote && yieldMensual ? `\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">Yield Mensual:</span>\r\n                  <span class=\"info-value\">${(yieldMensual * 100).toFixed(2)}%</span>\r\n                </div>\r\n                ` : ''}\r\n              </div>\r\n            </div>\r\n\r\n            <!-- AN√ÅLISIS DETALLADO DEL MODELO -->\r\n            ${comparablesData.perplexity_full_text ? `\r\n            <div class=\"analysis-section\">\r\n              <h3 style=\"color: #2C3D37; border-bottom: 2px solid #C9C19D; padding-bottom: 8px;\">An√°lisis Detallado del Modelo</h3>\r\n              <div class=\"analysis-content\">\r\n                ${formatText(comparablesData.perplexity_full_text)}\r\n              </div>\r\n            </div>\r\n            ` : ''}\r\n\r\n            <!-- Tabla de comparables -->\r\n            <h2 style=\"margin-top: 30px;\">Propiedades Comparables</h2>\r\n\r\n            <table style=\"margin: 0 auto;\">\r\n              <thead>\r\n                <tr>\r\n                  <th style=\"text-align:center; vertical-align:middle; min-width: 180px;\">Inmueble</th>\r\n                  <th style=\"text-align:center; vertical-align:middle;\">Tipo</th>\r\n                  <th style=\"text-align:center; vertical-align:middle;\">√Årea</th>\r\n                  <th style=\"text-align:center; vertical-align:middle; max-width: 50px;\">Hab/<br>Ba√±os</th>\r\n                  <th style=\"text-align:center; vertical-align:middle; min-width: 135px;\">Precio Publicado</th>\r\n                  <th style=\"text-align:center; vertical-align:middle; min-width: 135px;\">Precio de Venta</th>\r\n                  <th style=\"text-align:center; vertical-align:middle; min-width: 130px;\">Precio m¬≤</th>\r\n                </tr>\r\n              </thead>\r\n\r\n              <tbody>\r\n                ${(comparables || []).map(item => {\r\n            const esArriendo = item.tipo_origen === 'arriendo';\r\n            const badgeClass = esArriendo ? 'badge-arriendo' : 'badge-venta';\r\n            const tipoLabel = esArriendo ? 'Arriendo' : 'Venta';\r\n            const notaArriendo = esArriendo\r\n              ? `<span class=\"sub-text\">Estimado por rentabilidad (Yield ${(item.yield_mensual * 100).toFixed(2)}%)</span>`\r\n              : '';\r\n\r\n            return `\r\n                    <tr>\r\n                      <td style=\"text-align:left;\">\r\n                        <strong style=\"display:block; margin-bottom:2px;\">${item.titulo || 'Inmueble'}</strong>\r\n                        <span class=\"sub-text\">${item.barrio || ''}, ${item.municipio || ''}</span>\r\n                        <br>\r\n                        <span class=\"badge badge-${getBadgeClass(item.fuente_validacion || 'portal_verificado')}\">\r\n                          ${getFuenteLabel(item.fuente_validacion || 'portal_verificado')}\r\n                        </span>\r\n                        ${item.nota_adicional ? `<br><span class=\"note\">${item.nota_adicional}</span>` : ''}\r\n                      </td>\r\n                      <td style=\"text-align:center;\"><span class=\"badge ${badgeClass}\">${tipoLabel}</span></td>\r\n                      <td style=\"text-align:center;\">${formatNumber(item.area_m2)} m¬≤</td>\r\n                      <td style=\"text-align:center; white-space: nowrap;\">\r\n                        ${item.habitaciones || '‚Äî'} / ${item.banos || '‚Äî'}\r\n                      </td>\r\n                      <td style=\"text-align:right;\">${formatCurrency(item.precio_publicado)}${esArriendo ? '<br><span class=\"sub-text\">/mes</span>' : ''}</td>\r\n                      <td style=\"text-align:right;\">\r\n                        <strong>${formatCurrency(item.precio_cop)}</strong>\r\n                        ${notaArriendo}\r\n                      </td>\r\n                      <td style=\"text-align:right;\">\r\n                        ${formatCurrency(item.precio_m2)}\r\n                      </td>\r\n                    </tr>\r\n                  `;\r\n          }).join('')}\r\n              </tbody>\r\n            </table>\r\n\r\n            <p style=\"font-size: 10px; color: #666; margin-top: 15px; font-style: italic;\">\r\n              Yield mensual utilizado: ${yieldMensual ? (yieldMensual * 100).toFixed(2) + '%' : '0.5%'}.\r\n              Este yield corresponde al promedio observado en arriendos residenciales del mercado local.\r\n            </p>\r\n\r\n            ${esLote ? `\r\n              <p style=\"font-size: 10px; color: #888; margin-top: 15px; font-style: italic; text-align: justify;\">\r\n                Nota: Ante la escasez de oferta comercial id√©ntica, se han utilizado lotes campestres y urbanos como referencia base, ajustando sus valores por factores de localizaci√≥n, escala y uso comercial. Se aplic√≥ ajuste por factor de comercializaci√≥n.\r\n              </p>\r\n            ` : ''}\r\n\r\n          </div>\r\n        </body>\r\n        </html>\r\n      `;\r\n\r\n      // Abrir PDF\r\n      const printWindow = window.open('', '_blank');\r\n      if (printWindow) {\r\n        printWindow.document.write(htmlContent);\r\n        printWindow.document.close();\r\n        printWindow.document.title = 'Reporte de Aval√∫o - Quetzal H√°bitats';\r\n\r\n        // Esperar a que las fuentes se carguen antes de imprimir\r\n        setTimeout(() => {\r\n          printWindow.print();\r\n        }, 1500); // Aumentado de 800ms a 1500ms para asegurar carga de Google Fonts\r\n      }\r\n\r\n      return { success: true };\r\n    }\r\n  });\r\n\r\n  return (\r\n    <Button\r\n      ref={ref}\r\n      onClick={() => generatePDFMutation.mutate(formData)}\r\n      disabled={generatePDFMutation.isPending}\r\n      className=\"flex-1 bg-[#C9C19D] hover:bg-[#b8b08c] text-[#2C3D37] rounded-full py-6 text-lg font-medium\"\r\n    >\r\n      {generatePDFMutation.isPending ? (\r\n        <>\r\n          <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n          Generando PDF...\r\n        </>\r\n      ) : (\r\n        <>\r\n          <Download className=\"w-5 h-5 mr-2\" />\r\n          Descargar Reporte PDF\r\n        </>\r\n      )}\r\n    </Button>\r\n  );\r\n});\r\n\r\nBotonPDF.displayName = 'BotonPDF';\r\n\r\nexport default BotonPDF;","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\components\\avaluo\\Step1Form.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'Upload' is defined but never used.","line":10,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"Upload"},"fix":{"range":[571,579],"text":""},"desc":"Remove unused variable 'Upload'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'X' is defined but never used.","line":10,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"X"},"fix":{"range":[579,582],"text":""},"desc":"Remove unused variable 'X'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'Loader2' is defined but never used.","line":10,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"Loader2"},"fix":{"range":[592,601],"text":""},"desc":"Remove unused variable 'Loader2'."}]},{"ruleId":"react/prop-types","severity":2,"message":"'formData' is missing in props validation","line":20,"column":37,"nodeType":"Property","messageId":"missingPropType","endLine":20,"endColumn":45},{"ruleId":"react/prop-types","severity":2,"message":"'onUpdate' is missing in props validation","line":20,"column":47,"nodeType":"Property","messageId":"missingPropType","endLine":20,"endColumn":55},{"ruleId":"react/prop-types","severity":2,"message":"'onNext' is missing in props validation","line":20,"column":57,"nodeType":"Property","messageId":"missingPropType","endLine":20,"endColumn":63},{"ruleId":"no-unused-vars","severity":2,"message":"'uploadingFiles' is assigned a value but never used.","line":22,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"uploadingFiles"},"fix":{"range":[1196,1210],"text":""},"desc":"Remove unused variable 'uploadingFiles'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'handleFileUpload' is assigned a value but never used.","line":56,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"handleFileUpload"},"fix":{"range":[2308,3564],"text":""},"desc":"Remove unused variable 'handleFileUpload'."}]},{"ruleId":"react/prop-types","severity":2,"message":"'formData.append' is missing in props validation","line":66,"column":18,"nodeType":"Identifier","messageId":"missingPropType","endLine":66,"endColumn":24},{"ruleId":"no-unused-vars","severity":2,"message":"'removeFile' is assigned a value but never used.","line":98,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":98,"endColumn":19,"suggestions":[{"messageId":"removeVar","data":{"varName":"removeFile"},"fix":{"range":[3568,3834],"text":""},"desc":"Remove unused variable 'removeFile'."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":361,"column":75,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[16393,16425],"text":"Reforma Ligera ($0 - $5&apos;000.000)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[16393,16425],"text":"Reforma Ligera ($0 - $5&lsquo;000.000)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[16393,16425],"text":"Reforma Ligera ($0 - $5&#39;000.000)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[16393,16425],"text":"Reforma Ligera ($0 - $5&rsquo;000.000)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":362,"column":74,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[16492,16535],"text":"Reforma Moderada ($5&apos;000.000 - $15'000.000)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[16492,16535],"text":"Reforma Moderada ($5&lsquo;000.000 - $15'000.000)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[16492,16535],"text":"Reforma Moderada ($5&#39;000.000 - $15'000.000)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[16492,16535],"text":"Reforma Moderada ($5&rsquo;000.000 - $15'000.000)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":362,"column":88,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[16492,16535],"text":"Reforma Moderada ($5'000.000 - $15&apos;000.000)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[16492,16535],"text":"Reforma Moderada ($5'000.000 - $15&lsquo;000.000)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[16492,16535],"text":"Reforma Moderada ($5'000.000 - $15&#39;000.000)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[16492,16535],"text":"Reforma Moderada ($5'000.000 - $15&rsquo;000.000)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":363,"column":76,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[16600,16647],"text":"Remodelaci√≥n Amplia ($15&apos;000.000 - $20'000.000)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[16600,16647],"text":"Remodelaci√≥n Amplia ($15&lsquo;000.000 - $20'000.000)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[16600,16647],"text":"Remodelaci√≥n Amplia ($15&#39;000.000 - $20'000.000)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[16600,16647],"text":"Remodelaci√≥n Amplia ($15&rsquo;000.000 - $20'000.000)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":363,"column":90,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[16600,16647],"text":"Remodelaci√≥n Amplia ($15'000.000 - $20&apos;000.000)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[16600,16647],"text":"Remodelaci√≥n Amplia ($15'000.000 - $20&lsquo;000.000)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[16600,16647],"text":"Remodelaci√≥n Amplia ($15'000.000 - $20&#39;000.000)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[16600,16647],"text":"Remodelaci√≥n Amplia ($15'000.000 - $20&rsquo;000.000)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":364,"column":85,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[16713,16754],"text":"Remodelaci√≥n Premium (M√°s de $20&apos;000.000)"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[16713,16754],"text":"Remodelaci√≥n Premium (M√°s de $20&lsquo;000.000)"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[16713,16754],"text":"Remodelaci√≥n Premium (M√°s de $20&#39;000.000)"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[16713,16754],"text":"Remodelaci√≥n Premium (M√°s de $20&rsquo;000.000)"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":403,"column":77,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[18650,18948],"text":" Para evitar penalizaciones por &quot;hallazgos ocultos\" en futuras promesas de compraventa, por favor detalla: situaci√≥n legal (herencias, sucesiones, hipotecas), si el inmueble tiene licencia de construcci√≥n (especialmente lotes), si est√° libre de patrimonio familiar o si requiere ajustes puntuales. "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[18650,18948],"text":" Para evitar penalizaciones por &ldquo;hallazgos ocultos\" en futuras promesas de compraventa, por favor detalla: situaci√≥n legal (herencias, sucesiones, hipotecas), si el inmueble tiene licencia de construcci√≥n (especialmente lotes), si est√° libre de patrimonio familiar o si requiere ajustes puntuales. "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[18650,18948],"text":" Para evitar penalizaciones por &#34;hallazgos ocultos\" en futuras promesas de compraventa, por favor detalla: situaci√≥n legal (herencias, sucesiones, hipotecas), si el inmueble tiene licencia de construcci√≥n (especialmente lotes), si est√° libre de patrimonio familiar o si requiere ajustes puntuales. "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[18650,18948],"text":" Para evitar penalizaciones por &rdquo;hallazgos ocultos\" en futuras promesas de compraventa, por favor detalla: situaci√≥n legal (herencias, sucesiones, hipotecas), si el inmueble tiene licencia de construcci√≥n (especialmente lotes), si est√° libre de patrimonio familiar o si requiere ajustes puntuales. "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":403,"column":95,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[18650,18948],"text":" Para evitar penalizaciones por \"hallazgos ocultos&quot; en futuras promesas de compraventa, por favor detalla: situaci√≥n legal (herencias, sucesiones, hipotecas), si el inmueble tiene licencia de construcci√≥n (especialmente lotes), si est√° libre de patrimonio familiar o si requiere ajustes puntuales. "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[18650,18948],"text":" Para evitar penalizaciones por \"hallazgos ocultos&ldquo; en futuras promesas de compraventa, por favor detalla: situaci√≥n legal (herencias, sucesiones, hipotecas), si el inmueble tiene licencia de construcci√≥n (especialmente lotes), si est√° libre de patrimonio familiar o si requiere ajustes puntuales. "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[18650,18948],"text":" Para evitar penalizaciones por \"hallazgos ocultos&#34; en futuras promesas de compraventa, por favor detalla: situaci√≥n legal (herencias, sucesiones, hipotecas), si el inmueble tiene licencia de construcci√≥n (especialmente lotes), si est√° libre de patrimonio familiar o si requiere ajustes puntuales. "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[18650,18948],"text":" Para evitar penalizaciones por \"hallazgos ocultos&rdquo; en futuras promesas de compraventa, por favor detalla: situaci√≥n legal (herencias, sucesiones, hipotecas), si el inmueble tiene licencia de construcci√≥n (especialmente lotes), si est√° libre de patrimonio familiar o si requiere ajustes puntuales. "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { createClient } from '@supabase/supabase-js';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Textarea } from '@/components/ui/textarea';\nimport { ArrowRight, Upload, X, FileText, Loader2 } from 'lucide-react';\n\nconst DEPARTAMENTOS_COLOMBIA = [\n  \"Amazonas\", \"Antioquia\", \"Arauca\", \"Atl√°ntico\", \"Bol√≠var\", \"Boyac√°\", \"Caldas\",\n  \"Caquet√°\", \"Casanare\", \"Cauca\", \"Cesar\", \"Choc√≥\", \"C√≥rdoba\", \"Cundinamarca\",\n  \"Guain√≠a\", \"Guaviare\", \"Huila\", \"La Guajira\", \"Magdalena\", \"Meta\", \"Nari√±o\",\n  \"Norte de Santander\", \"Putumayo\", \"Quind√≠o\", \"Risaralda\", \"San Andr√©s y Providencia\",\n  \"Santander\", \"Sucre\", \"Tolima\", \"Valle del Cauca\", \"Vaup√©s\", \"Vichada\"\n];\n\nexport default function Step1Form({ formData, onUpdate, onNext }) {\n  const [localData, setLocalData] = useState(formData);\n  const [uploadingFiles, setUploadingFiles] = useState(false);\n  const [uploadedFiles, setUploadedFiles] = useState([]);\n  const [hasAvaluos, setHasAvaluos] = useState(false);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const checkAvaluos = async () => {\n      try {\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n        if (!supabaseUrl || !supabaseAnonKey) return;\n        const supabase = createClient(supabaseUrl, supabaseAnonKey);\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) return;\n\n        const { count } = await supabase\n          .from('avaluos')\n          .select('*', { count: 'exact', head: true })\n          .eq('email', user.email);\n\n        if (count && count > 0) setHasAvaluos(true);\n      } catch (e) {\n        console.error(\"Error checking avaluos:\", e);\n      }\n    };\n    checkAvaluos();\n  }, []);\n\n  const handleChange = (field, value) => {\n    const updated = { ...localData, [field]: value };\n    setLocalData(updated);\n    onUpdate(updated);\n  };\n\n  const handleFileUpload = async (e) => {\n    const files = Array.from(e.target.files);\n    if (files.length === 0) return;\n\n    setUploadingFiles(true);\n    const newUploadedFiles = [];\n\n    try {\n      for (const file of files) {\n        const formData = new FormData();\n        formData.append('file', file);\n\n        const response = await fetch(import.meta.env.VITE_WORKER_UPLOAD_URL, {\n          method: 'POST',\n          body: formData\n        });\n\n        if (!response.ok) {\n          const error = await response.json();\n          console.error('Upload failed:', error);\n          alert(`Error al subir ${file.name}: ${error.error || 'Error desconocido'}`);\n          continue;\n        }\n\n        const { file_url } = await response.json();\n        newUploadedFiles.push({ name: file.name, url: file_url });\n      }\n\n      const allFiles = [...uploadedFiles, ...newUploadedFiles];\n      setUploadedFiles(allFiles);\n\n      const updated = { ...localData, documentos_urls: allFiles.map(f => f.url) };\n      setLocalData(updated);\n      onUpdate(updated);\n    } catch (error) {\n      console.error('Upload error:', error);\n      alert('Error al subir archivos. Por favor, intenta de nuevo.');\n    } finally {\n      setUploadingFiles(false);\n    }\n  };\n\n  const removeFile = (index) => {\n    const newFiles = uploadedFiles.filter((_, i) => i !== index);\n    setUploadedFiles(newFiles);\n\n    const updated = { ...localData, documentos_urls: newFiles.map(f => f.url) };\n    setLocalData(updated);\n    onUpdate(updated);\n  };\n\n  const isLote = localData.tipo_inmueble === 'lote';\n\n  const isRemodelacionValid = isLote || localData.estado_inmueble !== 'remodelado' || (\n    localData.tipo_remodelacion &&\n    localData.descripcion_mejoras?.trim() &&\n    (localData.tipo_remodelacion !== 'premium' || localData.valor_remodelacion?.trim())\n  );\n\n  const isValid = localData.tipo_inmueble && localData.municipio &&\n    localData.departamento && localData.area_construida &&\n    (isLote ? localData.uso_lote : (localData.barrio && localData.contexto_zona && localData.estado_inmueble && localData.antiguedad && localData.estrato)) &&\n    isRemodelacionValid &&\n    (isLote || localData.contexto_zona !== 'conjunto_cerrado' || (localData.nombre_conjunto && localData.nombre_conjunto.trim().length >= 3));\n\n  return (\n    <div className=\"space-y-6\">\n      <Card className=\"border-[#B0BDB4]\">\n        <CardHeader>\n          <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n            <div>\n              <CardTitle className=\"text-2xl text-[#2C3D37]\">\n                Datos del Inmueble\n              </CardTitle>\n              <CardDescription className=\"text-base\">\n                Completa la informaci√≥n de tu propiedad para realizar el aval√∫o comercial.\n              </CardDescription>\n            </div>\n            {hasAvaluos && (\n              <Button\n                onClick={() => navigate('/mis-avaluos')}\n                variant=\"outline\"\n                className=\"border-[#2C3D37] text-[#2C3D37] hover:bg-[#F0F2F1] rounded-full\"\n              >\n                <FileText className=\"w-4 h-4 mr-2\" />\n                Mis Aval√∫os\n              </Button>\n            )}\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n\n          {/* Tipo de Propiedad y Ubicaci√≥n */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-[#2C3D37] font-medium\">Tipo de Propiedad *</Label>\n              <Select value={localData.tipo_inmueble || ''} onValueChange={(value) => handleChange('tipo_inmueble', value)}>\n                <SelectTrigger className=\"border-[#B0BDB4] focus:border-[#2C3D37]\">\n                  <SelectValue placeholder=\"Selecciona\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"casa\">Casa</SelectItem>\n                  <SelectItem value=\"apartamento\">Apartamento</SelectItem>\n                  <SelectItem value=\"lote\">Lote</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {isLote && (\n              <div className=\"space-y-2\">\n                <Label className=\"text-[#2C3D37] font-medium\">Uso del Lote *</Label>\n                <Select value={localData.uso_lote || ''} onValueChange={(value) => handleChange('uso_lote', value)}>\n                  <SelectTrigger className=\"border-[#B0BDB4] focus:border-[#2C3D37]\">\n                    <SelectValue placeholder=\"Selecciona\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"residencial\">Residencial</SelectItem>\n                    <SelectItem value=\"comercial\">Comercial</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n\n            {!isLote && (\n              <>\n                <div className=\"space-y-2\">\n                  <Label className=\"text-[#2C3D37] font-medium\">Barrio *</Label>\n                  <Input\n                    value={localData.barrio || ''}\n                    onChange={(e) => handleChange('barrio', e.target.value)}\n                    placeholder=\"Ej: Ciudad Verde\"\n                    className=\"border-[#B0BDB4] focus:border-[#2C3D37]\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"text-[#2C3D37] font-medium\">Tipo de Urbanizaci√≥n *</Label>\n                  <Select value={localData.contexto_zona || ''} onValueChange={(value) => handleChange('contexto_zona', value)}>\n                    <SelectTrigger className=\"border-[#B0BDB4] focus:border-[#2C3D37]\">\n                      <SelectValue placeholder=\"Selecciona\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"barrio_abierto\">Barrio</SelectItem>\n                      <SelectItem value=\"conjunto_cerrado\">Conjunto Cerrado</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </>\n            )}\n\n            {localData.contexto_zona === 'conjunto_cerrado' && (\n              <div className=\"space-y-2\">\n                <Label className=\"text-[#2C3D37] font-medium\">Nombre del Conjunto *</Label>\n                <Input\n                  value={localData.nombre_conjunto || ''}\n                  onChange={(e) => handleChange('nombre_conjunto', e.target.value)}\n                  placeholder=\"Ej: Conjunto Residencial Los Robles\"\n                  className=\"border-[#B0BDB4] focus:border-[#2C3D37]\"\n                />\n              </div>\n            )}\n\n            <div className=\"space-y-2\">\n              <Label className=\"text-[#2C3D37] font-medium\">Ciudad / Municipio *</Label>\n              <Input\n                value={localData.municipio || ''}\n                onChange={(e) => handleChange('municipio', e.target.value)}\n                placeholder=\"Ej: Pereira\"\n                className=\"border-[#B0BDB4] focus:border-[#2C3D37]\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label className=\"text-[#2C3D37] font-medium\">Departamento *</Label>\n              <Select value={localData.departamento || ''} onValueChange={(value) => handleChange('departamento', value)}>\n                <SelectTrigger className=\"border-[#B0BDB4] focus:border-[#2C3D37]\">\n                  <SelectValue placeholder=\"Selecciona\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {DEPARTAMENTOS_COLOMBIA.map(dep => (\n                    <SelectItem key={dep} value={dep}>{dep}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {/* Caracter√≠sticas */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-[#2C3D37] font-medium\">√Årea (m¬≤) *</Label>\n              <Input\n                type=\"number\"\n                value={localData.area_construida || ''}\n                onChange={(e) => handleChange('area_construida', parseFloat(e.target.value))}\n                placeholder=\"120\"\n                className=\"border-[#B0BDB4] focus:border-[#2C3D37]\"\n              />\n            </div>\n\n            {!isLote && (\n              <>\n                <div className=\"space-y-2\">\n                  <Label className=\"text-[#2C3D37] font-medium\"># Habitaciones</Label>\n                  <Input\n                    type=\"number\"\n                    value={localData.habitaciones || ''}\n                    onChange={(e) => handleChange('habitaciones', parseInt(e.target.value))}\n                    placeholder=\"3\"\n                    className=\"border-[#B0BDB4] focus:border-[#2C3D37]\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"text-[#2C3D37] font-medium\"># Ba√±os</Label>\n                  <Input\n                    type=\"number\"\n                    value={localData.banos || ''}\n                    onChange={(e) => handleChange('banos', parseInt(e.target.value))}\n                    placeholder=\"2\"\n                    className=\"border-[#B0BDB4] focus:border-[#2C3D37]\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"text-[#2C3D37] font-medium\">Parqueadero</Label>\n                  <Select value={localData.tipo_parqueadero || ''} onValueChange={(value) => handleChange('tipo_parqueadero', value)}>\n                    <SelectTrigger className=\"border-[#B0BDB4] focus:border-[#2C3D37]\">\n                      <SelectValue placeholder=\"Selecciona\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"propio\">Propio</SelectItem>\n                      <SelectItem value=\"comunal\">Comunal</SelectItem>\n                      <SelectItem value=\"sin_parqueadero\">Sin Parqueadero</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"text-[#2C3D37] font-medium\">Antig√ºedad *</Label>\n                  <Select value={localData.antiguedad || ''} onValueChange={(value) => handleChange('antiguedad', value)}>\n                    <SelectTrigger className=\"border-[#B0BDB4] focus:border-[#2C3D37]\">\n                      <SelectValue placeholder=\"Selecciona\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"0 a 5 a√±os\">0 a 5 a√±os</SelectItem>\n                      <SelectItem value=\"6 a 10 a√±os\">6 a 10 a√±os</SelectItem>\n                      <SelectItem value=\"11 a 15 a√±os\">11 a 15 a√±os</SelectItem>\n                      <SelectItem value=\"15 a 20 a√±os\">15 a 20 a√±os</SelectItem>\n                      <SelectItem value=\"M√°s de 20 a√±os\">M√°s de 20 a√±os</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"text-[#2C3D37] font-medium\">Estrato *</Label>\n                  <Select value={localData.estrato || ''} onValueChange={(value) => handleChange('estrato', value)}>\n                    <SelectTrigger className=\"border-[#B0BDB4] focus:border-[#2C3D37]\">\n                      <SelectValue placeholder=\"Selecciona\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {[1, 2, 3, 4, 5, 6].map((est) => (\n                        <SelectItem key={est} value={est.toString()}>{est}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </>\n            )}\n          </div>\n\n          {/* Estado del Inmueble */}\n          {!isLote && (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-[#2C3D37] font-medium\">Estado del Inmueble *</Label>\n                <Select value={localData.estado_inmueble || ''} onValueChange={(value) => handleChange('estado_inmueble', value)}>\n                  <SelectTrigger className=\"border-[#B0BDB4] focus:border-[#2C3D37]\">\n                    <SelectValue placeholder=\"Selecciona\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"nuevo\">Nuevo</SelectItem>\n                    <SelectItem value=\"remodelado\">Remodelado</SelectItem>\n                    <SelectItem value=\"buen_estado\">Buen Estado</SelectItem>\n                    <SelectItem value=\"requiere_reformas_minimas\">Requiere Reformas M√≠nimas</SelectItem>\n                    <SelectItem value=\"requiere_reformas_moderadas\">Requiere Reformas Moderadas</SelectItem>\n                    <SelectItem value=\"requiere_reforma_amplia\">Requiere Reforma Amplia</SelectItem>\n                    <SelectItem value=\"obra_gris\">Obra Gris</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {localData.estado_inmueble === 'remodelado' && (\n                <>\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-[#2C3D37] font-medium\">Tipo de Remodelaci√≥n *</Label>\n                    <Select value={localData.tipo_remodelacion || ''} onValueChange={(value) => {\n                      const updated = { ...localData, tipo_remodelacion: value, descripcion_mejoras: '', valor_remodelacion: '' };\n                      setLocalData(updated);\n                      onUpdate(updated);\n                    }}>\n                      <SelectTrigger className=\"border-[#B0BDB4] focus:border-[#2C3D37]\">\n                        <SelectValue placeholder=\"Selecciona\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"ligera\">Reforma Ligera ($0 - $5'000.000)</SelectItem>\n                        <SelectItem value=\"moderada\">Reforma Moderada ($5'000.000 - $15'000.000)</SelectItem>\n                        <SelectItem value=\"amplia\">Remodelaci√≥n Amplia ($15'000.000 - $20'000.000)</SelectItem>\n                        <SelectItem value=\"premium\">Remodelaci√≥n Premium (M√°s de $20'000.000)</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  {localData.tipo_remodelacion && localData.tipo_remodelacion === 'premium' && (\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-[#2C3D37] font-medium\">Valor estimado de la remodelaci√≥n *</Label>\n                      <Input\n                        type=\"text\"\n                        value={localData.valor_remodelacion || ''}\n                        onChange={(e) => handleChange('valor_remodelacion', e.target.value)}\n                        placeholder=\"Ej: $15.000.000\"\n                        className=\"border-[#B0BDB4] focus:border-[#2C3D37]\"\n                      />\n                    </div>\n                  )}\n\n                  {localData.tipo_remodelacion && (\n                    <div className=\"space-y-2 md:col-span-2\">\n                      <Label className=\"text-[#2C3D37] font-medium\">Describe las mejoras *</Label>\n                      <Input\n                        value={localData.descripcion_mejoras || ''}\n                        onChange={(e) => handleChange('descripcion_mejoras', e.target.value)}\n                        placeholder=\"Ej: Cocina nueva, ba√±os remodelados, pisos en porcelanato...\"\n                        className=\"border-[#B0BDB4] focus:border-[#2C3D37]\"\n                      />\n                    </div>\n                  )}\n                </>\n              )}\n            </div>\n          )}\n\n          {/* Informaci√≥n Complementaria */}\n          <div className=\"space-y-2\">\n            <Label className=\"text-[#2C3D37] font-medium\">Informaci√≥n Complementaria</Label>\n            <div className=\"bg-[#FFFDF5] border border-[#C9C19D]/30 p-3 rounded-md mb-2\">\n              <p className=\"text-xs text-[#4F5B55] leading-relaxed\">\n                <strong>Importante:</strong> Para evitar penalizaciones por \"hallazgos ocultos\" en futuras promesas de compraventa, por favor detalla: situaci√≥n legal (herencias, sucesiones, hipotecas), si el inmueble tiene licencia de construcci√≥n (especialmente lotes), si est√° libre de patrimonio familiar o si requiere ajustes puntuales. <strong>Tambi√©n puedes agregar caracter√≠sticas especiales que no encuentres en el formulario.</strong>\n              </p>\n            </div>\n            <Textarea\n              value={localData.informacion_complementaria || ''}\n              onChange={(e) => handleChange('informacion_complementaria', e.target.value)}\n              placeholder=\"Ej: El inmueble tiene una hipoteca vigente con Davivienda. Es una sucesi√≥n en tr√°mite...\"\n              className=\"min-h-[100px] border-[#B0BDB4] focus:border-[#2C3D37]\"\n            />\n          </div>\n\n          {/* Carga de Documentos Eliminada */}\n\n          <Button\n            onClick={onNext}\n            disabled={!isValid}\n            className=\"w-full bg-[#2C3D37] hover:bg-[#1a2620] text-white rounded-full py-6 text-lg font-medium\"\n          >\n            Continuar al An√°lisis de Mercado\n            <ArrowRight className=\"w-5 h-5 ml-2\" />\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\components\\avaluo\\Step2Analysis.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react/prop-types","severity":2,"message":"'formData' is missing in props validation","line":9,"column":41,"nodeType":"Property","messageId":"missingPropType","endLine":9,"endColumn":49},{"ruleId":"react/prop-types","severity":2,"message":"'onUpdate' is missing in props validation","line":9,"column":51,"nodeType":"Property","messageId":"missingPropType","endLine":9,"endColumn":59},{"ruleId":"react/prop-types","severity":2,"message":"'onNext' is missing in props validation","line":9,"column":61,"nodeType":"Property","messageId":"missingPropType","endLine":9,"endColumn":67},{"ruleId":"react/prop-types","severity":2,"message":"'onBack' is missing in props validation","line":9,"column":69,"nodeType":"Property","messageId":"missingPropType","endLine":9,"endColumn":75},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":29,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":39,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":17}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'formData' and 'searchMutation'. Either include them or remove the dependency array.","line":68,"column":6,"nodeType":"ArrayExpression","endLine":68,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [formData, searchMutation]","fix":{"range":[2554,2556],"text":"[formData, searchMutation]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Loader2, Search, AlertCircle } from 'lucide-react';\n// import { api } from '@/api/client'; // Removed legacy import\nimport { useMutation } from '@tanstack/react-query';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Button } from '@/components/ui/button';\n\nexport default function Step2Analysis({ formData, onUpdate, onNext, onBack }) {\n\n  const searchMutation = useMutation({\n    mutationFn: async (data) => {\n      // 1. Llamada al Backend (Cloudflare Worker)\n      const response = await fetch(import.meta.env.VITE_WORKER_ANALYSIS_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ formData: data })\n      });\n\n      // Check if response is OK before parsing JSON\n      if (!response.ok) {\n        const text = await response.text();\n        let errorMsg = `Error del servidor: ${response.status} ${response.statusText}`;\n        try {\n          const json = JSON.parse(text);\n          if (json.error) errorMsg = json.error;\n        } catch (e) {\n          // If not JSON, use the text body if short, or generic message\n          if (text.length < 200) errorMsg += ` - ${text}`;\n        }\n        throw new Error(errorMsg);\n      }\n\n      let responseData;\n      try {\n        responseData = await response.json();\n      } catch (e) {\n        throw new Error('La respuesta del servidor no es un JSON v√°lido. Es posible que el an√°lisis haya fallado o excedido el tiempo de espera.');\n      }\n\n      if (responseData.error) {\n        throw new Error(responseData.error || (responseData.details ? `: ${responseData.details}` : 'Error desconocido del servidor'));\n      }\n\n      // Validar que la respuesta tenga la estructura esperada\n      if (!responseData || !responseData.comparables) {\n        throw new Error('La respuesta del servidor no contiene datos v√°lidos.');\n      }\n\n      return responseData;\n    },\n    onSuccess: (data) => {\n      // 2. Guardar datos y AVANZAR AUTOM√ÅTICAMENTE\n      // Pasamos los datos a onNext para evitar race conditions en AvaluoInmobiliario\n      onUpdate({ comparables_data: data });\n      onNext({ comparables_data: data });\n    }\n  });\n\n  // Ejecutar b√∫squeda al montar\n  useEffect(() => {\n    if (!searchMutation.isPending && !searchMutation.isSuccess) {\n      searchMutation.mutate(formData);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <div className=\"space-y-8 animate-in fade-in duration-500\">\n      <Card className=\"border-[#B0BDB4]\">\n        <CardHeader>\n          <CardTitle className=\"text-2xl text-[#2C3D37] flex items-center gap-2\">\n            <Search className=\"w-6 h-6 text-[#C9C19D]\" />\n            An√°lisis de Mercado\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n\n          {/* ESTADO: CARGANDO */}\n          {searchMutation.isPending && (\n            <div className=\"text-center py-12\">\n              <Loader2 className=\"w-16 h-16 mx-auto mb-4 text-[#2C3D37] animate-spin\" />\n              <p className=\"text-lg text-[#2C3D37] font-medium mb-2\">\n                Buscando propiedades comparables...\n              </p>\n              <p className=\"text-sm text-[#2C3D37]\">\n                Recopilando informaci√≥n y ejecutando el modelo de valoraci√≥n para obtener el precio estimado.\n                <br />\n                <strong>El c√°lculo tarda 2 minutos aproximadamente.</strong>\n              </p>\n            </div>\n          )}\n\n          {/* ESTADO: √âXITO (Transici√≥n r√°pida, mostramos mensaje breve) */}\n          {searchMutation.isSuccess && (\n            <div className=\"text-center py-12 animate-in zoom-in duration-300\">\n              <div className=\"w-16 h-16 mx-auto mb-4 bg-green-100 rounded-full flex items-center justify-center\">\n                <Search className=\"w-8 h-8 text-green-600\" />\n              </div>\n              <p className=\"text-lg text-[#2C3D37] font-medium\">¬°An√°lisis completado!</p>\n              <p className=\"text-sm text-gray-500\">Generando reporte final...</p>\n            </div>\n          )}\n\n          {/* ESTADO: ERROR */}\n          {searchMutation.isError && (\n            <div className=\"space-y-4\">\n              <Alert className=\"border-red-300 bg-red-50\">\n                <AlertCircle className=\"w-4 h-4 text-red-600\" />\n                <AlertDescription className=\"text-red-800\">\n                  <p className=\"font-medium\">Ocurri√≥ un error al buscar comparables.</p>\n                  <p className=\"text-sm mt-1\">{searchMutation.error?.message || 'Error desconocido'}</p>\n                </AlertDescription>\n              </Alert>\n              <div className=\"flex gap-4\">\n                <Button\n                  onClick={onBack}\n                  variant=\"outline\"\n                  className=\"flex-1 border-[#B0BDB4] text-[#2C3D37] rounded-full\"\n                >\n                  Volver\n                </Button>\n                <Button\n                  onClick={() => searchMutation.mutate(formData)}\n                  className=\"flex-1 bg-[#2C3D37] hover:bg-[#1a2620] text-white rounded-full\"\n                >\n                  Reintentar B√∫squeda\n                </Button>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\components\\avaluo\\Step3Results.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'DollarSign' is defined but never used.","line":21,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"DollarSign"},"fix":{"range":[616,633],"text":""},"desc":"Remove unused variable 'DollarSign'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'X' is defined but never used.","line":22,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":6,"suggestions":[{"messageId":"removeVar","data":{"varName":"X"},"fix":{"range":[633,641],"text":""},"desc":"Remove unused variable 'X'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'Mail' is defined but never used.","line":24,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"Mail"},"fix":{"range":[655,666],"text":""},"desc":"Remove unused variable 'Mail'."}]},{"ruleId":"react/prop-types","severity":2,"message":"'text' is missing in props validation","line":31,"column":23,"nodeType":"Property","messageId":"missingPropType","endLine":31,"endColumn":27},{"ruleId":"react/prop-types","severity":2,"message":"'text.replace' is missing in props validation","line":36,"column":10,"nodeType":"Identifier","messageId":"missingPropType","endLine":36,"endColumn":17},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":48,"column":97,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":48,"endColumn":98,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1565,1566],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1565,1565],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\,.","line":48,"column":99,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":48,"endColumn":100,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1567,1568],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1567,1567],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":49,"column":23,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":49,"endColumn":24,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1648,1649],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1648,1648],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":100,"column":48,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":100,"endColumn":49,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4381,4382],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4381,4381],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\).","line":100,"column":50,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":100,"endColumn":51,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4383,4384],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4383,4383],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":101,"column":92,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":101,"endColumn":93,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4484,4485],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4484,4484],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\).","line":101,"column":94,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":101,"endColumn":95,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4486,4487],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4486,4486],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"react/prop-types","severity":2,"message":"'formData' is missing in props validation","line":127,"column":40,"nodeType":"Property","messageId":"missingPropType","endLine":127,"endColumn":48},{"ruleId":"no-unused-vars","severity":2,"message":"'onUpdate' is defined but never used.","line":127,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":127,"endColumn":58,"suggestions":[{"messageId":"removeVar","data":{"varName":"onUpdate"},"fix":{"range":[5464,5474],"text":""},"desc":"Remove unused variable 'onUpdate'."}]},{"ruleId":"react/prop-types","severity":2,"message":"'onUpdate' is missing in props validation","line":127,"column":50,"nodeType":"Property","messageId":"missingPropType","endLine":127,"endColumn":58},{"ruleId":"react/prop-types","severity":2,"message":"'onNext' is missing in props validation","line":127,"column":60,"nodeType":"Property","messageId":"missingPropType","endLine":127,"endColumn":66},{"ruleId":"react/prop-types","severity":2,"message":"'onBack' is missing in props validation","line":127,"column":68,"nodeType":"Property","messageId":"missingPropType","endLine":127,"endColumn":74},{"ruleId":"react/prop-types","severity":2,"message":"'onReset' is missing in props validation","line":127,"column":76,"nodeType":"Property","messageId":"missingPropType","endLine":127,"endColumn":83},{"ruleId":"react/prop-types","severity":2,"message":"'autoDownloadPDF' is missing in props validation","line":127,"column":85,"nodeType":"Property","messageId":"missingPropType","endLine":127,"endColumn":100},{"ruleId":"react/prop-types","severity":2,"message":"'formData.comparables_data' is missing in props validation","line":144,"column":35,"nodeType":"Identifier","messageId":"missingPropType","endLine":144,"endColumn":51},{"ruleId":"react/prop-types","severity":2,"message":"'formData.codigo_avaluo' is missing in props validation","line":145,"column":43,"nodeType":"Identifier","messageId":"missingPropType","endLine":145,"endColumn":56},{"ruleId":"react/prop-types","severity":2,"message":"'formData.email' is missing in props validation","line":172,"column":34,"nodeType":"Identifier","messageId":"missingPropType","endLine":172,"endColumn":39},{"ruleId":"react/prop-types","severity":2,"message":"'formData.contacto_email' is missing in props validation","line":172,"column":52,"nodeType":"Identifier","messageId":"missingPropType","endLine":172,"endColumn":66},{"ruleId":"react/prop-types","severity":2,"message":"'formData.id' is missing in props validation","line":195,"column":22,"nodeType":"Identifier","messageId":"missingPropType","endLine":195,"endColumn":24},{"ruleId":"react/prop-types","severity":2,"message":"'formData.email' is missing in props validation","line":195,"column":38,"nodeType":"Identifier","messageId":"missingPropType","endLine":195,"endColumn":43},{"ruleId":"react/prop-types","severity":2,"message":"'formData.contacto_email' is missing in props validation","line":195,"column":56,"nodeType":"Identifier","messageId":"missingPropType","endLine":195,"endColumn":70},{"ruleId":"react/prop-types","severity":2,"message":"'formData.email' is missing in props validation","line":196,"column":67,"nodeType":"Identifier","messageId":"missingPropType","endLine":196,"endColumn":72},{"ruleId":"react/prop-types","severity":2,"message":"'formData.contacto_email' is missing in props validation","line":196,"column":85,"nodeType":"Identifier","messageId":"missingPropType","endLine":196,"endColumn":99},{"ruleId":"react/prop-types","severity":2,"message":"'formData.comparables_data' is missing in props validation","line":207,"column":27,"nodeType":"Identifier","messageId":"missingPropType","endLine":207,"endColumn":43},{"ruleId":"react/prop-types","severity":2,"message":"'formData.area_construida' is missing in props validation","line":227,"column":49,"nodeType":"Identifier","messageId":"missingPropType","endLine":227,"endColumn":64},{"ruleId":"react/prop-types","severity":2,"message":"'formData.area_total' is missing in props validation","line":227,"column":77,"nodeType":"Identifier","messageId":"missingPropType","endLine":227,"endColumn":87},{"ruleId":"react/prop-types","severity":2,"message":"'formData.tipo_inmueble' is missing in props validation","line":228,"column":30,"nodeType":"Identifier","messageId":"missingPropType","endLine":228,"endColumn":43},{"ruleId":"react/prop-types","severity":2,"message":"'formData.uso_lote' is missing in props validation","line":293,"column":51,"nodeType":"Identifier","messageId":"missingPropType","endLine":293,"endColumn":59},{"ruleId":"react/prop-types","severity":2,"message":"'formData.uso_lote' is missing in props validation","line":295,"column":63,"nodeType":"Identifier","messageId":"missingPropType","endLine":295,"endColumn":71},{"ruleId":"react/prop-types","severity":2,"message":"'formData.municipio' is missing in props validation","line":299,"column":58,"nodeType":"Identifier","messageId":"missingPropType","endLine":299,"endColumn":67},{"ruleId":"react/prop-types","severity":2,"message":"'formData.ciudad' is missing in props validation","line":299,"column":80,"nodeType":"Identifier","messageId":"missingPropType","endLine":299,"endColumn":86},{"ruleId":"react/prop-types","severity":2,"message":"'formData.tipo_inmueble' is missing in props validation","line":304,"column":51,"nodeType":"Identifier","messageId":"missingPropType","endLine":304,"endColumn":64},{"ruleId":"react/prop-types","severity":2,"message":"'formData.tipo_inmueble' is missing in props validation","line":306,"column":62,"nodeType":"Identifier","messageId":"missingPropType","endLine":306,"endColumn":75},{"ruleId":"react/prop-types","severity":2,"message":"'formData.habitaciones' is missing in props validation","line":312,"column":52,"nodeType":"Identifier","messageId":"missingPropType","endLine":312,"endColumn":64},{"ruleId":"react/prop-types","severity":2,"message":"'formData.habitaciones' is missing in props validation","line":314,"column":63,"nodeType":"Identifier","messageId":"missingPropType","endLine":314,"endColumn":75},{"ruleId":"react/prop-types","severity":2,"message":"'formData.banos' is missing in props validation","line":317,"column":52,"nodeType":"Identifier","messageId":"missingPropType","endLine":317,"endColumn":57},{"ruleId":"react/prop-types","severity":2,"message":"'formData.banos' is missing in props validation","line":319,"column":62,"nodeType":"Identifier","messageId":"missingPropType","endLine":319,"endColumn":67},{"ruleId":"react/prop-types","severity":2,"message":"'formData.estado_inmueble' is missing in props validation","line":322,"column":52,"nodeType":"Identifier","messageId":"missingPropType","endLine":322,"endColumn":67},{"ruleId":"react/prop-types","severity":2,"message":"'formData.estado' is missing in props validation","line":322,"column":80,"nodeType":"Identifier","messageId":"missingPropType","endLine":322,"endColumn":86},{"ruleId":"react/prop-types","severity":2,"message":"'formData.estado_inmueble' is missing in props validation","line":324,"column":62,"nodeType":"Identifier","messageId":"missingPropType","endLine":324,"endColumn":77},{"ruleId":"react/prop-types","severity":2,"message":"'formData.estado' is missing in props validation","line":324,"column":90,"nodeType":"Identifier","messageId":"missingPropType","endLine":324,"endColumn":96},{"ruleId":"react/prop-types","severity":2,"message":"'formData.estrato' is missing in props validation","line":327,"column":52,"nodeType":"Identifier","messageId":"missingPropType","endLine":327,"endColumn":59},{"ruleId":"react/prop-types","severity":2,"message":"'formData.estrato' is missing in props validation","line":329,"column":70,"nodeType":"Identifier","messageId":"missingPropType","endLine":329,"endColumn":77},{"ruleId":"react/prop-types","severity":2,"message":"'formData.id' is missing in props validation","line":564,"column":43,"nodeType":"Identifier","messageId":"missingPropType","endLine":564,"endColumn":45},{"ruleId":"react/prop-types","severity":2,"message":"'formData.email' is missing in props validation","line":564,"column":59,"nodeType":"Identifier","messageId":"missingPropType","endLine":564,"endColumn":64},{"ruleId":"react/prop-types","severity":2,"message":"'formData.contacto_email' is missing in props validation","line":564,"column":77,"nodeType":"Identifier","messageId":"missingPropType","endLine":564,"endColumn":91}],"suppressedMessages":[],"errorCount":52,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useEffect } from 'react';\r\nimport { useMutation } from '@tanstack/react-query';\r\nimport { generateAvaluoEmailHtml } from '@/lib/emailGenerator';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport {\r\n    ArrowLeft,\r\n    ArrowRight,\r\n    TrendingUp,\r\n    Home,\r\n    Calculator,\r\n    AlertCircle,\r\n    Info,\r\n    ChevronDown,\r\n    ChevronUp,\r\n    FileText,\r\n    Globe,\r\n    Download,\r\n    DollarSign,\r\n    X,\r\n    Loader2,\r\n    Mail,\r\n    Send\r\n} from 'lucide-react';\r\nimport TablaComparables from './TablaComparables';\r\nimport BotonPDF from './BotonPDF';\r\n\r\n// --- COMPONENTE DE FORMATO DE TEXTO ---\r\nconst AnalisisAI = ({ text }) => {\r\n    if (!text) return null;\r\n\r\n    // 1. Limpieza de LaTeX b√°sico (Igual que en BotonPDF)\r\n    const cleanText = text\r\n        .replace(/^-{3,}\\s*$/gm, '')\r\n        .replace(/^[ \\t]*[-_]{2,}[ \\t]*$/gm, '')\r\n        .replace(/\\n{3,}/g, '\\n\\n')\r\n        .replace(/\\\\\\(/g, '')\r\n        .replace(/\\\\\\)/g, '')\r\n        .replace(/\\\\\\[/g, '')\r\n        .replace(/\\\\\\]/g, '')\r\n        .replace(/\\\\frac\\s*\\{([^{}]+)\\}\\s*\\{([^{}]+)\\}/g, '$1 / $2')\r\n        .replace(/\\\\text\\{([^}]+)\\}/g, '$1')\r\n        .replace(/\\\\sum/g, '‚àë')\r\n        .replace(/\\\\approx/g, '‚âà')\r\n        .replace(/\\s+COP\\/m¬≤/g, ' COP/m¬≤')\r\n        .replace(/Promedio precio por m¬≤\\s*=\\s*(?:\\\\frac\\{[^{}]+\\}\\{[^{}]+\\}|[^\\n‚âà]+)\\s*‚âà\\s*([\\d\\.\\,]+)\\s*COP\\/m¬≤/gi, 'Promedio precio por m¬≤ ‚âà $1 COP/m¬≤')\r\n        .replace(/^[\\d\\.]+\\s+(?=[A-Z])/gm, '')\r\n        .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>');\r\n\r\n    const blocks = cleanText.split('\\n\\n');\r\n\r\n    return (\r\n        <div className=\"text-[#4F5B55] font-raleway columns-1 md:columns-2 gap-10 space-y-4\">\r\n            {blocks.map((block, index) => {\r\n                const trimmed = block.trim();\r\n                if (!trimmed) return null;\r\n\r\n                // HEADERS\r\n                if (trimmed.startsWith('#')) {\r\n                    const title = trimmed.replace(/^#+\\s*/, '');\r\n                    return (\r\n                        <h3 key={index} className=\"font-outfit font-bold text-lg text-[#2C3D37] mt-6 first:mt-0 mb-3 border-b border-[#C9C19D]/50 pb-1 break-inside-avoid\">\r\n                            {title}\r\n                        </h3>\r\n                    );\r\n                }\r\n\r\n                // TABLAS MARKDOWN\r\n                if (trimmed.startsWith('|')) {\r\n                    const rows = trimmed.split('\\n').filter(r => r.trim());\r\n                    return (\r\n                        <div key={index} className=\"overflow-x-auto mb-4 break-inside-avoid shadow-sm rounded-lg border border-[#E0E5E2] bg-white\">\r\n                            <table className=\"w-full text-xs border-collapse\">\r\n                                <tbody>\r\n                                    {rows.map((row, rIdx) => {\r\n                                        if (row.includes('---')) return null; // Ignorar separadores\r\n                                        const cells = row.split('|').filter(c => c.trim() !== '');\r\n                                        if (cells.length === 0) return null;\r\n\r\n                                        const isHeader = rIdx === 0;\r\n                                        return (\r\n                                            <tr key={rIdx} className={isHeader ? \"bg-[#F0ECD9] text-[#2C3D37] font-bold\" : \"border-t border-[#f0f0f0] text-[#4F5B55]\"}>\r\n                                                {cells.map((cell, cIdx) => (\r\n                                                    <td key={cIdx} className=\"p-2 border-r border-[#f0f0f0] last:border-r-0 text-center last:text-right first:text-left\">\r\n                                                        {cell.trim()}\r\n                                                    </td>\r\n                                                ))}\r\n                                            </tr>\r\n                                        )\r\n                                    })}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    )\r\n                }\r\n\r\n                // LISTAS\r\n                if (trimmed.match(/^[-*‚Ä¢]|^\\d+[\\.\\)]/)) {\r\n                    const items = trimmed.split('\\n').map((line) => line.replace(/^[-*‚Ä¢\\d+[\\.\\)]\\s*/, ''));\r\n                    return (\r\n                        <ul key={index} className=\"list-none space-y-2 mb-4 break-inside-avoid\">\r\n                            {items.map((item, i) => (\r\n                                <li key={i} className=\"flex gap-2 text-sm leading-relaxed text-[#4F5B55]\">\r\n                                    <span className=\"font-bold mt-0.5\">‚Ä¢</span>\r\n                                    <span dangerouslySetInnerHTML={{ __html: item }} />\r\n                                </li>\r\n                            ))}\r\n                        </ul>\r\n                    );\r\n                }\r\n\r\n                // PARRAGRAFOS\r\n                return (\r\n                    <p key={index} className=\"mb-4 text-sm leading-relaxed text-justify break-inside-avoid text-[#4F5B55]\" dangerouslySetInnerHTML={{ __html: trimmed }} />\r\n                );\r\n            })}\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n\r\n\r\n\r\nexport default function Step3Results({ formData, onUpdate, onNext, onBack, onReset, autoDownloadPDF }) {\r\n    const [mostrarComparables, setMostrarComparables] = useState(false);\r\n    const pdfButtonRef = useRef(null);\r\n\r\n    // Auto-download PDF cuando viene desde email\r\n    useEffect(() => {\r\n        if (autoDownloadPDF && pdfButtonRef.current) {\r\n            // Esperar un momento para que la p√°gina cargue completamente\r\n            const timer = setTimeout(() => {\r\n                pdfButtonRef.current?.click();\r\n            }, 1000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [autoDownloadPDF]);\r\n\r\n    const sendEmailMutation = useMutation({\r\n        mutationFn: async () => {\r\n            const data = formData.comparables_data || formData;\r\n            const codigoAvaluo = formData.codigo_avaluo || data.codigo_avaluo;\r\n\r\n            // Recalcular valores para el email (misma l√≥gica que en render)\r\n            const valorVentaDirecta = validarNumero(data.valor_estimado_venta_directa);\r\n            const valorRentabilidad = validarNumero(data.valor_estimado_rentabilidad);\r\n            const rangoMin = validarNumero(data.rango_valor_min);\r\n            const rangoMax = validarNumero(data.rango_valor_max);\r\n\r\n            let valorPrincipal = validarNumero(data.valor_final);\r\n            if (!valorPrincipal) {\r\n                if (rangoMin && rangoMax) valorPrincipal = Math.round((rangoMin + rangoMax) / 2);\r\n                else if (valorVentaDirecta && valorRentabilidad) valorPrincipal = Math.round(valorVentaDirecta * 0.80 + valorRentabilidad * 0.20);\r\n                else valorPrincipal = valorVentaDirecta || valorRentabilidad || null;\r\n            }\r\n\r\n            const emailHtml = generateAvaluoEmailHtml({\r\n                data: { ...data, ...formData },\r\n                codigoAvaluo,\r\n                valorEstimadoFinal: valorPrincipal,\r\n                rangoMin,\r\n                rangoMax\r\n            });\r\n\r\n            const response = await fetch(`${import.meta.env.VITE_WORKER_EMAIL_URL}/send-email`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    to: formData.email || formData.contacto_email, // Priorizar datos guardados en BD\r\n                    subject: `Reporte de Aval√∫o: ${data.tipo_inmueble} en ${data.barrio}`,\r\n                    htmlBody: emailHtml\r\n                }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json();\r\n                throw new Error(errorData.error || 'Error al enviar el correo');\r\n            }\r\n            return true;\r\n        },\r\n        onSuccess: () => {\r\n            alert(\"¬°Correo reenviado con √©xito!\");\r\n        },\r\n        onError: (error) => {\r\n            console.error(\"Error reenviando correo:\", error);\r\n            alert(\"Error al reenviar el correo. Por favor intenta de nuevo.\");\r\n        }\r\n    });\r\n\r\n    const handleAction = () => {\r\n        // Si ya tiene ID y datos de contacto, reenviar directamente\r\n        if (formData.id && (formData.email || formData.contacto_email)) {\r\n            if (confirm(`¬øDeseas reenviar el reporte a ${formData.email || formData.contacto_email}?`)) {\r\n                sendEmailMutation.mutate();\r\n            }\r\n        } else {\r\n            // Si es nuevo o no tiene datos, ir al formulario\r\n            onNext();\r\n        }\r\n    };\r\n\r\n    if (!formData) return renderErrorState('Datos del formulario no disponibles', onBack);\r\n\r\n    const data = formData.comparables_data || formData;\r\n    if (!data || (Array.isArray(data.comparables) && data.comparables.length === 0 && !data.valor_final)) {\r\n        if (!data.valor_final && !data.valor_estimado_venta_directa && !data.valor_estimado_rentabilidad) {\r\n            return renderErrorState(\"An√°lisis de mercado insuficiente\", onBack);\r\n        }\r\n    }\r\n\r\n    const valorVentaDirecta = validarNumero(data.valor_estimado_venta_directa);\r\n    const valorRentabilidad = validarNumero(data.valor_estimado_rentabilidad);\r\n    const rangoMin = validarNumero(data.rango_valor_min);\r\n    const rangoMax = validarNumero(data.rango_valor_max);\r\n    const precioM2Usado = validarNumero(data.precio_m2_final) || validarNumero(data.precio_m2_usado) || validarNumero(data.precio_m2_venta_directa);\r\n\r\n    let valorPrincipal = validarNumero(data.valor_final);\r\n    if (!valorPrincipal) {\r\n        if (rangoMin && rangoMax) valorPrincipal = Math.round((rangoMin + rangoMax) / 2);\r\n        else if (valorVentaDirecta && valorRentabilidad) valorPrincipal = Math.round(valorVentaDirecta * 0.80 + valorRentabilidad * 0.20);\r\n        else valorPrincipal = valorVentaDirecta || valorRentabilidad || null;\r\n    }\r\n\r\n    const areaInmueble = validarNumero(formData.area_construida || formData.area_total || data.area_construida || data.area_total);\r\n    const esLote = (formData.tipo_inmueble || '').toLowerCase().includes('lote');\r\n\r\n    const formatCurrency = (value) => {\r\n        const num = validarNumero(value);\r\n        if (num === null) return '‚Äî';\r\n        return '$ ' + Math.round(num).toLocaleString('es-CO');\r\n    };\r\n\r\n    const formatNumber = (value) => {\r\n        const num = validarNumero(value);\r\n        if (num === null) return '‚Äî';\r\n        return Math.round(num).toLocaleString('es-CO');\r\n    };\r\n\r\n    const tieneComparables = Array.isArray(data.comparables) && data.comparables.length > 0;\r\n    const tieneAnalisisCompleto = data.perplexity_full_text && data.perplexity_full_text.length > 50;\r\n    const tieneResumen = data.resumen_busqueda && data.resumen_busqueda.length > 10;\r\n\r\n    // Correcci√≥n 3: Usar contadores consistentes del Worker\r\n    const totalComparables = validarNumero(data.comparables_usados_en_calculo) || validarNumero(data.total_comparables);\r\n    const totalEncontrados = validarNumero(data.comparables_totales_encontrados);\r\n    const totalVenta = validarNumero(data.total_comparables_venta);\r\n    const totalArriendo = validarNumero(data.total_comparables_arriendo);\r\n    const portales = data.portales_consultados || [];\r\n\r\n    return (\r\n        <div className=\"space-y-8 animate-in fade-in duration-500 pb-10\">\r\n\r\n            {/* 1. SECCI√ìN HERO */}\r\n            <Card className=\"border-none shadow-lg bg-gradient-to-br from-[#2C3D37] to-[#1a2620] text-white overflow-hidden relative\">\r\n                <div className=\"absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-[#C9C19D] opacity-10 rounded-full blur-2xl\"></div>\r\n                <CardHeader className=\"pb-2 relative z-10\">\r\n                    <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                        <div>\r\n                            <CardTitle className=\"text-xl md:text-2xl font-outfit font-semibold flex items-center gap-3\">\r\n                                <div className=\"p-2 bg-white/10 rounded-lg\"><Home className=\"w-6 h-6 text-[#C9C19D]\" /></div>\r\n                                Valor Comercial Estimado\r\n                            </CardTitle>\r\n                            <p className=\"text-sm text-[#D3DDD6] mt-2 font-raleway max-w-lg\">\r\n                                {esLote\r\n                                    ? 'Valor obtenido a partir del an√°lisis de mercado y m√©todo residual, sin aplicar enfoque de rentabilidad.'\r\n                                    : 'Determinaci√≥n del valor comercial basada en un an√°lisis t√©cnico ponderado que integra el comportamiento real del mercado local y la validaci√≥n experta de nuestra inteligencia artificial.'}\r\n                            </p>\r\n                        </div>\r\n                        <span className=\"inline-flex self-start md:self-center items-center rounded-full bg-[#C9C19D]/90 px-4 py-1.5 text-xs md:text-sm font-semibold text-[#1a2620] shadow-sm\">\r\n                            <TrendingUp className=\"w-3 h-3 mr-2\" />\r\n                            Estimaci√≥n IA\r\n                        </span>\r\n                    </div>\r\n                </CardHeader>\r\n                <CardContent className=\"pt-4 relative z-10\">\r\n                    <div className=\"flex flex-col lg:flex-row items-end lg:items-center justify-between gap-8\">\r\n                        <div>\r\n                            <div className=\"text-4xl md:text-6xl font-bold font-outfit tracking-tight\">\r\n                                {formatCurrency(valorPrincipal)}\r\n                            </div>\r\n                            <p className=\"text-xs md:text-sm text-[#D3DDD6] mt-2 opacity-80\">COP (Pesos Colombianos)</p>\r\n\r\n                            {/* Ficha T√©cnica Resumida */}\r\n                            <div className=\"flex flex-wrap gap-2 mt-4\">\r\n                                {esLote ? (\r\n                                    <>\r\n                                        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/10 text-white border border-white/20\">\r\n                                            üìê {formatNumber(areaInmueble)} m¬≤\r\n                                        </span>\r\n                                        {formData.uso_lote && (\r\n                                            <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/10 text-white border border-white/20\">\r\n                                                üèóÔ∏è {formData.uso_lote}\r\n                                            </span>\r\n                                        )}\r\n                                        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/10 text-white border border-white/20\">\r\n                                            üìç {formData.municipio || formData.ciudad || '‚Äî'}\r\n                                        </span>\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        {formData.tipo_inmueble && (\r\n                                            <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/10 text-white border border-white/20\">\r\n                                                üè† {formData.tipo_inmueble}\r\n                                            </span>\r\n                                        )}\r\n                                        <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/10 text-white border border-white/20\">\r\n                                            üìê {formatNumber(areaInmueble)} m¬≤\r\n                                        </span>\r\n                                        {(formData.habitaciones || data.habitaciones) && (\r\n                                            <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/10 text-white border border-white/20\">\r\n                                                üõèÔ∏è {formData.habitaciones || data.habitaciones} hab\r\n                                            </span>\r\n                                        )}\r\n                                        {(formData.banos || data.banos) && (\r\n                                            <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/10 text-white border border-white/20\">\r\n                                                üöø {formData.banos || data.banos} ba√±os\r\n                                            </span>\r\n                                        )}\r\n                                        {(formData.estado_inmueble || formData.estado || data.estado_inmueble || data.estado) && (\r\n                                            <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/10 text-white border border-white/20\">\r\n                                                ‚ú® {(formData.estado_inmueble || formData.estado || data.estado_inmueble || data.estado || '').replace(/_/g, ' ')}\r\n                                            </span>\r\n                                        )}\r\n                                        {(formData.estrato || data.estrato) && (\r\n                                            <span className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/10 text-white border border-white/20\">\r\n                                                üìä Estrato {formData.estrato || data.estrato}\r\n                                            </span>\r\n                                        )}\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"bg-[#FFFFFF]/10 backdrop-blur-sm border border-[#FFFFFF]/10 rounded-xl p-4 w-full lg:w-auto min-w-[280px] space-y-3\">\r\n                            <div className=\"flex justify-between items-start border-b border-white/10 pb-2\">\r\n                                <span className=\"text-[#D3DDD6] text-sm self-center\">Rango Sugerido</span>\r\n                                <div className=\"text-right\">\r\n                                    <div className=\"font-semibold font-outfit text-white\">{rangoMin ? formatCurrency(rangoMin) : '‚Äî'}</div>\r\n                                    <div className=\"font-semibold font-outfit text-white\">{rangoMax ? formatCurrency(rangoMax) : '‚Äî'}</div>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex justify-between items-center border-b border-white/10 pb-2\">\r\n                                <span className=\"text-[#D3DDD6] text-sm\">Precio m¬≤ Ref.</span>\r\n                                <span className=\"font-semibold font-outfit text-white\">{formatCurrency(precioM2Usado)}/m¬≤</span>\r\n                            </div>\r\n                            {totalComparables !== null && (\r\n                                <div className=\"flex justify-between items-center\">\r\n                                    <span className=\"text-[#D3DDD6] text-sm\">Muestra</span>\r\n                                    <div className=\"text-right\">\r\n                                        <span className=\"font-semibold block\">{totalComparables} inmuebles</span>\r\n                                        {totalEncontrados && totalEncontrados > totalComparables ? (\r\n                                            <span className=\"text-[10px] text-[#A3B2AA] block\">(de {totalEncontrados} encontrados)</span>\r\n                                        ) : (\r\n                                            <span className=\"text-[10px] text-[#A3B2AA] block\">({totalVenta || 0} venta, {totalArriendo || 0} arriendo)</span>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n                {/* Correcci√≥n 4: Explicaci√≥n del Valor Final */}\r\n                <div className=\"px-6 pb-6 relative z-10\">\r\n                    <p className=\"text-xs text-[#D3DDD6]/80 italic leading-relaxed\">\r\n                        El valor final es una recomendaci√≥n t√©cnica ponderada entre el enfoque de mercado y el de rentabilidad,\r\n                        priorizando el m√©todo con datos m√°s consistentes seg√∫n la cantidad, homogeneidad y dispersi√≥n de los\r\n                        comparables disponibles.\r\n                    </p>\r\n                </div>\r\n            </Card>\r\n\r\n            {/* 2. M√âTODOS DESGLOSADOS (ADAPTATIVO) */}\r\n            <div className={valorRentabilidad ? \"grid grid-cols-1 md:grid-cols-2 gap-6\" : \"max-w-lg mx-auto\"}>\r\n                {/* Venta Directa */}\r\n                <Card className=\"border-[#E0E5E2] shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n                    <CardHeader className=\"pb-3 bg-[#F9FAF9] border-b border-[#F0F2F1]\">\r\n                        <CardTitle className=\"text-base text-[#2C3D37] flex items-center gap-2 font-outfit\">\r\n                            <TrendingUp className=\"w-4 h-4 text-[#C9C19D]\" />\r\n                            {esLote ? 'Metodolog√≠a Ajustada (Lotes)' : 'Enfoque de Mercado (Comparables)'}\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"pt-6 space-y-4\">\r\n                        <div className=\"text-center\">\r\n                            <div className=\"text-3xl font-bold text-[#2C3D37] mt-1 font-outfit\">\r\n                                {formatCurrency(valorVentaDirecta)}\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-sm text-[#4F5B55] leading-relaxed text-center px-4 mt-1 border-b border-dashed border-[#E0E5E2] pb-3\">\r\n                            {esLote\r\n                                ? 'Calculado a partir del precio promedio por m¬≤ de lotes comparables y ajuste residual.'\r\n                                : 'Calculado a partir del precio promedio por m¬≤ de las propiedades comparables (precio promedio por m¬≤ √ó √°rea del inmueble).'}\r\n                        </p>\r\n                        <div className=\"flex justify-between items-center pt-2 mt-1\">\r\n                            <span className=\"text-sm text-[#7A8C85]\">Precio m¬≤ estimado:</span>\r\n                            <span className=\"text-sm font-semibold text-[#2C3D37]\">\r\n                                {areaInmueble && valorVentaDirecta ? `${formatCurrency(valorVentaDirecta / areaInmueble)}/m¬≤` : '‚Äî'}\r\n                            </span>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                {/* Rentabilidad (Condicional) */}\r\n                {valorRentabilidad && (\r\n                    <Card className=\"border-[#E0E5E2] shadow-sm hover:shadow-md transition-shadow duration-200\">\r\n                        <CardHeader className=\"pb-3 bg-[#F9FAF9] border-b border-[#F0F2F1]\">\r\n                            <CardTitle className=\"text-base text-[#2C3D37] flex items-center gap-2 font-outfit\">\r\n                                <Calculator className=\"w-4 h-4 text-[#C9C19D]\" />\r\n                                Enfoque de Rentabilidad (Capitalizaci√≥n)\r\n                            </CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"pt-6 space-y-4\">\r\n                            <div className=\"text-center\">\r\n                                <div className=\"text-3xl font-bold text-[#2C3D37] mt-1 font-outfit\">\r\n                                    {formatCurrency(valorRentabilidad)}\r\n                                </div>\r\n                            </div>\r\n                            <p className=\"text-sm text-[#4F5B55] leading-relaxed text-center px-4 mt-1 border-b border-dashed border-[#E0E5E2] pb-3\">\r\n                                Calculado a partir del canon mensual estimado y la f√≥rmula del rendimiento (yield) del sector (canon mensual estimado √∑ yield mensual).\r\n                            </p>\r\n                            {/* Correcci√≥n 5: Nota sobre Yield */}\r\n                            {data.yield_mensual_mercado && (\r\n                                <p className=\"text-xs text-[#7A8C85] italic px-4 mt-2\">\r\n                                    El yield utilizado ({(data.yield_mensual_mercado * 100).toFixed(2)}% mensual) corresponde al promedio\r\n                                    observado en arriendos residenciales del sector, ajustado autom√°ticamente por zona y disponibilidad de comparables.\r\n                                </p>\r\n                            )}\r\n                            <div className=\"flex justify-between items-center pt-2 mt-1\">\r\n                                <span className=\"text-sm text-[#7A8C85]\">Precio m¬≤ impl√≠cito:</span>\r\n                                <span className=\"text-sm font-semibold text-[#2C3D37]\">\r\n                                    {areaInmueble && valorRentabilidad ? `${formatCurrency(valorRentabilidad / areaInmueble)}/m¬≤` : '‚Äî'}\r\n                                </span>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                )}\r\n            </div>\r\n\r\n            <Alert className=\"border-[#C9C19D]/30 bg-[#FFFDF5] text-[#2C3D37]\">\r\n                <Info className=\"h-4 w-4 text-[#C4A356]\" />\r\n                <AlertDescription className=\"text-sm\">\r\n                    Este informe es una estimaci√≥n automatizada basada en datos estad√≠sticos. <strong>No reemplaza un aval√∫o certificado profesional.</strong>\r\n                </AlertDescription>\r\n            </Alert>\r\n\r\n            {/* 3. RESUMEN DEL MERCADO (ESTILO ESTIMACI√ìN IA) */}\r\n            {tieneResumen && (\r\n                <div className=\"bg-[#C9C19D]/90 rounded-xl p-6 shadow-sm border border-[#C9C19D]\">\r\n                    <h3 className=\"font-outfit font-semibold text-lg text-[#1a2620] mb-3 flex items-center gap-2\">\r\n                        <span className=\"w-1.5 h-6 bg-[#1a2620] rounded-full\"></span>\r\n                        Resumen del Mercado\r\n                    </h3>\r\n                    <p className=\"text-sm text-[#1a2620] leading-relaxed font-raleway whitespace-pre-line font-medium\" dangerouslySetInnerHTML={{ __html: data.resumen_busqueda.replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>') }} />\r\n                </div>\r\n            )}\r\n\r\n            {/* AVISO DE DESCARGA PDF */}\r\n            <Alert className=\"border-[#C9C19D]/30 bg-[#FFFDF5] text-[#2C3D37]\">\r\n                <Download className=\"h-4 w-4 text-[#C9C19D]\" />\r\n                <AlertDescription className=\"text-sm\">\r\n                    <strong>Descarga el reporte completo en PDF</strong> para compartir o guardar esta valoraci√≥n con todos los detalles y comparables.\r\n                </AlertDescription>\r\n            </Alert>\r\n\r\n            {/* 4. PORTALES CONSULTADOS (BLOQUE DESTACADO TIPO ALERTA) */}\r\n            {portales.length > 0 && (\r\n                <Alert className=\"border-[#C9C19D]/30 bg-[#FFFDF5] text-[#2C3D37]\">\r\n                    <Globe className=\"h-4 w-4 text-[#C9C19D]\" />\r\n                    <div className=\"flex flex-col gap-2 w-full\">\r\n                        <span className=\"text-sm font-semibold\">Fuentes Consultadas:</span>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {portales.map((portal, idx) => (\r\n                                <Badge key={idx} variant=\"outline\" className=\"bg-white border-[#C9C19D]/50 text-[#4F5B55] font-normal hover:bg-[#E0E5E2]\">\r\n                                    {portal}\r\n                                </Badge>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </Alert>\r\n            )}\r\n\r\n            {/* 5. TABLA DE COMPARABLES */}\r\n            {tieneComparables && (\r\n                <>\r\n                    {/* Alert de nivel de confianza bajo */}\r\n                    {data.nivel_confianza === 'Bajo' && (\r\n                        <Alert variant=\"default\" className=\"border-yellow-300 bg-yellow-50 mb-6 mt-6\">\r\n                            <AlertCircle className=\"h-4 w-4 text-yellow-600\" />\r\n                            <AlertDescription className=\"text-yellow-800\">\r\n                                <strong>Nota:</strong> Este an√°lisis tiene un nivel de confianza bajo debido a\r\n                                informaci√≥n limitada en la zona. Se complement√≥ con datos de zonas similares\r\n                                y promedios municipales.\r\n                            </AlertDescription>\r\n                        </Alert>\r\n                    )}\r\n\r\n                    <Card className=\"border-[#E0E5E2] shadow-sm overflow-hidden transition-all duration-300 mt-6\">\r\n                        <button\r\n                            onClick={() => setMostrarComparables(!mostrarComparables)}\r\n                            className=\"w-full flex items-center justify-between p-4 bg-[#F9FAF9] hover:bg-[#F0F2F1] transition-colors text-left\"\r\n                        >\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"p-1.5 bg-white border border-[#E0E5E2] rounded-md text-[#2C3D37]\">\r\n                                    <FileText className=\"w-4 h-4\" />\r\n                                </div>\r\n                                <div>\r\n                                    <h3 className=\"font-outfit font-semibold text-base text-[#2C3D37]\">Propiedades Comparables</h3>\r\n                                    <p className=\"text-xs text-[#7A8C85]\">Ver los {data.comparables.length} inmuebles usados para el c√°lculo</p>\r\n                                </div>\r\n                            </div>\r\n                            {mostrarComparables ? <ChevronUp className=\"w-5 h-5 text-[#7A8C85]\" /> : <ChevronDown className=\"w-5 h-5 text-[#7A8C85]\" />}\r\n                        </button>\r\n                        {mostrarComparables && (\r\n                            <div className=\"border-t border-[#E0E5E2] animate-in slide-in-from-top-2 duration-300\">\r\n                                <TablaComparables comparables={data.comparables} yieldMensualMercado={data.yield_mensual_mercado} />\r\n                            </div>\r\n                        )}\r\n                    </Card>\r\n                </>\r\n            )}\r\n\r\n            {/* 6. AN√ÅLISIS COMPLETO IA */}\r\n            {tieneAnalisisCompleto && (\r\n                <Card className=\"border-[#E0E5E2] shadow-sm overflow-hidden mt-8\">\r\n                    <CardHeader className=\"bg-[#2C3D37] py-4\">\r\n                        <CardTitle className=\"text-base text-white font-outfit flex items-center gap-2\">\r\n                            <span className=\"bg-[#C9C19D] text-[#2C3D37] text-[10px] font-bold px-2 py-0.5 rounded\">AI</span>\r\n                            An√°lisis Detallado del Modelo\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"p-6 md:p-8 bg-white\">\r\n                        <AnalisisAI text={data.perplexity_full_text} />\r\n                    </CardContent>\r\n                </Card>\r\n            )}\r\n\r\n            {/* 7. NAVEGACI√ìN (BOTONES ALINEADOS) */}\r\n            <div className=\"flex flex-col-reverse md:flex-row items-center justify-between gap-4 pt-6 border-t border-[#E0E5E2] mt-8\">\r\n                <div className=\"flex gap-3\">\r\n                    <Button variant=\"ghost\" onClick={onBack} className=\"text-[#7A8C85] hover:text-[#2C3D37] hover:bg-[#F5F7F6]\">\r\n                        <ArrowLeft className=\"w-4 h-4 mr-2\" /> Editar Datos\r\n                    </Button>\r\n                </div>\r\n                <div className=\"flex flex-col md:flex-row gap-4 w-full md:w-auto\">\r\n                    <BotonPDF ref={pdfButtonRef} formData={formData} />\r\n                    {onReset && (\r\n                        <Button variant=\"outline\" onClick={onReset} className=\"text-[#7A8C85] border-[#B0BDB4] hover:text-[#2C3D37] hover:bg-[#F5F7F6] rounded-full py-6\">\r\n                            Nuevo Aval√∫o\r\n                        </Button>\r\n                    )}\r\n                    <Button\r\n                        onClick={handleAction}\r\n                        className=\"bg-[#2C3D37] hover:bg-[#1a2620] text-white rounded-full py-6 text-lg font-medium shadow-lg transition-all\"\r\n                        disabled={!valorPrincipal || sendEmailMutation.isPending}\r\n                    >\r\n                        {sendEmailMutation.isPending ? (\r\n                            <>\r\n                                <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                                Enviando...\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                {formData.id && (formData.email || formData.contacto_email) ? (\r\n                                    <>Reenviar al correo <Send className=\"w-5 h-5 ml-2\" /></>\r\n                                ) : (\r\n                                    <>Enviar al correo <ArrowRight className=\"w-5 h-5 ml-2\" /></>\r\n                                )}\r\n                            </>\r\n                        )}\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction validarNumero(valor) {\r\n    if (valor === null || valor === undefined) return null;\r\n    if (typeof valor === 'number') return isFinite(valor) && !isNaN(valor) ? valor : null;\r\n    if (typeof valor === 'string') {\r\n        const num = parseFloat(valor.replace(/[^\\d.-]/g, ''));\r\n        return isFinite(num) && !isNaN(num) ? num : null;\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction renderErrorState(mensaje, onBack) {\r\n    return (\r\n        <div className=\"flex flex-col items-center justify-center py-12 px-4 text-center space-y-6\">\r\n            <div className=\"bg-red-50 p-4 rounded-full\"><AlertCircle className=\"h-10 w-10 text-red-500\" /></div>\r\n            <div className=\"max-w-md space-y-2\">\r\n                <h3 className=\"text-lg font-semibold text-[#2C3D37]\">No pudimos generar el an√°lisis</h3>\r\n                <p className=\"text-sm text-[#4F5B55]\">{mensaje}</p>\r\n            </div>\r\n            <Button onClick={onBack} variant=\"outline\" className=\"border-[#B0BDB4] text-[#2C3D37] rounded-full\">\r\n                <ArrowLeft className=\"w-4 h-4 mr-2\" /> Intentar nuevamente\r\n            </Button>\r\n        </div>\r\n    );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\components\\avaluo\\Step4Contact.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'CardDescription' is defined but never used.","line":6,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":67,"suggestions":[{"messageId":"removeVar","data":{"varName":"CardDescription"},"fix":{"range":[314,331],"text":""},"desc":"Remove unused variable 'CardDescription'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'Send' is defined but never used.","line":7,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":23,"suggestions":[{"messageId":"removeVar","data":{"varName":"Send"},"fix":{"range":[380,386],"text":""},"desc":"Remove unused variable 'Send'."}]},{"ruleId":"react/prop-types","severity":2,"message":"'formData' is missing in props validation","line":13,"column":40,"nodeType":"Property","messageId":"missingPropType","endLine":13,"endColumn":48},{"ruleId":"react/prop-types","severity":2,"message":"'onBack' is missing in props validation","line":13,"column":50,"nodeType":"Property","messageId":"missingPropType","endLine":13,"endColumn":56},{"ruleId":"react/prop-types","severity":2,"message":"'onReset' is missing in props validation","line":13,"column":58,"nodeType":"Property","messageId":"missingPropType","endLine":13,"endColumn":65},{"ruleId":"react/prop-types","severity":2,"message":"'formData.comparables_data' is missing in props validation","line":27,"column":40,"nodeType":"Identifier","messageId":"missingPropType","endLine":27,"endColumn":56},{"ruleId":"no-unused-vars","severity":2,"message":"'formatCurrency' is assigned a value but never used.","line":43,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":27},{"ruleId":"react/prop-types","severity":2,"message":"'formData.codigo_avaluo' is missing in props validation","line":46,"column":37,"nodeType":"Identifier","messageId":"missingPropType","endLine":46,"endColumn":50},{"ruleId":"react/prop-types","severity":2,"message":"'formData.tipo_inmueble' is missing in props validation","line":55,"column":33,"nodeType":"Identifier","messageId":"missingPropType","endLine":55,"endColumn":46},{"ruleId":"react/prop-types","severity":2,"message":"'formData.barrio' is missing in props validation","line":56,"column":26,"nodeType":"Identifier","messageId":"missingPropType","endLine":56,"endColumn":32},{"ruleId":"react/prop-types","severity":2,"message":"'formData.municipio' is missing in props validation","line":57,"column":29,"nodeType":"Identifier","messageId":"missingPropType","endLine":57,"endColumn":38},{"ruleId":"react/prop-types","severity":2,"message":"'formData.area_construida' is missing in props validation","line":58,"column":35,"nodeType":"Identifier","messageId":"missingPropType","endLine":58,"endColumn":50},{"ruleId":"react/prop-types","severity":2,"message":"'formData.habitaciones' is missing in props validation","line":59,"column":32,"nodeType":"Identifier","messageId":"missingPropType","endLine":59,"endColumn":44},{"ruleId":"react/prop-types","severity":2,"message":"'formData.banos' is missing in props validation","line":60,"column":25,"nodeType":"Identifier","messageId":"missingPropType","endLine":60,"endColumn":30},{"ruleId":"react/prop-types","severity":2,"message":"'formData.estrato' is missing in props validation","line":61,"column":27,"nodeType":"Identifier","messageId":"missingPropType","endLine":61,"endColumn":34},{"ruleId":"react/prop-types","severity":2,"message":"'formData.estado_inmueble' is missing in props validation","line":62,"column":35,"nodeType":"Identifier","messageId":"missingPropType","endLine":62,"endColumn":50},{"ruleId":"react/prop-types","severity":2,"message":"'formData.id' is missing in props validation","line":65,"column":31,"nodeType":"Identifier","messageId":"missingPropType","endLine":65,"endColumn":33},{"ruleId":"react/prop-types","severity":2,"message":"'formData.tipo_inmueble' is missing in props validation","line":70,"column":34,"nodeType":"Identifier","messageId":"missingPropType","endLine":70,"endColumn":47},{"ruleId":"react/prop-types","severity":2,"message":"'formData.barrio' is missing in props validation","line":71,"column":28,"nodeType":"Identifier","messageId":"missingPropType","endLine":71,"endColumn":34},{"ruleId":"react/prop-types","severity":2,"message":"'formData.municipio' is missing in props validation","line":72,"column":28,"nodeType":"Identifier","messageId":"missingPropType","endLine":72,"endColumn":37},{"ruleId":"no-unused-vars","severity":2,"message":"'detalleUrl' is assigned a value but never used.","line":80,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":80,"endColumn":23},{"ruleId":"react/prop-types","severity":2,"message":"'formData.contacto_nombre' is missing in props validation","line":83,"column":65,"nodeType":"Identifier","messageId":"missingPropType","endLine":83,"endColumn":80},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used.","line":107,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":107,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[4498,4502],"text":""},"desc":"Remove unused variable 'data'."}]}],"suppressedMessages":[],"errorCount":24,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Loader2, Send, CheckCircle, Phone, Mail, RefreshCw, MessageCircle } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useMutation } from '@tanstack/react-query';\r\nimport { guardarAvaluoEnSupabase } from '@/lib/avaluos';\r\nimport { generateAvaluoEmailHtml } from '@/lib/emailGenerator';\r\n\r\nexport default function Step4Contact({ formData, onBack, onReset }) {\r\n  const navigate = useNavigate();\r\n  const [email, setEmail] = useState('');\r\n  const [nombre, setNombre] = useState('');\r\n  const [telefono, setTelefono] = useState('');\r\n  const [enviado, setEnviado] = useState(false);\r\n\r\n  // Scroll autom√°tico al top al montar componente\r\n  useEffect(() => {\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n  }, []);\r\n\r\n  const sendEmailMutation = useMutation({\r\n    mutationFn: async (data) => {\r\n      const comparablesData = formData.comparables_data || {};\r\n\r\n      // C√°lculos de valores (L√≥gica espejo del frontend)\r\n      const valorVentaDirecta = comparablesData.valor_estimado_venta_directa;\r\n      const valorRentabilidad = comparablesData.valor_estimado_rentabilidad;\r\n      const rangoMin = comparablesData.rango_valor_min;\r\n      const rangoMax = comparablesData.rango_valor_max;\r\n\r\n      let valorEstimadoFinal = comparablesData.valor_final;\r\n      if (!valorEstimadoFinal) {\r\n        if (rangoMin && rangoMax) valorEstimadoFinal = (rangoMin + rangoMax) / 2;\r\n        else if (valorVentaDirecta && valorRentabilidad) valorEstimadoFinal = (valorVentaDirecta * 0.8 + valorRentabilidad * 0.2);\r\n        else valorEstimadoFinal = valorVentaDirecta || valorRentabilidad;\r\n      }\r\n\r\n      // Formateadores\r\n      const formatCurrency = (val) => val ? '$ ' + Math.round(val).toLocaleString('es-CO') : '‚Äî';\r\n\r\n      // GENERAR CODIGO AVALUO SI NO EXISTE\r\n      const codigoAvaluo = formData.codigo_avaluo || `QZ-${new Date().getFullYear()}${String(new Date().getMonth() + 1).padStart(2, '0')}-${Math.floor(Math.random() * 10000)}`;\r\n\r\n      // 1. GUARDAR EN SUPABASE\r\n      // Preparamos el payload_json con TODO el an√°lisis (comparables_data tiene casi todo, pero aseguramos el objeto completo)\r\n      const payloadJson = {\r\n        ...comparablesData,\r\n        codigo_avaluo: codigoAvaluo,\r\n        valor_final: valorEstimadoFinal,\r\n        // Incluimos datos b√°sicos tambi√©n por si acaso\r\n        tipo_inmueble: formData.tipo_inmueble,\r\n        barrio: formData.barrio,\r\n        municipio: formData.municipio,\r\n        area_construida: formData.area_construida,\r\n        habitaciones: formData.habitaciones,\r\n        banos: formData.banos,\r\n        estrato: formData.estrato,\r\n        estado_inmueble: formData.estado_inmueble,\r\n      };\r\n\r\n      let avaluoId = formData.id;\r\n\r\n      if (!avaluoId) {\r\n        const avaluoIdRes = await guardarAvaluoEnSupabase({\r\n          email: data.contacto_email,\r\n          tipoInmueble: formData.tipo_inmueble,\r\n          barrio: formData.barrio,\r\n          ciudad: formData.municipio,\r\n          valorFinal: valorEstimadoFinal,\r\n          codigoAvaluo: codigoAvaluo,\r\n          payloadJson: payloadJson\r\n        });\r\n        avaluoId = avaluoIdRes;\r\n      }\r\n\r\n      const detalleUrl = `${window.location.origin}/resultados/${avaluoId}`;\r\n\r\n      const emailHtml = generateAvaluoEmailHtml({\r\n        data: { ...data, ...formData, contacto_nombre: formData.contacto_nombre },\r\n        codigoAvaluo,\r\n        valorEstimadoFinal,\r\n        rangoMin,\r\n        rangoMax\r\n      });\r\n\r\n      const response = await fetch(`${import.meta.env.VITE_WORKER_EMAIL_URL}/send-email`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          to: email, // String, not array\r\n          subject: `Reporte de Aval√∫o: ${data.tipo_inmueble} en ${data.barrio}`,\r\n          htmlBody: emailHtml // Worker expects \"htmlBody\", not \"html\"\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Error al enviar el correo');\r\n      }\r\n\r\n      return { success: true, id: avaluoId };\r\n    },\r\n    onSuccess: (data) => {\r\n      setEnviado(true);\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Hubo un error al procesar tu solicitud:\", error);\r\n      setEnviado(false);\r\n    }\r\n  });\r\n\r\n  const handleSubmit = (e) => {\r\n    if (e) e.preventDefault();\r\n    const isValid = nombre && email; // Validaci√≥n b√°sica\r\n    if (!isValid) return;\r\n\r\n    // Combinar datos del formulario de contacto con los datos del aval√∫o\r\n    const finalData = {\r\n      ...formData,\r\n      contacto_nombre: nombre,\r\n      contacto_email: email,\r\n      contacto_telefono: telefono,\r\n    };\r\n\r\n    sendEmailMutation.mutate(finalData);\r\n  };\r\n\r\n  const isValid = nombre?.length > 0 && email?.length > 0 && email?.includes('@');\r\n\r\n  if (enviado) {\r\n    return (\r\n      <Card className=\"border-[#2C3D37] border-2\">\r\n        <CardContent className=\"py-12\">\r\n          <div className=\"text-center space-y-6\">\r\n            <div className=\"flex justify-center\">\r\n              <div className=\"bg-green-100 rounded-full p-6\">\r\n                <CheckCircle className=\"w-16 h-16 text-green-600\" />\r\n              </div>\r\n            </div>\r\n\r\n            <div>\r\n              <h2 className=\"text-3xl font-bold text-[#2C3D37] mb-3\">\r\n                ¬°Reporte Enviado con √âxito!\r\n              </h2>\r\n              <p className=\"text-lg text-gray-600 max-w-2xl mx-auto\">\r\n                Hemos enviado el reporte completo del aval√∫o a <strong>{email}</strong>.\r\n                Revisa tu bandeja de entrada (y la carpeta de spam por si acaso).\r\n              </p>\r\n            </div>\r\n\r\n            <Alert className=\"max-w-2xl mx-auto border-[#C9C19D] bg-[#F5F4F0]\">\r\n              <AlertDescription className=\"text-[#2C3D37]\">\r\n                <strong>¬øInteresado en vender o comprar?</strong><br />\r\n                En Quetzal H√°bitats te ayudamos a encontrar el comprador ideal o la propiedad perfecta para ti.\r\n                Cont√°ctanos para una asesor√≠a personalizada sin compromiso.\r\n              </AlertDescription>\r\n            </Alert>\r\n\r\n            <div className=\"bg-[#DEE8E9] rounded-lg p-6 max-w-2xl mx-auto flex flex-col items-center\">\r\n              <h3 className=\"font-semibold text-[#2C3D37] mb-4 text-center\">¬øNecesitas m√°s informaci√≥n?</h3>\r\n              <div className=\"flex flex-row justify-center gap-4 w-full\">\r\n                <div className=\"flex flex-col items-center w-auto mx-2\">\r\n                  <a href=\"https://wa.me/573186383809\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"flex items-center justify-center gap-2 hover:underline\">\r\n                    <Phone className=\"w-5 h-5 text-[#2C3D37]\" />\r\n                    <p className=\"font-semibold text-[#2C3D37]\" style={{ fontFamily: 'Outfit, sans-serif' }}>+57 318 638 3809</p>\r\n                  </a>\r\n                </div>\r\n                <div className=\"flex flex-col items-center w-auto mx-2\">\r\n                  <a href=\"mailto:contacto@quetzalhabitats.com\" className=\"flex items-center justify-center gap-2 hover:underline\">\r\n                    <Mail className=\"w-5 h-5 text-[#2C3D37]\" />\r\n                    <p className=\"font-semibold text-[#2C3D37]\" style={{ fontFamily: 'Outfit, sans-serif' }}>contacto@quetzalhabitats.com</p>\r\n                  </a>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex gap-4 justify-center flex-wrap\">\r\n              <Button\r\n                onClick={() => navigate(`/resultados/${sendEmailMutation.data?.id}`)}\r\n                variant=\"outline\"\r\n                className=\"border-[#B0BDB4] text-[#2C3D37] rounded-full px-8 py-6 text-lg font-medium\"\r\n              >\r\n                Volver a Resultados\r\n              </Button>\r\n              <Button\r\n                onClick={onReset}\r\n                className=\"bg-[#2C3D37] hover:bg-[#1a2620] text-white rounded-full px-8 py-6 text-lg font-medium\"\r\n              >\r\n                <RefreshCw className=\"w-5 h-5 mr-2\" />\r\n                Crear Nuevo Aval√∫o\r\n              </Button>\r\n              <Button\r\n                onClick={() => window.open('https://wa.me/573186383809', '_blank')}\r\n                className=\"bg-green-600 hover:bg-green-700 text-white rounded-full px-8 py-6 text-lg font-medium\"\r\n              >\r\n                <MessageCircle className=\"w-5 h-5 mr-2\" />\r\n                Contactar\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Card className=\"border-[#B0BDB4]\">\r\n      <CardHeader>\r\n        <CardTitle className=\"text-2xl text-[#2C3D37]\">\r\n          Recibe tu Reporte Completo\r\n        </CardTitle>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        <p className=\"text-gray-600\">\r\n          Ingresa tus datos para recibir el reporte detallado del aval√∫o directamente en tu correo electr√≥nico.\r\n        </p>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"nombre\" className=\"text-[#2C3D37] font-medium\">\r\n              Nombre Completo *\r\n            </Label>\r\n            <Input\r\n              id=\"nombre\"\r\n              value={nombre}\r\n              onChange={(e) => setNombre(e.target.value)}\r\n              placeholder=\"Ej: Juan P√©rez\"\r\n              className=\"border-[#B0BDB4] focus:border-[#2C3D37]\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"email\" className=\"text-[#2C3D37] font-medium\">\r\n              Correo Electr√≥nico *\r\n            </Label>\r\n            <Input\r\n              id=\"email\"\r\n              type=\"email\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              placeholder=\"tu@email.com\"\r\n              className=\"border-[#B0BDB4] focus:border-[#2C3D37]\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"whatsapp\" className=\"text-[#2C3D37] font-medium\">\r\n              WhatsApp (Opcional)\r\n            </Label>\r\n            <Input\r\n              id=\"whatsapp\"\r\n              type=\"tel\"\r\n              value={telefono}\r\n              onChange={(e) => setTelefono(e.target.value)}\r\n              placeholder=\"+57 300 123 4567\"\r\n              className=\"border-[#B0BDB4] focus:border-[#2C3D37]\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <Alert className=\"border-[#B0BDB4] bg-[#DEE8E9]\">\r\n          <Mail className=\"w-4 h-4 text-[#2C3D37]\" />\r\n          <AlertDescription className=\"text-[#2C3D37]\">\r\n            Tu informaci√≥n ser√° utilizada √∫nicamente para enviarte el reporte y contactarte si deseas m√°s informaci√≥n\r\n            sobre nuestros servicios. No compartimos tus datos con terceros.\r\n          </AlertDescription>\r\n        </Alert>\r\n\r\n        <div className=\"flex gap-4\">\r\n          <Button\r\n            onClick={onBack}\r\n            variant=\"outline\"\r\n            className=\"border-[#B0BDB4] text-[#2C3D37] rounded-full py-6 text-lg font-medium\"\r\n          >\r\n            Volver\r\n          </Button>\r\n          <Button\r\n            onClick={handleSubmit}\r\n            disabled={!isValid || sendEmailMutation.isPending}\r\n            className=\"flex-1 bg-[#2C3D37] hover:bg-[#1a2620] text-white rounded-full py-6 text-lg font-medium\"\r\n          >\r\n            {sendEmailMutation.isPending ? (\r\n              <>\r\n                <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                Enviando Reporte...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Mail className=\"w-5 h-5 mr-2\" />\r\n                Enviar Reporte por Email\r\n              </>\r\n            )}\r\n          </Button>\r\n        </div>\r\n\r\n        {sendEmailMutation.isError && (\r\n          <Alert className=\"border-red-300 bg-red-50\">\r\n            <AlertDescription className=\"text-red-800\">\r\n              Ocurri√≥ un error al enviar el reporte. Por favor, verifica tu correo e intenta de nuevo.\r\n            </AlertDescription>\r\n          </Alert>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\components\\avaluo\\StepIndicator.jsx","messages":[{"ruleId":"react/prop-types","severity":2,"message":"'currentStep' is missing in props validation","line":12,"column":41,"nodeType":"Property","messageId":"missingPropType","endLine":12,"endColumn":52}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Check } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nconst steps = [\n  { number: 1, title: 'Datos del Inmueble' },\n  { number: 2, title: 'An√°lisis de Mercado' },\n  { number: 3, title: 'Resultados' },\n  { number: 4, title: 'Entrega del Reporte' }\n];\n\nexport default function StepIndicator({ currentStep }) {\n  return (\n    <div className=\"w-full py-8\">\n      <div className=\"max-w-4xl mx-auto px-4\">\n        <div className=\"flex items-center justify-between\">\n          {steps.map((step, index) => (\n            <React.Fragment key={step.number}>\n              <div className=\"flex flex-col items-center flex-1\">\n                <div className=\"relative\">\n                  <div\n                    className={cn(\n                      \"w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300\",\n                      currentStep > step.number\n                        ? \"bg-[#2C3D37] text-white\"\n                        : currentStep === step.number\n                        ? \"bg-[#2C3D37] text-white ring-4 ring-[#B0BDB4] ring-opacity-50\"\n                        : \"bg-[#DAD7D0] text-[#2C3D37]\"\n                    )}\n                  >\n                    {currentStep > step.number ? (\n                      <Check className=\"w-6 h-6\" />\n                    ) : (\n                      <span className=\"font-semibold text-lg\">{step.number}</span>\n                    )}\n                  </div>\n                </div>\n                <p\n                  className={cn(\n                    \"mt-3 text-sm font-medium text-center transition-colors hidden sm:block\",\n                    currentStep >= step.number ? \"text-[#2C3D37]\" : \"text-gray-400\"\n                  )}\n                >\n                  {step.title}\n                </p>\n              </div>\n              \n              {index < steps.length - 1 && (\n                <div className=\"flex-1 h-1 mx-2 -mt-8 hidden sm:block\">\n                  <div\n                    className={cn(\n                      \"h-full rounded-full transition-all duration-300\",\n                      currentStep > step.number ? \"bg-[#2C3D37]\" : \"bg-[#DAD7D0]\"\n                    )}\n                  />\n                </div>\n              )}\n            </React.Fragment>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\components\\avaluo\\TablaComparables.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,18],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react/prop-types","severity":2,"message":"'comparables' is missing in props validation","line":13,"column":44,"nodeType":"Property","messageId":"missingPropType","endLine":13,"endColumn":55},{"ruleId":"react/prop-types","severity":2,"message":"'comparables.map' is missing in props validation","line":43,"column":24,"nodeType":"Identifier","messageId":"missingPropType","endLine":43,"endColumn":27},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":139,"column":30,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5953,6090],"text":"\n        * Para arriendos, el &quot;Precio Venta (Est)\" es el valor estimado por capitalizaci√≥n usando el yield de mercado investigado.\n      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5953,6090],"text":"\n        * Para arriendos, el &ldquo;Precio Venta (Est)\" es el valor estimado por capitalizaci√≥n usando el yield de mercado investigado.\n      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5953,6090],"text":"\n        * Para arriendos, el &#34;Precio Venta (Est)\" es el valor estimado por capitalizaci√≥n usando el yield de mercado investigado.\n      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5953,6090],"text":"\n        * Para arriendos, el &rdquo;Precio Venta (Est)\" es el valor estimado por capitalizaci√≥n usando el yield de mercado investigado.\n      "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":139,"column":49,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5953,6090],"text":"\n        * Para arriendos, el \"Precio Venta (Est)&quot; es el valor estimado por capitalizaci√≥n usando el yield de mercado investigado.\n      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5953,6090],"text":"\n        * Para arriendos, el \"Precio Venta (Est)&ldquo; es el valor estimado por capitalizaci√≥n usando el yield de mercado investigado.\n      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5953,6090],"text":"\n        * Para arriendos, el \"Precio Venta (Est)&#34; es el valor estimado por capitalizaci√≥n usando el yield de mercado investigado.\n      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5953,6090],"text":"\n        * Para arriendos, el \"Precio Venta (Est)&rdquo; es el valor estimado por capitalizaci√≥n usando el yield de mercado investigado.\n      "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { Home } from 'lucide-react';\n\nexport default function TablaComparables({ comparables }) {\n\n  const formatCurrency = (value) => {\n    if (!value && value !== 0) return 'Por consultar';\n    return '$ ' + Math.round(value).toLocaleString('es-CO');\n  };\n\n  const formatNumber = (num) => {\n    if (!num && num !== 0) return '‚Äî';\n    return num.toLocaleString('es-CO');\n  };\n\n  return (\n    <div className=\"w-full overflow-x-auto rounded-lg border border-[#E0E5E2] mx-auto max-w-fit\">\n      <Table>\n        <TableHeader className=\"bg-[#F9FAF9]\">\n          <TableRow>\n            <TableHead className=\"w-[220px] text-[#2C3D37] font-semibold text-sm py-4\">Propiedad</TableHead>\n            <TableHead className=\"text-[#2C3D37] font-semibold text-sm\">Tipo</TableHead>\n            <TableHead className=\"text-[#2C3D37] font-semibold text-sm\">Ubicaci√≥n</TableHead>\n            <TableHead className=\"text-[#2C3D37] font-semibold text-sm text-center\">√Årea</TableHead>\n            <TableHead className=\"text-[#2C3D37] font-semibold text-sm text-center w-[80px] leading-tight\">\n              Hab<br /><span className=\"text-xs font-normal\">Ba√±os</span>\n            </TableHead>\n            <TableHead className=\"text-[#2C3D37] font-semibold text-sm text-right\">Precio Publicado</TableHead>\n            <TableHead className=\"text-[#2C3D37] font-semibold text-sm text-right\">Precio de Venta</TableHead>\n            <TableHead className=\"text-[#2C3D37] font-semibold text-sm text-right w-[120px]\">$/m¬≤</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {comparables.map((item, index) => (\n            <TableRow key={index} className=\"hover:bg-[#F5F7F6] transition-colors border-b border-[#E0E5E2]\">\n\n              <TableCell className=\"font-medium text-[#2C3D37] align-top py-3\">\n                <div className=\"flex items-start gap-2\">\n                  <div className=\"p-1.5 bg-white border border-[#E0E5E2] rounded-md mt-0.5 shrink-0\">\n                    <Home className=\"w-3 h-3 text-[#C9C19D]\" />\n                  </div>\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-sm line-clamp-2 leading-snug\" title={item.titulo}>\n                      {item.titulo || 'Propiedad Comparable'}\n                    </span>\n                    {item.nota_adicional && (\n                      <div className=\"text-xs text-gray-600 mt-1 italic border-l-2 border-blue-300 pl-2\">\n                        {item.nota_adicional}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </TableCell>\n\n              <TableCell className=\"align-top py-3\">\n                <Badge\n                  variant=\"outline\"\n                  className={`\n                    capitalize font-normal text-[10px] px-2 py-0.5 border-0\n                    ${item.tipo_origen === 'arriendo'\n                      ? 'bg-blue-50 text-blue-700'\n                      : 'bg-[#E8F5E9] text-[#2E7D32]'}\n                  `}\n                >\n                  {item.tipo_origen || 'Venta'}\n                </Badge>\n              </TableCell>\n\n              <TableCell className=\"align-top py-3\">\n                <div className=\"flex flex-col\">\n                  <span className=\"text-sm text-[#4F5B55] font-medium leading-tight\">\n                    {item.barrio || item.fuente_zona || '‚Äî'}\n                  </span>\n                  <span className=\"text-[10px] text-[#A3B2AA] mt-0.5\">\n                    {item.municipio || 'Pereira'}\n                  </span>\n                </div>\n              </TableCell>\n\n              <TableCell className=\"text-sm text-[#4F5B55] text-center align-top py-3\">\n                {formatNumber(item.area_m2)} m¬≤\n              </TableCell>\n\n              <TableCell className=\"text-sm text-[#4F5B55] text-center align-top py-3\">\n                <div className=\"flex flex-col items-center leading-tight\">\n                  <span>{item.habitaciones || '-'}</span>\n                  <span className=\"text-[#E0E5E2] -my-1\">__</span>\n                  <span>{item.banos || '-'}</span>\n                </div>\n              </TableCell>\n\n              <TableCell className=\"align-top py-3 text-right\">\n                <div className=\"flex flex-col items-end\">\n                  <span className=\"text-sm text-[#4F5B55] font-medium\">\n                    {formatCurrency(item.precio_publicado)}\n                  </span>\n                  {item.tipo_origen === 'arriendo' && (\n                    <span className=\"text-[10px] text-[#A3B2AA]\">/mes</span>\n                  )}\n                </div>\n              </TableCell>\n\n              <TableCell className=\"align-top py-3 text-right\">\n                <div className=\"flex flex-col items-end\">\n                  <span className=\"text-sm font-semibold text-[#2C3D37]\">\n                    {formatCurrency(item.precio_cop)}\n                  </span>\n\n                  {item.tipo_origen === 'arriendo' && (\n                    <span className=\"text-[9px] text-[#A3B2AA] leading-tight max-w-[100px]\">\n                      Estimado por rentabilidad{item.yield_mensual ? ` (Yield ${(item.yield_mensual * 100).toFixed(2)}% seg√∫n mercado)` : ''}\n                    </span>\n                  )}\n                </div>\n              </TableCell>\n\n              {/* PRECIO M2 - Ahora tendr√° espacio suficiente */}\n              <TableCell className=\"text-right align-top py-3 whitespace-nowrap\">\n                <span className=\"text-sm font-medium text-[#2C3D37]\">\n                  {formatCurrency(item.precio_m2)}\n                </span>\n              </TableCell>\n\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n\n      <p className=\"text-xs text-gray-500 mt-3 px-4 pb-3\">\n        * Para arriendos, el \"Precio Venta (Est)\" es el valor estimado por capitalizaci√≥n usando el yield de mercado investigado.\n      </p>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\lib\\avaluos.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\lib\\emailGenerator.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\lib\\utils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\pages\\AccesoClientes.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { createClient } from '@supabase/supabase-js';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Loader2, Mail, CheckCircle } from 'lucide-react';\n// import { api } from '@/api/client'; // Removed legacy import\nimport { createPageUrl } from '@/utils';\n\nexport default function AccesoClientes() {\n  const [email, setEmail] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [enviado, setEnviado] = useState(false);\n  const [error, setError] = useState(null);\n  const [supabase, setSupabase] = useState(null);\n  const [checkingSession, setCheckingSession] = useState(true);\n\n  useEffect(() => {\n    const initSupabase = async () => {\n      // Detectar modo desarrollo\n      const href = window.location.href;\n      const isDevMode =\n        href.includes('/editor/preview/') ||\n        href.includes('/sandbox/preview-url') ||\n        href.includes('server_url=') ||\n        window.location.hostname === 'localhost' ||\n        window.location.hostname === '127.0.0.1';\n\n      // En modo desarrollo, no verificar sesi√≥n ni redirigir\n      if (isDevMode) {\n        setCheckingSession(false);\n        return;\n      }\n\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n      const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n      if (supabaseUrl && supabaseAnonKey) {\n        const client = createClient(supabaseUrl, supabaseAnonKey);\n        setSupabase(client);\n\n        // Verificar si ya hay sesi√≥n activa\n        const { data: { session } } = await client.auth.getSession();\n        if (session) {\n          window.location.href = createPageUrl('AvaluoInmobiliario');\n          return;\n        }\n\n        // Escuchar cambios de autenticaci√≥n\n        const { data: { subscription } } = client.auth.onAuthStateChange((event, session) => {\n          if (event === 'SIGNED_IN' && session) {\n            localStorage.setItem('supabase_session', JSON.stringify(session));\n            window.location.href = createPageUrl('AvaluoInmobiliario');\n          }\n        });\n\n        setCheckingSession(false);\n        return () => subscription.unsubscribe();\n      } else {\n        console.error('Faltan variables de entorno de Supabase (VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY)');\n        setCheckingSession(false);\n      }\n    };\n    initSupabase();\n  }, []);\n\n  const handleEnviarEnlace = async (e) => {\n    e.preventDefault();\n    if (!supabase || !email) return;\n\n    setLoading(true);\n    setError(null);\n\n    const { error } = await supabase.auth.signInWithOtp({\n      email: email,\n      options: {\n        emailRedirectTo: 'https://avaluos.quetzalhabitats.com/AvaluoInmobiliario'\n      }\n    });\n\n    setLoading(false);\n\n    if (error) {\n      setError('Hubo un error al enviar el correo.');\n    } else {\n      setEnviado(true);\n    }\n  };\n\n  if (checkingSession) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-[#F5F4F0]\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-[#2C3D37]\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex items-center justify-center px-4 bg-[#F5F4F0]\">\n      <div className=\"w-full max-w-md p-25px\">\n\n        <div className=\"text-center mb-8\">\n          <img\n            src=\"https://assets.zyrosite.com/YNqM51Nez6URyK5d/logo_solo_dorado-HZA3j5xtzbpEap4C.png\"\n            alt=\"Quetzal H√°bitats\"\n            className=\"w-[100px] mx-auto mb-6\"\n          />\n        </div>\n\n        {enviado ? (\n          <div className=\"text-center space-y-6\">\n            <div className=\"flex justify-center\">\n              <div className=\"bg-green-100 rounded-full p-5\">\n                <CheckCircle className=\"w-14 h-14 text-green-600\" />\n              </div>\n            </div>\n            <h1 className=\"text-2xl font-bold text-[#2C3D37]\">\n              ¬°Enlace enviado!\n            </h1>\n            <p className=\"text-gray-600 text-lg\">\n              Revisa tu bandeja de entrada.\n            </p>\n          </div>\n        ) : (\n          <>\n            <h1 className=\"text-3xl font-bold text-[#2C3D37] text-center mb-3\">\n              Bienvenido a Quetzal\n            </h1>\n            <p className=\"text-gray-600 text-center mb-8\">\n              Ingresa tu correo para acceder a la herramienta\n            </p>\n\n            <form onSubmit={handleEnviarEnlace} className=\"space-y-6\">\n              <div className=\"space-y-2\">\n                <label className=\"text-[#2C3D37] font-medium text-sm\">\n                  Correo Electr√≥nico\n                </label>\n                <Input\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder=\"ejemplo@correo.com\"\n                  required\n                  className=\"border-[#B0BDB4] focus:border-[#2C3D37] py-6\"\n                />\n              </div>\n\n              {error && (\n                <Alert className=\"border-red-300 bg-red-50\">\n                  <AlertDescription className=\"text-red-800\">\n                    {error}\n                  </AlertDescription>\n                </Alert>\n              )}\n\n              <Button\n                type=\"submit\"\n                disabled={loading || !email || !supabase}\n                className=\"w-full bg-[#2C3D37] hover:bg-[#1a2620] text-white rounded-full py-6 text-lg font-medium\"\n              >\n                {loading ? (\n                  <>\n                    <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\n                    Enviando...\n                  </>\n                ) : (\n                  <>\n                    <Mail className=\"w-5 h-5 mr-2\" />\n                    Enviar Enlace M√°gico\n                  </>\n                )}\n              </Button>\n            </form>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\pages\\AvaluoDetalle.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAvaluo'. Either include it or remove the dependency array.","line":24,"column":8,"nodeType":"ArrayExpression","endLine":24,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAvaluo, id]","fix":{"range":[949,953],"text":"[fetchAvaluo, id]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { createClient } from '@supabase/supabase-js';\r\nimport Step3Results from '../components/avaluo/Step3Results';\r\nimport Step4Contact from '../components/avaluo/Step4Contact';\r\nimport { Button } from '@/components/ui/button';\r\nimport { ArrowLeft, Loader2 } from 'lucide-react';\r\n\r\nexport default function AvaluoDetalle() {\r\n    const { id } = useParams();\r\n    const navigate = useNavigate();\r\n\r\n    // Detecci√≥n robusta del par√°metro download usando URLSearchParams\r\n    const autoDownload = new URLSearchParams(window.location.search).get('download') === 'pdf';\r\n\r\n\r\n    const [avaluo, setAvaluo] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n    const [showContact, setShowContact] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchAvaluo();\r\n    }, [id]);\r\n\r\n    const fetchAvaluo = async () => {\r\n        try {\r\n            const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\r\n            const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\r\n\r\n            if (!supabaseUrl || !supabaseAnonKey) {\r\n                throw new Error('Credenciales de Supabase no encontradas');\r\n            }\r\n\r\n            const supabase = createClient(supabaseUrl, supabaseAnonKey);\r\n\r\n            const { data, error } = await supabase\r\n                .from('avaluos')\r\n                .select('*')\r\n                .eq('id', id)\r\n                .single();\r\n\r\n            if (error) throw error;\r\n            if (!data) throw new Error('Aval√∫o no encontrado');\r\n\r\n            setAvaluo(data);\r\n        } catch (err) {\r\n            console.error('Error fetching avaluo:', err);\r\n            setError('No pudimos cargar el aval√∫o. Puede que no exista o haya sido eliminado.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center min-h-[60vh]\">\r\n                <Loader2 className=\"w-12 h-12 text-[#2C3D37] animate-spin mb-4\" />\r\n                <p className=\"text-[#4F5B55]\">Cargando aval√∫o...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"max-w-4xl mx-auto px-4 py-12 text-center\">\r\n                <div className=\"bg-red-50 text-red-800 p-6 rounded-lg mb-6 inline-block\">\r\n                    {error}\r\n                </div>\r\n                <br />\r\n                <Button onClick={() => navigate('/mis-avaluos')} variant=\"outline\">\r\n                    <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n                    Volver a Mis Aval√∫os\r\n                </Button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Prepare data for Step3Results\r\n    const formData = {\r\n        ...avaluo,\r\n        // Ensure comparables_data is populated from payload_json\r\n        comparables_data: avaluo.payload_json || {},\r\n        // Map top-level fields if needed\r\n        tipo_inmueble: avaluo.tipo_inmueble,\r\n        barrio: avaluo.barrio,\r\n        municipio: avaluo.municipio || avaluo.ciudad,\r\n        area_construida: avaluo.area_construida,\r\n        habitaciones: avaluo.habitaciones,\r\n        banos: avaluo.banos,\r\n        estrato: avaluo.estrato,\r\n        edad_inmueble: avaluo.edad_inmueble,\r\n        estado_inmueble: avaluo.estado_inmueble || avaluo.payload_json?.estado_inmueble || avaluo.payload_json?.estado || avaluo.payload_json?.inmueble_objetivo?.estado_inmueble || avaluo.payload_json?.inmueble_objetivo?.estado,\r\n        // Contact info for direct resend\r\n        email: avaluo.email,\r\n        nombre_contacto: avaluo.nombre_contacto || avaluo.contacto_nombre,\r\n        contacto_telefono: avaluo.contacto_telefono || avaluo.telefono\r\n    };\r\n\r\n    // Si mostramos la vista de contacto (Finalizar Informe)\r\n    if (showContact) {\r\n        return (\r\n            <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\r\n                <Button onClick={() => setShowContact(false)} variant=\"ghost\" className=\"mb-6 pl-0 hover:bg-transparent hover:text-[#2C3D37]/70 text-[#2C3D37]\">\r\n                    <ArrowLeft className=\"w-5 h-5 mr-2\" />\r\n                    Volver al reporte\r\n                </Button>\r\n                <Step4Contact formData={formData.comparables_data || formData} />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8\" >\r\n            <div className=\"mb-6 flex items-center justify-between\">\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    onClick={() => navigate('/mis-avaluos')}\r\n                    className=\"text-[#4F5B55] hover:text-[#2C3D37]\"\r\n                >\r\n                    <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n                    Volver a Mis Aval√∫os\r\n                </Button>\r\n                <div className=\"text-sm text-[#7A8C85]\">\r\n                    C√≥digo: <span className=\"font-medium text-[#2C3D37]\">{avaluo.codigo_avaluo}</span>\r\n                </div>\r\n            </div>\r\n\r\n            <Step3Results\r\n                formData={formData}\r\n                onBack={() => navigate('/mis-avaluos')}\r\n                onReset={() => navigate('/AvaluoInmobiliario')}\r\n                onNext={() => setShowContact(true)}\r\n                onUpdate={() => { }}\r\n                autoDownloadPDF={autoDownload}\r\n            />\r\n        </div >\r\n    );\r\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\pages\\AvaluoInmobiliario.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\nimport StepIndicator from '../components/avaluo/StepIndicator';\nimport Step1Form from '../components/avaluo/Step1Form';\nimport Step2Analysis from '../components/avaluo/Step2Analysis';\nimport Step3Results from '../components/avaluo/Step3Results';\nimport Step4Contact from '../components/avaluo/Step4Contact';\nimport { createClient } from '@supabase/supabase-js';\nimport { guardarAvaluoEnSupabase } from '@/lib/avaluos';\n\nconst initialState = {\n  tipo_inmueble: '',\n  barrio: '',\n  contexto_zona: '',\n  nombre_conjunto: '',\n  municipio: '',\n  departamento: '',\n  area_construida: null,\n  habitaciones: null,\n  banos: null,\n  tipo_parqueadero: '',\n  estado_inmueble: '',\n  tipo_remodelacion: '',\n  informacion_complementaria: '',\n  documentos_urls: [],\n  comparables_data: null,\n  status: 'iniciado'\n};\n\nexport default function AvaluoInmobiliario() {\n  const [currentStep, setCurrentStep] = useState(1);\n  const contentRef = useRef(null);\n  const [avaluoData, setAvaluoData] = useState(initialState);\n  const [hasAvaluos, setHasAvaluos] = useState(false);\n  const [currentUser, setCurrentUser] = useState(null);\n\n  const isDevMode = import.meta.env.MODE === 'development';\n\n  // Check if user has aval√∫os\n  useEffect(() => {\n    const checkAvaluos = async () => {\n      try {\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n        if (supabaseUrl && supabaseAnonKey) {\n          const supabase = createClient(supabaseUrl, supabaseAnonKey);\n          const { data: { user } } = await supabase.auth.getUser();\n\n          if (user) {\n            setCurrentUser(user);\n            const { count } = await supabase\n              .from('avaluos')\n              .select('*', { count: 'exact', head: true })\n              .eq('email', user.email);\n\n            setHasAvaluos(count > 0);\n          }\n        }\n      } catch (error) {\n        console.error('Error checking aval√∫os:', error);\n      }\n    };\n\n    checkAvaluos();\n  }, []);\n\n  const handleUpdateData = (newData) => {\n    setAvaluoData(prev => ({ ...prev, ...newData }));\n  };\n\n  const handleNext = async (incomingData) => {\n    const nextStep = Math.min(currentStep + 1, 4);\n\n    // Determine effective data (handle race condition from Step 2)\n    // If incomingData is an Event (click), ignore it. If it's an object with data, use it.\n    const isEvent = incomingData && incomingData.preventDefault;\n    const dataOverride = (incomingData && !isEvent) ? incomingData : {};\n\n    const effectiveAvaluoData = { ...avaluoData, ...dataOverride };\n\n    // AUTO-SAVE LOGIC: If moving to Step 3 (Results) and user is logged in\n    if (currentStep === 2 && nextStep === 3 && currentUser) {\n      try {\n        const data = effectiveAvaluoData.comparables_data || {};\n\n        // Generate Code if missing\n        const cod = effectiveAvaluoData.codigo_avaluo || `QZ-${new Date().getFullYear()}${String(new Date().getMonth() + 1).padStart(2, '0')}-${Math.floor(Math.random() * 10000)}`;\n\n        // Calculate Value (Simple logic mirror)\n        let valFinal = data.valor_final;\n        if (!valFinal) {\n          const v1 = data.valor_estimado_venta_directa;\n          const v2 = data.valor_estimado_rentabilidad;\n          const min = data.rango_valor_min;\n          const max = data.rango_valor_max;\n\n          if (min && max) valFinal = (min + max) / 2;\n          else if (v1 && v2) valFinal = (v1 * 0.8 + v2 * 0.2);\n          else valFinal = v1 || v2 || 0;\n        }\n\n        const payload = {\n          ...data,\n          codigo_avaluo: cod,\n          valor_final: valFinal,\n          tipo_inmueble: effectiveAvaluoData.tipo_inmueble,\n          barrio: effectiveAvaluoData.barrio,\n          municipio: effectiveAvaluoData.municipio,\n          area_construida: effectiveAvaluoData.area_construida,\n          habitaciones: effectiveAvaluoData.habitaciones,\n          banos: effectiveAvaluoData.banos,\n        };\n\n        const savedId = await guardarAvaluoEnSupabase({\n          email: currentUser.email,\n          tipoInmueble: effectiveAvaluoData.tipo_inmueble,\n          barrio: effectiveAvaluoData.barrio,\n          ciudad: effectiveAvaluoData.municipio,\n          valorFinal: valFinal,\n          codigoAvaluo: cod,\n          payloadJson: payload,\n        });\n\n        // Update local state with saved ID and Code AND the payload (to ensure Step 3 renders with data)\n        handleUpdateData({\n          id: savedId,\n          codigo_avaluo: cod,\n          comparables_data: payload\n        });\n        console.log(\"Auto-saved avaluo:\", savedId);\n        setHasAvaluos(true);\n\n      } catch (err) {\n        console.error(\"Auto-save failed\", err);\n      }\n    }\n\n    setCurrentStep(nextStep);\n\n    // If moving to step 3 (Resultados) or 4, mark that we have content for \"Mis Avaluos\"\n    if (nextStep >= 3) {\n      setHasAvaluos(true);\n    }\n  };\n\n  const handleBack = () => {\n    setCurrentStep(prev => Math.max(prev - 1, 1));\n  };\n\n  const handleReset = () => {\n    setAvaluoData(initialState);\n    setCurrentStep(1);\n  };\n\n  useEffect(() => {\n    if (currentStep > 1 && contentRef.current) {\n      contentRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    } else if (currentStep === 1) {\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    }\n  }, [currentStep]);\n\n  return (\n    <div className=\"min-h-screen bg-[#F5F4F0]\">\n      {/* Hero Section */}\n      <div className=\"relative bg-gradient-to-br from-[#2C3D37] to-[#1a2620] text-white py-16\">\n\n\n        <div className=\"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n          <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">\n            Aval√∫o Comercial Inmobiliario\n          </h1>\n          <p className=\"text-xl text-[#DEE8E9] max-w-3xl mx-auto\">\n            Descubre el valor real de tu propiedad con nuestro sistema de an√°lisis de mercado impulsado por IA\n          </p>\n        </div>\n      </div>\n\n      {/* Step Indicator - siempre visible */}\n      <div className=\"bg-white shadow-sm\">\n        <StepIndicator currentStep={currentStep} />\n      </div>\n\n      {/* Bot√≥n Mis Aval√∫os - Debajo del StepIndicator (solo si tiene aval√∫os) */}\n      {hasAvaluos && (\n        <div className=\"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-end\">\n          <a\n            href=\"/mis-avaluos\"\n            className=\"inline-flex items-center gap-2 px-5 py-2 bg-[#2C3D37] hover:bg-[#1a2620] text-white rounded-full text-sm font-medium transition-all shadow-md hover:shadow-lg\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n            </svg>\n            Mis Aval√∫os\n          </a>\n        </div>\n      )}\n\n\n\n\n\n      {/* Dev Navigation - Solo visible en modo desarrollo */}\n      {isDevMode && (\n        <div className=\"bg-yellow-100 border-b border-yellow-300 py-2 mt-4\">\n          <div className=\"max-w-5xl mx-auto px-4 flex items-center justify-center gap-2 flex-wrap\">\n            <span className=\"text-yellow-800 text-sm font-medium mr-2\">üõ†Ô∏è Dev:</span>\n            {[1, 2, 3, 4].map((step) => (\n              <button\n                key={step}\n                onClick={() => setCurrentStep(step)}\n                className={`px-3 py-1 text-sm rounded ${currentStep === step\n                  ? 'bg-yellow-600 text-white'\n                  : 'bg-white text-yellow-800 hover:bg-yellow-200'\n                  }`}\n              >\n                Paso {step}\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Main Content */}\n      <div ref={contentRef} className=\"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n        {currentStep === 1 && (\n          <Step1Form\n            formData={avaluoData}\n            onUpdate={handleUpdateData}\n            onNext={handleNext}\n          />\n        )}\n\n        {currentStep === 2 && (\n          <Step2Analysis\n            formData={avaluoData}\n            onUpdate={handleUpdateData}\n            onNext={handleNext}\n            onBack={handleBack}\n          />\n        )}\n\n        {currentStep === 3 && (\n          <Step3Results\n            formData={avaluoData}\n            onUpdate={handleUpdateData}\n            onNext={handleNext}\n            onBack={handleBack}\n            onReset={handleReset}\n          />\n        )}\n\n        {currentStep === 4 && (\n          <Step4Contact\n            formData={avaluoData}\n            onUpdate={handleUpdateData}\n            onReset={handleReset}\n            onBack={handleBack}\n          />\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\pages\\Layout.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":3,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[9,15],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"react/prop-types","severity":2,"message":"'children' is missing in props validation","line":10,"column":34,"nodeType":"Property","messageId":"missingPropType","endLine":10,"endColumn":42},{"ruleId":"react/prop-types","severity":2,"message":"'currentPageName' is missing in props validation","line":10,"column":44,"nodeType":"Property","messageId":"missingPropType","endLine":10,"endColumn":59},{"ruleId":"no-unused-vars","severity":2,"message":"'isAuthenticated' is assigned a value but never used.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"isAuthenticated"},"fix":{"range":[407,422],"text":""},"desc":"Remove unused variable 'isAuthenticated'."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n\nimport React, { useState, useEffect } from 'react';\nimport { Mail, Phone, MapPin, Loader2 } from 'lucide-react';\nimport { createClient } from '@supabase/supabase-js';\n// import { api } from '@/api/client'; // Removed legacy import\nimport { createPageUrl } from '@/utils';\n\n\nexport default function Layout({ children, currentPageName }) {\n  const [checkingAuth, setCheckingAuth] = useState(true);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n\n  useEffect(() => {\n    console.log('Layout useEffect - p√°gina:', currentPageName);\n\n    // Permitir AccesoClientes siempre\n    if (currentPageName === 'AccesoClientes') {\n      console.log('Permitido AccesoClientes, saltando auth');\n      setCheckingAuth(false);\n      return;\n    }\n\n    // Detectar modo desarrollo ANTES de verificar auth\n    const href = window.location.href;\n    const isDevMode =\n      href.includes('/editor/preview/') ||\n      href.includes('/sandbox/preview-url') ||\n      href.includes('server_url=') ||\n      window.location.hostname === 'localhost' ||\n      window.location.hostname === '127.0.0.1';\n\n    console.log('isDevMode:', isDevMode, 'href:', href);\n\n    // En modo desarrollo, permitir acceso sin autenticaci√≥n\n    if (isDevMode) {\n      console.log('Modo dev detectado, saltando auth');\n      setIsAuthenticated(true); // ‚úÖ Forzar autenticaci√≥n en dev para mostrar \"Mis Aval√∫os\"\n      setCheckingAuth(false);\n      return;\n    }\n\n    console.log('Iniciando verificaci√≥n Supabase...');\n    // Solo en producci√≥n verificar Supabase auth\n    const checkSupabaseAuth = async () => {\n      try {\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n        if (supabaseUrl && supabaseAnonKey) {\n          const supabase = createClient(supabaseUrl, supabaseAnonKey);\n          const { data: { session } } = await supabase.auth.getSession();\n\n          if (session) {\n            setIsAuthenticated(true);\n          } else {\n            window.location.href = createPageUrl('AccesoClientes');\n            return;\n          }\n        } else {\n          console.warn('Supabase credentials not found in environment variables');\n        }\n      } catch (error) {\n        console.error('Error checking auth:', error);\n      }\n      setCheckingAuth(false);\n    };\n\n    checkSupabaseAuth();\n  }, [currentPageName]);\n\n  if (checkingAuth && currentPageName !== 'AccesoClientes') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-[#F5F4F0]\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-[#2C3D37]\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-[#F5F4F0]\">\n      <style>{`\n        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Raleway:wght@300;400;500;600;700&display=swap');\n        \n        :root {\n          --quetzal-dark: #2C3D37;\n          --quetzal-beige: #DAD7D0;\n          --quetzal-blue: #D8DCE5;\n          --quetzal-gold: #C9C19D;\n          --quetzal-sage: #B0BDB4;\n          --quetzal-mint: #DEE8E9;\n        }\n        \n        body {\n          font-family: 'Raleway', sans-serif;\n        }\n        \n        h1, h2, h3, h4, h5, h6 {\n          font-family: 'Outfit', sans-serif;\n        }\n      `}</style>\n\n      <header className=\"bg-[#2C3D37] text-white shadow-lg\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-4\">\n              <img\n                src=\"https://assets.zyrosite.com/YNqM51Nez6URyK5d/quetzal_4-Yan0WNJQLLHKrEom.png\"\n                alt=\"Quetzal H√°bitats\"\n                className=\"w-[200px]\"\n              />\n              <div className=\"border-l border-[#B0BDB4] pl-4 hidden sm:block\">\n                <h1 className=\"text-lg sm:text-xl font-semibold tracking-wide\">\n                  Aval√∫o Comercial Inmobiliario\n                </h1>\n                <p className=\"text-sm text-[#DEE8E9] mt-1\">\n                  Conoce el valor real de tu propiedad\n                </p>\n              </div>\n            </div>\n\n            {/* Navigation Menu */}\n            <div className=\"flex items-center space-x-6\">\n\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className={currentPageName === 'AccesoClientes' ? 'py-[75px]' : 'flex-grow'}>\n        {children}\n      </main>\n\n      <footer className={`bg-[#2C3D37] text-white ${currentPageName === 'AccesoClientes' ? 'mt-0' : 'mt-20'}`}>\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n            <div>\n              <img\n                src=\"https://assets.zyrosite.com/YNqM51Nez6URyK5d/quetzal_4-Yan0WNJQLLHKrEom.png\"\n                alt=\"Quetzal H√°bitats\"\n                className=\"w-[200px] mb-4\"\n              />\n              <p className=\"text-[#DEE8E9] text-sm leading-relaxed\">\n                Casas en zonas campestres, conjuntos cerrados, condominios y zonas residenciales de alta seguridad y confort.\n              </p>\n            </div>\n\n            <div>\n              <h3 className=\"font-semibold text-lg mb-4 text-[#C9C19D]\">Contacto</h3>\n              <div className=\"space-y-3 text-sm\">\n                <div className=\"flex items-center space-x-3\">\n                  <Phone className=\"w-4 h-4 text-[#B0BDB4]\" />\n                  <span>+57 318 638 3809</span>\n                </div>\n                <div className=\"flex items-center space-x-3\">\n                  <Mail className=\"w-4 h-4 text-[#B0BDB4]\" />\n                  <span>contacto@quetzalhabitats.com</span>\n                </div>\n                <div className=\"flex items-center space-x-3\">\n                  <MapPin className=\"w-4 h-4 text-[#B0BDB4]\" />\n                  <span>Mosquera, Cundinamarca</span>\n                </div>\n              </div>\n            </div>\n\n            <div>\n              <h3 className=\"font-semibold text-lg mb-4 text-[#C9C19D]\">Servicios</h3>\n              <ul className=\"space-y-2 text-sm text-[#DEE8E9]\">\n                <li>‚Ä¢ Compra y venta de propiedades</li>\n                <li>‚Ä¢ Asesor√≠a inmobiliaria</li>\n                <li>‚Ä¢ Remodelaciones</li>\n                <li>‚Ä¢ Aval√∫os comerciales</li>\n              </ul>\n            </div>\n          </div>\n\n          <div className=\"border-t border-[#B0BDB4] mt-8 pt-8 text-center text-sm text-[#DEE8E9]\">\n            <p>&copy; 2025 Quetzal H√°bitats - Todos los derechos reservados</p>\n          </div>\n        </div>\n      </footer>\n    </div >\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\pages\\MisAvaluos.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13,"suggestions":[{"messageId":"removeVar","data":{"varName":"React"},"fix":{"range":[7,13],"text":""},"desc":"Remove unused variable 'React'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'CardTitle' is defined but never used.","line":4,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"CardTitle"},"fix":{"range":[195,206],"text":""},"desc":"Remove unused variable 'CardTitle'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'resendEmailMutation' is assigned a value but never used.","line":98,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":98,"endColumn":30,"suggestions":[{"messageId":"removeVar","data":{"varName":"resendEmailMutation"},"fix":{"range":[4141,5225],"text":""},"desc":"Remove unused variable 'resendEmailMutation'."}]},{"ruleId":"no-undef","severity":2,"message":"'generateEmailHtml' is not defined.","line":106,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":106,"endColumn":48}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { createClient } from '@supabase/supabase-js';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Loader2, FileText, Mail, Calendar, MapPin, ArrowRight, Home, RefreshCw } from 'lucide-react';\r\nimport BotonPDF from '@/components/avaluo/BotonPDF';\r\nimport { useMutation } from '@tanstack/react-query';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { generateAvaluoEmailHtml } from '@/lib/emailGenerator';\r\n\r\nexport default function MisAvaluos() {\r\n    const navigate = useNavigate();\r\n    const [avaluos, setAvaluos] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n    const [sendingEmailId, setSendingEmailId] = useState(null);\r\n\r\n    useEffect(() => {\r\n        fetchAvaluos();\r\n    }, []);\r\n\r\n    const fetchAvaluos = async () => {\r\n        try {\r\n            const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\r\n            const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\r\n\r\n            if (!supabaseUrl || !supabaseAnonKey) {\r\n                throw new Error('Credenciales de Supabase no encontradas');\r\n            }\r\n\r\n            const supabase = createClient(supabaseUrl, supabaseAnonKey);\r\n\r\n            // Intentar obtener el usuario actual\r\n            const { data: { user }, error: userError } = await supabase.auth.getUser();\r\n\r\n            console.log('[MisAvaluos] getUser result:', { user, userError });\r\n\r\n            // Si getUser falla, intentar con getSession como fallback\r\n            let userEmail = user?.email;\r\n\r\n            if (!userEmail) {\r\n                console.log('[MisAvaluos] getUser returned null, trying getSession...');\r\n                const { data: { session }, error: sessionError } = await supabase.auth.getSession();\r\n                console.log('[MisAvaluos] getSession result:', { session, sessionError });\r\n                userEmail = session?.user?.email;\r\n            }\r\n\r\n            if (!userEmail) {\r\n                console.warn('[MisAvaluos] No se pudo obtener email del usuario');\r\n                // En desarrollo local, permitir listar todos los aval√∫os para testing\r\n                const isLocalDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\r\n\r\n                if (isLocalDev) {\r\n                    console.log('[MisAvaluos] Modo desarrollo - listando todos los aval√∫os');\r\n                    const { data, error } = await supabase\r\n                        .from('avaluos')\r\n                        .select('*')\r\n                        .order('created_at', { ascending: false })\r\n                        .limit(10); // Limitar a 10 para no saturar\r\n\r\n                    if (error) throw error;\r\n                    setAvaluos(data || []);\r\n                    setLoading(false);\r\n                    return;\r\n                }\r\n\r\n                // En producci√≥n, si no hay usuario, no mostrar nada\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            console.log('[MisAvaluos] Buscando aval√∫os para email:', userEmail);\r\n\r\n            // Buscar aval√∫os por email del usuario\r\n            const { data, error } = await supabase\r\n                .from('avaluos')\r\n                .select('*')\r\n                .eq('email', userEmail)\r\n                .order('created_at', { ascending: false });\r\n\r\n            if (error) {\r\n                console.error('[MisAvaluos] Error al consultar aval√∫os:', error);\r\n                throw error;\r\n            }\r\n\r\n            console.log('[MisAvaluos] Aval√∫os encontrados:', data?.length || 0);\r\n            setAvaluos(data || []);\r\n        } catch (err) {\r\n            console.error('[MisAvaluos] Error fetching avaluos:', err);\r\n            setError('No pudimos cargar tus aval√∫os. Por favor intenta m√°s tarde.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const resendEmailMutation = useMutation({\r\n        mutationFn: async (avaluo) => {\r\n            const response = await fetch(import.meta.env.VITE_WORKER_EMAIL_URL, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    to: avaluo.email,\r\n                    subject: `Reporte de Aval√∫o - ${avaluo.codigo_avaluo} (Reenv√≠o)`,\r\n                    htmlBody: generateEmailHtml(avaluo) // We need to reuse the logic or fetch the HTML\r\n                })\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json();\r\n                throw new Error(errorData.error || 'Error al enviar email');\r\n            }\r\n\r\n            return response.json();\r\n        },\r\n        onSuccess: () => {\r\n            alert('Reporte enviado exitosamente a tu correo.');\r\n            setSendingEmailId(null);\r\n        },\r\n        onError: (err) => {\r\n            alert(`Error: ${err.message}`);\r\n            setSendingEmailId(null);\r\n        }\r\n    });\r\n\r\n    const handleResendEmail = async (avaluo) => {\r\n        setSendingEmailId(avaluo.id);\r\n\r\n        try {\r\n            const comparablesData = avaluo.payload_json || {};\r\n            const codigoAvaluo = avaluo.codigo_avaluo;\r\n\r\n            // Calcular valores (misma l√≥gica que en otras partes)\r\n            const valorVentaDirecta = comparablesData.valor_estimado_venta_directa;\r\n            const valorRentabilidad = comparablesData.valor_estimado_rentabilidad;\r\n            const rangoMin = comparablesData.rango_valor_min;\r\n            const rangoMax = comparablesData.rango_valor_max;\r\n\r\n            let valorEstimadoFinal = comparablesData.valor_final;\r\n            if (!valorEstimadoFinal) {\r\n                if (rangoMin && rangoMax) valorEstimadoFinal = (rangoMin + rangoMax) / 2;\r\n                else if (valorVentaDirecta && valorRentabilidad) valorEstimadoFinal = (valorVentaDirecta * 0.8 + valorRentabilidad * 0.2);\r\n                else valorEstimadoFinal = valorVentaDirecta || valorRentabilidad;\r\n            }\r\n\r\n            // Usar el helper compartido\r\n            const htmlBody = generateAvaluoEmailHtml({\r\n                data: { ...avaluo, ...comparablesData },\r\n                codigoAvaluo,\r\n                valorEstimadoFinal,\r\n                rangoMin,\r\n                rangoMax\r\n            });\r\n\r\n            const response = await fetch(`${import.meta.env.VITE_WORKER_EMAIL_URL}/send-email`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    to: avaluo.email,\r\n                    subject: `Reporte de Aval√∫o: ${avaluo.tipo_inmueble} en ${avaluo.barrio}`,\r\n                    htmlBody: htmlBody\r\n                })\r\n            });\r\n\r\n            if (!response.ok) throw new Error('Error enviando email');\r\n            alert('Correo reenviado exitosamente');\r\n        } catch (e) {\r\n            console.error(e);\r\n            alert('Error al reenviar el correo');\r\n        } finally {\r\n            setSendingEmailId(null);\r\n        }\r\n    };\r\n\r\n    const formatCurrency = (val) => {\r\n        if (!val && val !== 0) return '‚Äî';\r\n        return '$ ' + Math.round(val).toLocaleString('es-CO');\r\n    };\r\n\r\n    const formatDate = (dateString) => {\r\n        return new Date(dateString).toLocaleDateString('es-CO', {\r\n            year: 'numeric',\r\n            month: 'long',\r\n            day: 'numeric'\r\n        });\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"min-h-screen flex items-center justify-center\">\r\n                <Loader2 className=\"w-8 h-8 animate-spin text-[#2C3D37]\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12 flex flex-col min-h-[80vh]\">\r\n            <div className=\"mb-8\">\r\n                <h1 className=\"text-3xl font-bold text-[#2C3D37] font-outfit\">Mis Aval√∫os</h1>\r\n                <p className=\"text-[#4F5B55] mt-2\">Historial de tus valoraciones generadas</p>\r\n            </div>\r\n\r\n            <div className=\"flex-grow\">\r\n                {error && (\r\n                    <Alert className=\"mb-6 bg-red-50 border-red-200\">\r\n                        <AlertDescription className=\"text-red-800\">{error}</AlertDescription>\r\n                    </Alert>\r\n                )}\r\n\r\n                {avaluos.length === 0 ? (\r\n                    <Card className=\"border-dashed border-2 border-[#B0BDB4] bg-[#F5F4F0]/50 h-64 flex items-center justify-center\">\r\n                        <div className=\"text-center\">\r\n                            <div className=\"bg-[#DEE8E9] p-4 rounded-full mb-4 inline-block\">\r\n                                <FileText className=\"w-8 h-8 text-[#2C3D37]\" />\r\n                            </div>\r\n                            <h3 className=\"text-xl font-semibold text-[#2C3D37] mb-2\">No tienes aval√∫os guardados</h3>\r\n                        </div>\r\n                    </Card>\r\n                ) : (\r\n                    <div className=\"grid gap-6\">\r\n                        {avaluos.map((avaluo) => {\r\n                            const formDataForPDF = {\r\n                                ...avaluo,\r\n                                comparables_data: avaluo.payload_json || {}\r\n                            };\r\n                            const compData = avaluo.payload_json || {};\r\n                            let valorMostrar = avaluo.valor_final;\r\n                            if (!valorMostrar) {\r\n                                const v1 = compData.valor_estimado_venta_directa;\r\n                                const v2 = compData.valor_estimado_rentabilidad;\r\n                                if (v1 && v2) valorMostrar = (v1 + v2) / 2;\r\n                                else valorMostrar = v1 || v2;\r\n                            }\r\n\r\n                            return (\r\n                                <Card key={avaluo.id} className=\"border-[#E0E5E2] hover:shadow-md transition-all duration-300 overflow-hidden\">\r\n                                    <CardHeader className=\"pb-3 bg-[#F9FAF9] border-b border-[#F0F2F1]\">\r\n                                        <div className=\"flex items-center justify-between\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <Badge variant=\"outline\" className=\"bg-white text-[#2C3D37] border-[#B0BDB4]\">\r\n                                                    {avaluo.codigo_avaluo || 'SIN C√ìDIGO'}\r\n                                                </Badge>\r\n                                                <span className=\"text-xs text-[#7A8C85] flex items-center gap-1 uppercase tracking-wide\">\r\n                                                    <Calendar className=\"w-3 h-3\" />\r\n                                                    {formatDate(avaluo.created_at)}\r\n                                                </span>\r\n                                            </div>\r\n                                            <Badge className=\"bg-[#DEE8E9] text-[#2C3D37] hover:bg-[#d0ddde]\">\r\n                                                {avaluo.status || 'Completado'}\r\n                                            </Badge>\r\n                                        </div>\r\n                                    </CardHeader>\r\n                                    <CardContent className=\"pt-6\">\r\n                                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                                            <div className=\"space-y-1\">\r\n                                                <p className=\"text-xs text-[#7A8C85] font-bold uppercase tracking-wider\">Inmueble</p>\r\n                                                <div className=\"flex items-start gap-3\">\r\n                                                    <div className=\"bg-[#F0F2F1] p-2 rounded-md\">\r\n                                                        <Home className=\"w-5 h-5 text-[#2C3D37]\" />\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <p className=\"font-semibold text-[#2C3D37] capitalize text-lg\">{avaluo.tipo_inmueble}</p>\r\n                                                        <p className=\"text-sm text-[#4F5B55]\">\r\n                                                            {avaluo.area_construida || avaluo.payload_json?.area_construida || '‚Äî'} m¬≤ ‚Ä¢ {avaluo.habitaciones || avaluo.payload_json?.habitaciones || '‚Äî'} Hab ‚Ä¢ {avaluo.banos || avaluo.payload_json?.banos || '‚Äî'} Ba√±os\r\n                                                        </p>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"space-y-1\">\r\n                                                <p className=\"text-xs text-[#7A8C85] font-bold uppercase tracking-wider\">Ubicaci√≥n</p>\r\n                                                <div className=\"flex items-start gap-3\">\r\n                                                    <div className=\"bg-[#F0F2F1] p-2 rounded-md\">\r\n                                                        <MapPin className=\"w-5 h-5 text-[#2C3D37]\" />\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <p className=\"font-semibold text-[#2C3D37] text-lg\">{avaluo.barrio}</p>\r\n                                                        <p className=\"text-sm text-[#4F5B55]\">{avaluo.municipio || avaluo.ciudad}</p>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <div className=\"space-y-1\">\r\n                                                <p className=\"text-xs text-[#7A8C85] font-bold uppercase tracking-wider\">Valor Estimado</p>\r\n                                                <p className=\"text-3xl font-bold text-[#2C3D37] font-outfit\">\r\n                                                    {formatCurrency(valorMostrar)}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"flex flex-col gap-3 mt-8 pt-6 border-t border-[#F0F2F1]\">\r\n                                            <div className=\"flex flex-col sm:flex-row gap-3\">\r\n                                                <Button\r\n                                                    onClick={() => navigate(`/resultados/${avaluo.id}`)}\r\n                                                    className=\"bg-[#2C3D37] text-white hover:bg-[#1a2620] rounded-full py-6 flex-1\"\r\n                                                >\r\n                                                    <ArrowRight className=\"w-4 h-4 mr-2\" />\r\n                                                    Ver Detalles\r\n                                                </Button>\r\n                                                <BotonPDF\r\n                                                    formData={formDataForPDF}\r\n                                                    className=\"bg-white text-[#2C3D37] border border-[#2C3D37] hover:bg-[#F0F2F1] rounded-full py-6 flex-1\"\r\n                                                    variant=\"outline\"\r\n                                                />\r\n                                            </div>\r\n                                            <Button\r\n                                                variant=\"outline\"\r\n                                                onClick={() => handleResendEmail(avaluo)}\r\n                                                disabled={sendingEmailId === avaluo.id}\r\n                                                className=\"border-[#B0BDB4] text-[#4F5B55] hover:text-[#2C3D37] hover:bg-[#F5F7F6] rounded-full py-6 w-full\"\r\n                                            >\r\n                                                {sendingEmailId === avaluo.id ? (\r\n                                                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                                                ) : (\r\n                                                    <Mail className=\"w-4 h-4 mr-2\" />\r\n                                                )}\r\n                                                Reenviar al Correo\r\n                                            </Button>\r\n                                        </div>\r\n                                    </CardContent>\r\n                                </Card>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"mt-12 mb-[50px] flex justify-center\">\r\n                <Button\r\n                    onClick={() => window.location.href = '/AvaluoInmobiliario'}\r\n                    className=\"bg-[#2C3D37] hover:bg-[#1a2620] text-white rounded-full px-10 py-6 text-lg font-medium shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1\"\r\n                >\r\n                    <RefreshCw className=\"w-5 h-5 mr-2\" />\r\n                    Nuevo Aval√∫o\r\n                </Button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop\\Dise√±o\\Quetzal Habitats\\01_Marketing\\quetzal-avaluo\\src\\pages\\index.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]